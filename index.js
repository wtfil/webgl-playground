!function(t){var r={};function e(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=r,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)e.d(n,o,function(r){return t[r]}.bind(null,o));return n},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},e.p="",e(e.s=4)}([function(t,r,e){"use strict";e.d(r,"b",function(){return n}),e.d(r,"a",function(){return o}),e.d(r,"c",function(){return i});var n=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array,i=Math.random;Math.PI},function(t,r,e){"use strict";e.r(r),e.d(r,"create",function(){return o}),e.d(r,"clone",function(){return i}),e.d(r,"length",function(){return a}),e.d(r,"fromValues",function(){return u}),e.d(r,"copy",function(){return s}),e.d(r,"set",function(){return c}),e.d(r,"add",function(){return f}),e.d(r,"subtract",function(){return l}),e.d(r,"multiply",function(){return d}),e.d(r,"divide",function(){return h}),e.d(r,"ceil",function(){return m}),e.d(r,"floor",function(){return p}),e.d(r,"min",function(){return v}),e.d(r,"max",function(){return g}),e.d(r,"round",function(){return M}),e.d(r,"scale",function(){return b}),e.d(r,"scaleAndAdd",function(){return w}),e.d(r,"distance",function(){return T}),e.d(r,"squaredDistance",function(){return x}),e.d(r,"squaredLength",function(){return E}),e.d(r,"negate",function(){return _}),e.d(r,"inverse",function(){return R}),e.d(r,"normalize",function(){return y}),e.d(r,"dot",function(){return C}),e.d(r,"cross",function(){return F}),e.d(r,"lerp",function(){return P}),e.d(r,"hermite",function(){return A}),e.d(r,"bezier",function(){return L}),e.d(r,"random",function(){return S}),e.d(r,"transformMat4",function(){return D}),e.d(r,"transformMat3",function(){return U}),e.d(r,"transformQuat",function(){return B}),e.d(r,"rotateX",function(){return O}),e.d(r,"rotateY",function(){return I}),e.d(r,"rotateZ",function(){return N}),e.d(r,"angle",function(){return j}),e.d(r,"zero",function(){return z}),e.d(r,"str",function(){return X}),e.d(r,"exactEquals",function(){return q}),e.d(r,"equals",function(){return H}),e.d(r,"sub",function(){return k}),e.d(r,"mul",function(){return G}),e.d(r,"div",function(){return W}),e.d(r,"dist",function(){return Y}),e.d(r,"sqrDist",function(){return Z}),e.d(r,"len",function(){return Q}),e.d(r,"sqrLen",function(){return J}),e.d(r,"forEach",function(){return $});var n=e(0);function o(){var t=new n.a(3);return n.a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(t){var r=new n.a(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function a(t){var r=t[0],e=t[1],n=t[2];return Math.sqrt(r*r+e*e+n*n)}function u(t,r,e){var o=new n.a(3);return o[0]=t,o[1]=r,o[2]=e,o}function s(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function c(t,r,e,n){return t[0]=r,t[1]=e,t[2]=n,t}function f(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t}function l(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t}function d(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t}function h(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t}function m(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t[2]=Math.ceil(r[2]),t}function p(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t[2]=Math.floor(r[2]),t}function v(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t}function g(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t}function M(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t[2]=Math.round(r[2]),t}function b(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t}function w(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t[2]=r[2]+e[2]*n,t}function T(t,r){var e=r[0]-t[0],n=r[1]-t[1],o=r[2]-t[2];return Math.sqrt(e*e+n*n+o*o)}function x(t,r){var e=r[0]-t[0],n=r[1]-t[1],o=r[2]-t[2];return e*e+n*n+o*o}function E(t){var r=t[0],e=t[1],n=t[2];return r*r+e*e+n*n}function _(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t}function R(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t}function y(t,r){var e=r[0],n=r[1],o=r[2],i=e*e+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t}function C(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function F(t,r,e){var n=r[0],o=r[1],i=r[2],a=e[0],u=e[1],s=e[2];return t[0]=o*s-i*u,t[1]=i*a-n*s,t[2]=n*u-o*a,t}function P(t,r,e,n){var o=r[0],i=r[1],a=r[2];return t[0]=o+n*(e[0]-o),t[1]=i+n*(e[1]-i),t[2]=a+n*(e[2]-a),t}function A(t,r,e,n,o,i){var a=i*i,u=a*(2*i-3)+1,s=a*(i-2)+i,c=a*(i-1),f=a*(3-2*i);return t[0]=r[0]*u+e[0]*s+n[0]*c+o[0]*f,t[1]=r[1]*u+e[1]*s+n[1]*c+o[1]*f,t[2]=r[2]*u+e[2]*s+n[2]*c+o[2]*f,t}function L(t,r,e,n,o,i){var a=1-i,u=a*a,s=i*i,c=u*a,f=3*i*u,l=3*s*a,d=s*i;return t[0]=r[0]*c+e[0]*f+n[0]*l+o[0]*d,t[1]=r[1]*c+e[1]*f+n[1]*l+o[1]*d,t[2]=r[2]*c+e[2]*f+n[2]*l+o[2]*d,t}function S(t,r){r=r||1;var e=2*n.c()*Math.PI,o=2*n.c()-1,i=Math.sqrt(1-o*o)*r;return t[0]=Math.cos(e)*i,t[1]=Math.sin(e)*i,t[2]=o*r,t}function D(t,r,e){var n=r[0],o=r[1],i=r[2],a=e[3]*n+e[7]*o+e[11]*i+e[15];return a=a||1,t[0]=(e[0]*n+e[4]*o+e[8]*i+e[12])/a,t[1]=(e[1]*n+e[5]*o+e[9]*i+e[13])/a,t[2]=(e[2]*n+e[6]*o+e[10]*i+e[14])/a,t}function U(t,r,e){var n=r[0],o=r[1],i=r[2];return t[0]=n*e[0]+o*e[3]+i*e[6],t[1]=n*e[1]+o*e[4]+i*e[7],t[2]=n*e[2]+o*e[5]+i*e[8],t}function B(t,r,e){var n=e[0],o=e[1],i=e[2],a=e[3],u=r[0],s=r[1],c=r[2],f=o*c-i*s,l=i*u-n*c,d=n*s-o*u,h=o*d-i*l,m=i*f-n*d,p=n*l-o*f,v=2*a;return f*=v,l*=v,d*=v,h*=2,m*=2,p*=2,t[0]=u+f+h,t[1]=s+l+m,t[2]=c+d+p,t}function O(t,r,e,n){var o=[],i=[];return o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t}function I(t,r,e,n){var o=[],i=[];return o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t}function N(t,r,e,n){var o=[],i=[];return o[0]=r[0]-e[0],o[1]=r[1]-e[1],o[2]=r[2]-e[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],t[0]=i[0]+e[0],t[1]=i[1]+e[1],t[2]=i[2]+e[2],t}function j(t,r){var e=u(t[0],t[1],t[2]),n=u(r[0],r[1],r[2]);y(e,e),y(n,n);var o=C(e,n);return o>1?0:o<-1?Math.PI:Math.acos(o)}function z(t){return t[0]=0,t[1]=0,t[2]=0,t}function X(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function q(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]}function H(t,r){var e=t[0],o=t[1],i=t[2],a=r[0],u=r[1],s=r[2];return Math.abs(e-a)<=n.b*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(o-u)<=n.b*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-s)<=n.b*Math.max(1,Math.abs(i),Math.abs(s))}var V,k=l,G=d,W=h,Y=T,Z=x,Q=a,J=E,$=(V=o(),function(t,r,e,n,o,i){var a,u;for(r||(r=3),e||(e=0),u=n?Math.min(n*r+e,t.length):t.length,a=e;a<u;a+=r)V[0]=t[a],V[1]=t[a+1],V[2]=t[a+2],o(V,V,i),t[a]=V[0],t[a+1]=V[1],t[a+2]=V[2];return t})},function(t,r,e){"use strict";e.r(r),e.d(r,"create",function(){return o}),e.d(r,"clone",function(){return i}),e.d(r,"copy",function(){return a}),e.d(r,"fromValues",function(){return u}),e.d(r,"set",function(){return s}),e.d(r,"identity",function(){return c}),e.d(r,"transpose",function(){return f}),e.d(r,"invert",function(){return l}),e.d(r,"adjoint",function(){return d}),e.d(r,"determinant",function(){return h}),e.d(r,"multiply",function(){return m}),e.d(r,"translate",function(){return p}),e.d(r,"scale",function(){return v}),e.d(r,"rotate",function(){return g}),e.d(r,"rotateX",function(){return M}),e.d(r,"rotateY",function(){return b}),e.d(r,"rotateZ",function(){return w}),e.d(r,"fromTranslation",function(){return T}),e.d(r,"fromScaling",function(){return x}),e.d(r,"fromRotation",function(){return E}),e.d(r,"fromXRotation",function(){return _}),e.d(r,"fromYRotation",function(){return R}),e.d(r,"fromZRotation",function(){return y}),e.d(r,"fromRotationTranslation",function(){return C}),e.d(r,"fromQuat2",function(){return F}),e.d(r,"getTranslation",function(){return P}),e.d(r,"getScaling",function(){return A}),e.d(r,"getRotation",function(){return L}),e.d(r,"fromRotationTranslationScale",function(){return S}),e.d(r,"fromRotationTranslationScaleOrigin",function(){return D}),e.d(r,"fromQuat",function(){return U}),e.d(r,"frustum",function(){return B}),e.d(r,"perspective",function(){return O}),e.d(r,"perspectiveFromFieldOfView",function(){return I}),e.d(r,"ortho",function(){return N}),e.d(r,"lookAt",function(){return j}),e.d(r,"targetTo",function(){return z}),e.d(r,"str",function(){return X}),e.d(r,"frob",function(){return q}),e.d(r,"add",function(){return H}),e.d(r,"subtract",function(){return V}),e.d(r,"multiplyScalar",function(){return k}),e.d(r,"multiplyScalarAndAdd",function(){return G}),e.d(r,"exactEquals",function(){return W}),e.d(r,"equals",function(){return Y}),e.d(r,"mul",function(){return Z}),e.d(r,"sub",function(){return Q});var n=e(0);function o(){var t=new n.a(16);return n.a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function i(t){var r=new n.a(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function a(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function u(t,r,e,o,i,a,u,s,c,f,l,d,h,m,p,v){var g=new n.a(16);return g[0]=t,g[1]=r,g[2]=e,g[3]=o,g[4]=i,g[5]=a,g[6]=u,g[7]=s,g[8]=c,g[9]=f,g[10]=l,g[11]=d,g[12]=h,g[13]=m,g[14]=p,g[15]=v,g}function s(t,r,e,n,o,i,a,u,s,c,f,l,d,h,m,p,v){return t[0]=r,t[1]=e,t[2]=n,t[3]=o,t[4]=i,t[5]=a,t[6]=u,t[7]=s,t[8]=c,t[9]=f,t[10]=l,t[11]=d,t[12]=h,t[13]=m,t[14]=p,t[15]=v,t}function c(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f(t,r){if(t===r){var e=r[1],n=r[2],o=r[3],i=r[6],a=r[7],u=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=n,t[9]=i,t[11]=r[14],t[12]=o,t[13]=a,t[14]=u}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t}function l(t,r){var e=r[0],n=r[1],o=r[2],i=r[3],a=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=r[9],d=r[10],h=r[11],m=r[12],p=r[13],v=r[14],g=r[15],M=e*u-n*a,b=e*s-o*a,w=e*c-i*a,T=n*s-o*u,x=n*c-i*u,E=o*c-i*s,_=f*p-l*m,R=f*v-d*m,y=f*g-h*m,C=l*v-d*p,F=l*g-h*p,P=d*g-h*v,A=M*P-b*F+w*C+T*y-x*R+E*_;return A?(A=1/A,t[0]=(u*P-s*F+c*C)*A,t[1]=(o*F-n*P-i*C)*A,t[2]=(p*E-v*x+g*T)*A,t[3]=(d*x-l*E-h*T)*A,t[4]=(s*y-a*P-c*R)*A,t[5]=(e*P-o*y+i*R)*A,t[6]=(v*w-m*E-g*b)*A,t[7]=(f*E-d*w+h*b)*A,t[8]=(a*F-u*y+c*_)*A,t[9]=(n*y-e*F-i*_)*A,t[10]=(m*x-p*w+g*M)*A,t[11]=(l*w-f*x-h*M)*A,t[12]=(u*R-a*C-s*_)*A,t[13]=(e*C-n*R+o*_)*A,t[14]=(p*b-m*T-v*M)*A,t[15]=(f*T-l*b+d*M)*A,t):null}function d(t,r){var e=r[0],n=r[1],o=r[2],i=r[3],a=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=r[9],d=r[10],h=r[11],m=r[12],p=r[13],v=r[14],g=r[15];return t[0]=u*(d*g-h*v)-l*(s*g-c*v)+p*(s*h-c*d),t[1]=-(n*(d*g-h*v)-l*(o*g-i*v)+p*(o*h-i*d)),t[2]=n*(s*g-c*v)-u*(o*g-i*v)+p*(o*c-i*s),t[3]=-(n*(s*h-c*d)-u*(o*h-i*d)+l*(o*c-i*s)),t[4]=-(a*(d*g-h*v)-f*(s*g-c*v)+m*(s*h-c*d)),t[5]=e*(d*g-h*v)-f*(o*g-i*v)+m*(o*h-i*d),t[6]=-(e*(s*g-c*v)-a*(o*g-i*v)+m*(o*c-i*s)),t[7]=e*(s*h-c*d)-a*(o*h-i*d)+f*(o*c-i*s),t[8]=a*(l*g-h*p)-f*(u*g-c*p)+m*(u*h-c*l),t[9]=-(e*(l*g-h*p)-f*(n*g-i*p)+m*(n*h-i*l)),t[10]=e*(u*g-c*p)-a*(n*g-i*p)+m*(n*c-i*u),t[11]=-(e*(u*h-c*l)-a*(n*h-i*l)+f*(n*c-i*u)),t[12]=-(a*(l*v-d*p)-f*(u*v-s*p)+m*(u*d-s*l)),t[13]=e*(l*v-d*p)-f*(n*v-o*p)+m*(n*d-o*l),t[14]=-(e*(u*v-s*p)-a*(n*v-o*p)+m*(n*s-o*u)),t[15]=e*(u*d-s*l)-a*(n*d-o*l)+f*(n*s-o*u),t}function h(t){var r=t[0],e=t[1],n=t[2],o=t[3],i=t[4],a=t[5],u=t[6],s=t[7],c=t[8],f=t[9],l=t[10],d=t[11],h=t[12],m=t[13],p=t[14],v=t[15];return(r*a-e*i)*(l*v-d*p)-(r*u-n*i)*(f*v-d*m)+(r*s-o*i)*(f*p-l*m)+(e*u-n*a)*(c*v-d*h)-(e*s-o*a)*(c*p-l*h)+(n*s-o*u)*(c*m-f*h)}function m(t,r,e){var n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],d=r[9],h=r[10],m=r[11],p=r[12],v=r[13],g=r[14],M=r[15],b=e[0],w=e[1],T=e[2],x=e[3];return t[0]=b*n+w*u+T*l+x*p,t[1]=b*o+w*s+T*d+x*v,t[2]=b*i+w*c+T*h+x*g,t[3]=b*a+w*f+T*m+x*M,b=e[4],w=e[5],T=e[6],x=e[7],t[4]=b*n+w*u+T*l+x*p,t[5]=b*o+w*s+T*d+x*v,t[6]=b*i+w*c+T*h+x*g,t[7]=b*a+w*f+T*m+x*M,b=e[8],w=e[9],T=e[10],x=e[11],t[8]=b*n+w*u+T*l+x*p,t[9]=b*o+w*s+T*d+x*v,t[10]=b*i+w*c+T*h+x*g,t[11]=b*a+w*f+T*m+x*M,b=e[12],w=e[13],T=e[14],x=e[15],t[12]=b*n+w*u+T*l+x*p,t[13]=b*o+w*s+T*d+x*v,t[14]=b*i+w*c+T*h+x*g,t[15]=b*a+w*f+T*m+x*M,t}function p(t,r,e){var n,o,i,a,u,s,c,f,l,d,h,m,p=e[0],v=e[1],g=e[2];return r===t?(t[12]=r[0]*p+r[4]*v+r[8]*g+r[12],t[13]=r[1]*p+r[5]*v+r[9]*g+r[13],t[14]=r[2]*p+r[6]*v+r[10]*g+r[14],t[15]=r[3]*p+r[7]*v+r[11]*g+r[15]):(n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],d=r[9],h=r[10],m=r[11],t[0]=n,t[1]=o,t[2]=i,t[3]=a,t[4]=u,t[5]=s,t[6]=c,t[7]=f,t[8]=l,t[9]=d,t[10]=h,t[11]=m,t[12]=n*p+u*v+l*g+r[12],t[13]=o*p+s*v+d*g+r[13],t[14]=i*p+c*v+h*g+r[14],t[15]=a*p+f*v+m*g+r[15]),t}function v(t,r,e){var n=e[0],o=e[1],i=e[2];return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=r[7]*o,t[8]=r[8]*i,t[9]=r[9]*i,t[10]=r[10]*i,t[11]=r[11]*i,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function g(t,r,e,o){var i,a,u,s,c,f,l,d,h,m,p,v,g,M,b,w,T,x,E,_,R,y,C,F,P=o[0],A=o[1],L=o[2],S=Math.sqrt(P*P+A*A+L*L);return S<n.b?null:(P*=S=1/S,A*=S,L*=S,i=Math.sin(e),u=1-(a=Math.cos(e)),s=r[0],c=r[1],f=r[2],l=r[3],d=r[4],h=r[5],m=r[6],p=r[7],v=r[8],g=r[9],M=r[10],b=r[11],w=P*P*u+a,T=A*P*u+L*i,x=L*P*u-A*i,E=P*A*u-L*i,_=A*A*u+a,R=L*A*u+P*i,y=P*L*u+A*i,C=A*L*u-P*i,F=L*L*u+a,t[0]=s*w+d*T+v*x,t[1]=c*w+h*T+g*x,t[2]=f*w+m*T+M*x,t[3]=l*w+p*T+b*x,t[4]=s*E+d*_+v*R,t[5]=c*E+h*_+g*R,t[6]=f*E+m*_+M*R,t[7]=l*E+p*_+b*R,t[8]=s*y+d*C+v*F,t[9]=c*y+h*C+g*F,t[10]=f*y+m*C+M*F,t[11]=l*y+p*C+b*F,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function M(t,r,e){var n=Math.sin(e),o=Math.cos(e),i=r[4],a=r[5],u=r[6],s=r[7],c=r[8],f=r[9],l=r[10],d=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=i*o+c*n,t[5]=a*o+f*n,t[6]=u*o+l*n,t[7]=s*o+d*n,t[8]=c*o-i*n,t[9]=f*o-a*n,t[10]=l*o-u*n,t[11]=d*o-s*n,t}function b(t,r,e){var n=Math.sin(e),o=Math.cos(e),i=r[0],a=r[1],u=r[2],s=r[3],c=r[8],f=r[9],l=r[10],d=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*o-c*n,t[1]=a*o-f*n,t[2]=u*o-l*n,t[3]=s*o-d*n,t[8]=i*n+c*o,t[9]=a*n+f*o,t[10]=u*n+l*o,t[11]=s*n+d*o,t}function w(t,r,e){var n=Math.sin(e),o=Math.cos(e),i=r[0],a=r[1],u=r[2],s=r[3],c=r[4],f=r[5],l=r[6],d=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=i*o+c*n,t[1]=a*o+f*n,t[2]=u*o+l*n,t[3]=s*o+d*n,t[4]=c*o-i*n,t[5]=f*o-a*n,t[6]=l*o-u*n,t[7]=d*o-s*n,t}function T(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function x(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=r[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,r,e){var o,i,a,u=e[0],s=e[1],c=e[2],f=Math.sqrt(u*u+s*s+c*c);return f<n.b?null:(u*=f=1/f,s*=f,c*=f,o=Math.sin(r),a=1-(i=Math.cos(r)),t[0]=u*u*a+i,t[1]=s*u*a+c*o,t[2]=c*u*a-s*o,t[3]=0,t[4]=u*s*a-c*o,t[5]=s*s*a+i,t[6]=c*s*a+u*o,t[7]=0,t[8]=u*c*a+s*o,t[9]=s*c*a-u*o,t[10]=c*c*a+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function _(t,r){var e=Math.sin(r),n=Math.cos(r);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=e,t[7]=0,t[8]=0,t[9]=-e,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R(t,r){var e=Math.sin(r),n=Math.cos(r);return t[0]=n,t[1]=0,t[2]=-e,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=e,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y(t,r){var e=Math.sin(r),n=Math.cos(r);return t[0]=n,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,r,e){var n=r[0],o=r[1],i=r[2],a=r[3],u=n+n,s=o+o,c=i+i,f=n*u,l=n*s,d=n*c,h=o*s,m=o*c,p=i*c,v=a*u,g=a*s,M=a*c;return t[0]=1-(h+p),t[1]=l+M,t[2]=d-g,t[3]=0,t[4]=l-M,t[5]=1-(f+p),t[6]=m+v,t[7]=0,t[8]=d+g,t[9]=m-v,t[10]=1-(f+h),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function F(t,r){var e=new n.a(3),o=-r[0],i=-r[1],a=-r[2],u=r[3],s=r[4],c=r[5],f=r[6],l=r[7],d=o*o+i*i+a*a+u*u;return d>0?(e[0]=2*(s*u+l*o+c*a-f*i)/d,e[1]=2*(c*u+l*i+f*o-s*a)/d,e[2]=2*(f*u+l*a+s*i-c*o)/d):(e[0]=2*(s*u+l*o+c*a-f*i),e[1]=2*(c*u+l*i+f*o-s*a),e[2]=2*(f*u+l*a+s*i-c*o)),C(t,r,e),t}function P(t,r){return t[0]=r[12],t[1]=r[13],t[2]=r[14],t}function A(t,r){var e=r[0],n=r[1],o=r[2],i=r[4],a=r[5],u=r[6],s=r[8],c=r[9],f=r[10];return t[0]=Math.sqrt(e*e+n*n+o*o),t[1]=Math.sqrt(i*i+a*a+u*u),t[2]=Math.sqrt(s*s+c*c+f*f),t}function L(t,r){var e=r[0]+r[5]+r[10],n=0;return e>0?(n=2*Math.sqrt(e+1),t[3]=.25*n,t[0]=(r[6]-r[9])/n,t[1]=(r[8]-r[2])/n,t[2]=(r[1]-r[4])/n):r[0]>r[5]&&r[0]>r[10]?(n=2*Math.sqrt(1+r[0]-r[5]-r[10]),t[3]=(r[6]-r[9])/n,t[0]=.25*n,t[1]=(r[1]+r[4])/n,t[2]=(r[8]+r[2])/n):r[5]>r[10]?(n=2*Math.sqrt(1+r[5]-r[0]-r[10]),t[3]=(r[8]-r[2])/n,t[0]=(r[1]+r[4])/n,t[1]=.25*n,t[2]=(r[6]+r[9])/n):(n=2*Math.sqrt(1+r[10]-r[0]-r[5]),t[3]=(r[1]-r[4])/n,t[0]=(r[8]+r[2])/n,t[1]=(r[6]+r[9])/n,t[2]=.25*n),t}function S(t,r,e,n){var o=r[0],i=r[1],a=r[2],u=r[3],s=o+o,c=i+i,f=a+a,l=o*s,d=o*c,h=o*f,m=i*c,p=i*f,v=a*f,g=u*s,M=u*c,b=u*f,w=n[0],T=n[1],x=n[2];return t[0]=(1-(m+v))*w,t[1]=(d+b)*w,t[2]=(h-M)*w,t[3]=0,t[4]=(d-b)*T,t[5]=(1-(l+v))*T,t[6]=(p+g)*T,t[7]=0,t[8]=(h+M)*x,t[9]=(p-g)*x,t[10]=(1-(l+m))*x,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function D(t,r,e,n,o){var i=r[0],a=r[1],u=r[2],s=r[3],c=i+i,f=a+a,l=u+u,d=i*c,h=i*f,m=i*l,p=a*f,v=a*l,g=u*l,M=s*c,b=s*f,w=s*l,T=n[0],x=n[1],E=n[2],_=o[0],R=o[1],y=o[2],C=(1-(p+g))*T,F=(h+w)*T,P=(m-b)*T,A=(h-w)*x,L=(1-(d+g))*x,S=(v+M)*x,D=(m+b)*E,U=(v-M)*E,B=(1-(d+p))*E;return t[0]=C,t[1]=F,t[2]=P,t[3]=0,t[4]=A,t[5]=L,t[6]=S,t[7]=0,t[8]=D,t[9]=U,t[10]=B,t[11]=0,t[12]=e[0]+_-(C*_+A*R+D*y),t[13]=e[1]+R-(F*_+L*R+U*y),t[14]=e[2]+y-(P*_+S*R+B*y),t[15]=1,t}function U(t,r){var e=r[0],n=r[1],o=r[2],i=r[3],a=e+e,u=n+n,s=o+o,c=e*a,f=n*a,l=n*u,d=o*a,h=o*u,m=o*s,p=i*a,v=i*u,g=i*s;return t[0]=1-l-m,t[1]=f+g,t[2]=d-v,t[3]=0,t[4]=f-g,t[5]=1-c-m,t[6]=h+p,t[7]=0,t[8]=d+v,t[9]=h-p,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B(t,r,e,n,o,i,a){var u=1/(e-r),s=1/(o-n),c=1/(i-a);return t[0]=2*i*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*i*s,t[6]=0,t[7]=0,t[8]=(e+r)*u,t[9]=(o+n)*s,t[10]=(a+i)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*c,t[15]=0,t}function O(t,r,e,n,o){var i,a=1/Math.tan(r/2);return t[0]=a/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(i=1/(n-o),t[10]=(o+n)*i,t[14]=2*o*n*i):(t[10]=-1,t[14]=-2*n),t}function I(t,r,e,n){var o=Math.tan(r.upDegrees*Math.PI/180),i=Math.tan(r.downDegrees*Math.PI/180),a=Math.tan(r.leftDegrees*Math.PI/180),u=Math.tan(r.rightDegrees*Math.PI/180),s=2/(a+u),c=2/(o+i);return t[0]=s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-u)*s*.5,t[9]=(o-i)*c*.5,t[10]=n/(e-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*e/(e-n),t[15]=0,t}function N(t,r,e,n,o,i,a){var u=1/(r-e),s=1/(n-o),c=1/(i-a);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(r+e)*u,t[13]=(o+n)*s,t[14]=(a+i)*c,t[15]=1,t}function j(t,r,e,o){var i,a,u,s,f,l,d,h,m,p,v=r[0],g=r[1],M=r[2],b=o[0],w=o[1],T=o[2],x=e[0],E=e[1],_=e[2];return Math.abs(v-x)<n.b&&Math.abs(g-E)<n.b&&Math.abs(M-_)<n.b?c(t):(d=v-x,h=g-E,m=M-_,i=w*(m*=p=1/Math.sqrt(d*d+h*h+m*m))-T*(h*=p),a=T*(d*=p)-b*m,u=b*h-w*d,(p=Math.sqrt(i*i+a*a+u*u))?(i*=p=1/p,a*=p,u*=p):(i=0,a=0,u=0),s=h*u-m*a,f=m*i-d*u,l=d*a-h*i,(p=Math.sqrt(s*s+f*f+l*l))?(s*=p=1/p,f*=p,l*=p):(s=0,f=0,l=0),t[0]=i,t[1]=s,t[2]=d,t[3]=0,t[4]=a,t[5]=f,t[6]=h,t[7]=0,t[8]=u,t[9]=l,t[10]=m,t[11]=0,t[12]=-(i*v+a*g+u*M),t[13]=-(s*v+f*g+l*M),t[14]=-(d*v+h*g+m*M),t[15]=1,t)}function z(t,r,e,n){var o=r[0],i=r[1],a=r[2],u=n[0],s=n[1],c=n[2],f=o-e[0],l=i-e[1],d=a-e[2],h=f*f+l*l+d*d;h>0&&(f*=h=1/Math.sqrt(h),l*=h,d*=h);var m=s*d-c*l,p=c*f-u*d,v=u*l-s*f;return(h=m*m+p*p+v*v)>0&&(m*=h=1/Math.sqrt(h),p*=h,v*=h),t[0]=m,t[1]=p,t[2]=v,t[3]=0,t[4]=l*v-d*p,t[5]=d*m-f*v,t[6]=f*p-l*m,t[7]=0,t[8]=f,t[9]=l,t[10]=d,t[11]=0,t[12]=o,t[13]=i,t[14]=a,t[15]=1,t}function X(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function q(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function H(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t[4]=r[4]+e[4],t[5]=r[5]+e[5],t[6]=r[6]+e[6],t[7]=r[7]+e[7],t[8]=r[8]+e[8],t[9]=r[9]+e[9],t[10]=r[10]+e[10],t[11]=r[11]+e[11],t[12]=r[12]+e[12],t[13]=r[13]+e[13],t[14]=r[14]+e[14],t[15]=r[15]+e[15],t}function V(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t[4]=r[4]-e[4],t[5]=r[5]-e[5],t[6]=r[6]-e[6],t[7]=r[7]-e[7],t[8]=r[8]-e[8],t[9]=r[9]-e[9],t[10]=r[10]-e[10],t[11]=r[11]-e[11],t[12]=r[12]-e[12],t[13]=r[13]-e[13],t[14]=r[14]-e[14],t[15]=r[15]-e[15],t}function k(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*e,t[5]=r[5]*e,t[6]=r[6]*e,t[7]=r[7]*e,t[8]=r[8]*e,t[9]=r[9]*e,t[10]=r[10]*e,t[11]=r[11]*e,t[12]=r[12]*e,t[13]=r[13]*e,t[14]=r[14]*e,t[15]=r[15]*e,t}function G(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t[2]=r[2]+e[2]*n,t[3]=r[3]+e[3]*n,t[4]=r[4]+e[4]*n,t[5]=r[5]+e[5]*n,t[6]=r[6]+e[6]*n,t[7]=r[7]+e[7]*n,t[8]=r[8]+e[8]*n,t[9]=r[9]+e[9]*n,t[10]=r[10]+e[10]*n,t[11]=r[11]+e[11]*n,t[12]=r[12]+e[12]*n,t[13]=r[13]+e[13]*n,t[14]=r[14]+e[14]*n,t[15]=r[15]+e[15]*n,t}function W(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]}function Y(t,r){var e=t[0],o=t[1],i=t[2],a=t[3],u=t[4],s=t[5],c=t[6],f=t[7],l=t[8],d=t[9],h=t[10],m=t[11],p=t[12],v=t[13],g=t[14],M=t[15],b=r[0],w=r[1],T=r[2],x=r[3],E=r[4],_=r[5],R=r[6],y=r[7],C=r[8],F=r[9],P=r[10],A=r[11],L=r[12],S=r[13],D=r[14],U=r[15];return Math.abs(e-b)<=n.b*Math.max(1,Math.abs(e),Math.abs(b))&&Math.abs(o-w)<=n.b*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(i-T)<=n.b*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(a-x)<=n.b*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(u-E)<=n.b*Math.max(1,Math.abs(u),Math.abs(E))&&Math.abs(s-_)<=n.b*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(c-R)<=n.b*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(f-y)<=n.b*Math.max(1,Math.abs(f),Math.abs(y))&&Math.abs(l-C)<=n.b*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(d-F)<=n.b*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(h-P)<=n.b*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(m-A)<=n.b*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(p-L)<=n.b*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(v-S)<=n.b*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(g-D)<=n.b*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(M-U)<=n.b*Math.max(1,Math.abs(M),Math.abs(U))}var Z=m,Q=V},function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e(2),o=e(1);function i(t,r,e){const n=t.createShader(r);return n?(t.shaderSource(n,e),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.warn(t.getShaderInfoLog(n)),console.warn(e),t.deleteShader(n),null)):null}function a(t,r,e){const n=t.createBuffer();return t.bindBuffer(r,n),t.bufferData(r,e,t.STATIC_DRAW),n}r.loadTexture=async function(t,r){const e=await new Promise((t,e)=>{const n=new Image;n.src=r,n.onload=(()=>t(n)),n.onerror=e}),n=t.createTexture(),o=t=>0==(t&t-1);return t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),o(e.width)&&o(e.height)?t.generateMipmap(t.TEXTURE_2D):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)),n},r.createProgram=function(t,r,e){const n=i(t,t.VERTEX_SHADER,r),o=i(t,t.FRAGMENT_SHADER,e),a=t.createProgram();if(!a||!n||!o)throw new Error("Failed to create shader program");if(t.attachShader(a,n),t.attachShader(a,o),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw console.warn(t.getProgramInfoLog(a)),new Error("Can not creat program");const u={},s={},c=t.getProgramParameter(a,t.ACTIVE_ATTRIBUTES),f=t.getProgramParameter(a,t.ACTIVE_UNIFORMS);for(let r=0;r<c;r++){const e=t.getActiveAttrib(a,r).name;u[e]=t.getAttribLocation(a,e)}for(let r=0;r<f;r++){const e=t.getActiveUniform(a,r).name;s[e]=t.getUniformLocation(a,e)}return{program:a,uniforms:s,attributes:u,gl:t}},r.createMatrices=function(t){const r=n.create(),e=n.create(),i=n.create();let a;return t.flip?(a=o.clone(t.cameraPosition),o.sub(a,a,t.center),a[2]=-a[2],o.add(a,a,t.center)):a=t.cameraPosition,n.perspective(r,Math.PI/4,t.aspect,.1,t.far||2e3),n.lookAt(e,a,t.center,[0,0,1]),{model:i,projection:r,view:e}},r.createBuffer=a,r.bindBuffer=function(t,r,e,n){t.bindBuffer(t.ARRAY_BUFFER,r),t.vertexAttribPointer(e,n,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e)},r.bindArraysToBuffers=function(t,r){const{arrays:e,textures:n={},framebuffers:o={}}=r;return{buffers:{position:a(t,t.ARRAY_BUFFER,new Float32Array(e.position)),colors:a(t,t.ARRAY_BUFFER,new Float32Array(e.colors)),indices:a(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices)),normal:a(t,t.ARRAY_BUFFER,new Float32Array(e.normals)),texture:a(t,t.ARRAY_BUFFER,new Float32Array(e.texture))},textures:n,framebuffers:o,size:e.indices.length}},r.createFramebufferAndTexture=function(t,r,e){const n=t.createTexture(),o=t.createFramebuffer(),i=t.createRenderbuffer();return t.bindFramebuffer(t.FRAMEBUFFER,o),t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,e,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),t.bindFramebuffer(t.FRAMEBUFFER,null),[n,o]},r.inRange=function(t,r,e){return t<r?r:t>e?e:t}},function(t,r,e){"use strict";var n=this&&this.__rest||function(t,r){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&r.indexOf(n)<0&&(e[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)r.indexOf(n[o])<0&&(e[n[o]]=t[n[o]])}return e};Object.defineProperty(r,"__esModule",{value:!0});const o=e(1),i=e(5),a=e(8),u=e(10),s=e(13),c=e(16),f=e(3);window.addEventListener("load",async function(){const t=document.querySelector("canvas");t.width=d,t.height=h;const r=t.getContext("experimental-webgl");if(!r)return void console.warn("Can not create webgl context");const e=document.querySelector("[data-properties]"),l=await i.createTerrain(r,{heatmap:"heightmaps/mountain2.png",height:500/p,size:p}),v=await u.createWater(r,{size:m}),g=s.createSun(r),M=c.initProperties();a.initControls(t).on("toggleRenderWater",()=>{M.renderWater=!M.renderWater,b()}).on("toggleRenderTerrain",()=>{M.renderTerrain=!M.renderTerrain,b()}).on("toggleRefraction",()=>{M.useRefraction=!M.useRefraction,b()}).on("toggleReflection",()=>{M.useReflection=!M.useReflection,b()}).on("toggleRenderSun",()=>{M.renderSun=!M.renderSun,b()}).on("zoom",t=>{const{cameraPosition:r,center:e}=M,n=o.create(),i=o.distance(e,r),a=f.inRange(i+t.dy,50,1e3);o.sub(n,r,e),o.scale(n,n,a/i),o.add(r,e,n),b()}).on("moveCamera",t=>{const{cameraPosition:r,center:e}=M,n=o.distance(e,r),i=o.create();o.sub(i,r,e);const a=o.clone(i);a[2]=0;const u=f.inRange(o.angle(i,a)+.01*t.dy,.1,Math.PI/3);a[2]=n*Math.sin(u),o.copy(i,a),o.rotateZ(i,i,[0,0,0],.01*t.dx),o.add(r,e,i),b()});const b=()=>{c.renderProperties(e,M)};(function t(){const e=Date.now()-M.start;const i=s.getSunPosition(e),{sunPosition:a}=i,u=n(i,["sunPosition"]);const c=o.create();o.negate(c,a);Object.assign(M,Object.assign({time:e,sunPosition:a,directionalLightVector:c},u));b();!function(t){const r=50/p,e=d/h,{gl:n,terrain:o,water:i,sun:a,properties:u}=t,s=Object.assign({},u,{aspect:e});n.clearDepth(1),n.clearColor(.53,.8,.98,1),n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),u.renderWater&&(i.updateReflectionTexture(()=>{u.renderTerrain&&o.render(Object.assign({},s,{waterHeight:r,clipLevel:-1,flip:!0})),u.renderSun&&a.render(s)}),i.updateRefractionTexture(()=>{u.renderTerrain&&o.render(Object.assign({},s,{waterHeight:r,clipLevel:1,flip:!1}))}));n.viewport(0,0,d,h),u.renderSun&&a.render(s);u.renderTerrain&&o.render(Object.assign({},s,{waterHeight:r,clipLevel:0,flip:!1}));u.renderWater&&i.render(Object.assign({},s,{waterHeight:r}))}({gl:r,properties:M,terrain:l,water:v,sun:g});requestAnimationFrame(t)})(),b()});const l=Math.min(window.innerWidth,window.innerHeight),d=l,h=l,m=2*l,p=5},function(t,r,e){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const o=e(2),i=e(1),a=e(3),u=n(e(6)),s=n(e(7));function c(t){return function(r){const{gl:e,terrain:n,program:i}=t,{cameraPosition:u,center:s,aspect:c,clipLevel:f,flip:l,waterHeight:d,directionalLightVector:h}=r,{projection:m,model:p,view:v}=a.createMatrices({cameraPosition:u,center:s,aspect:c,flip:l});r.flip&&o.translate(p,p,[0,0,f*d*2]),e.useProgram(i.program),a.bindBuffer(e,n.buffers.position,i.attributes.position,3),a.bindBuffer(e,n.buffers.normal,i.attributes.normal,3),a.bindBuffer(e,n.buffers.colors,i.attributes.colors,4),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.buffers.indices),e.uniformMatrix4fv(i.uniforms.projection,!1,m),e.uniformMatrix4fv(i.uniforms.model,!1,p),e.uniformMatrix4fv(i.uniforms.view,!1,v),e.uniform3fv(i.uniforms.directionalLightVector,h),e.uniform1f(i.uniforms.clipZ,d),e.uniform1f(i.uniforms.clipLevel,f),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawElements(e.TRIANGLES,n.size,e.UNSIGNED_SHORT,0),e.disable(e.BLEND)}}r.createTerrain=async function(t,r){const e=await async function(t,r,e){const n=document.createElement("canvas"),o=await function(t){return new Promise((r,e)=>{const n=new Image;n.src=t,n.onload=(()=>r(n)),n.onerror=e})}(t);n.width=o.width,n.height=o.height;const a=n.getContext("2d");if(!a)throw new Error("Can not create 2d context");a.drawImage(o,0,0);const{data:u}=a.getImageData(0,0,o.width,o.height),s=new Uint32Array(u),c=256/r,f=Math.floor(o.width/e),l=Math.floor(o.height/e),d=new Float32Array(f*l);let h=0;for(let t=0;t<l;t++)for(let r=0;r<f;r++){let n=0;for(let i=0;i<e;i++)for(let a=0;a<e;a++)n+=s[4*(t*e*o.width+r*e+i*e+a)];const i=n/e/e/c;d[t*f+r]=i,h<i&&(h=i)}const m=[],p=[],v=[],g=[],M=[];for(let t=0;t<l;t++)for(let r=0;r<f;r++){const e=t*f+r,n=d[e]/h;m.push(r-f/2,t-l/2,d[e]),v.push(n,n,n,1),t!==l-1&&r!==f-1&&p.push(e,e+f,e+1,e+1,e+f,e+f+1),M.push(r/f,t/l)}for(let t=0;t<m.length/3;t++){const r=f,e=l,n=t%r,o=~~(t/r),a=[n>0&&o>0&&[t-r,t-1,t],n+1<r&&o>0&&[t-r,t,t-r+1],n+1<r&&o>0&&[t-r+1,t,t+1],n>0&&o<e&&[t-1,t+r-1,t],n>0&&o<e&&[t,t+r-1,t+r],n+1<r&&o<e&&[t,t+r,t+1]],u=[],s=[];for(let t=0;t<a.length;t++){const r=a[t];for(let t=0;t<3;t++)r&&u.push(m[3*r[t]],m[3*r[t]+1],m[3*r[t]+2])}for(let t=0;t<u.length/9;t++){const r=i.fromValues(u[9*t+0],u[9*t+1],u[9*t+2]),e=i.fromValues(u[9*t+3],u[9*t+4],u[9*t+5]),n=i.fromValues(u[9*t+6],u[9*t+7],u[9*t+8]);i.subtract(e,e,r),i.subtract(n,n,r),i.cross(e,e,n),i.normalize(e,e),s.push(e)}const c=i.fromValues(0,0,0);for(let t=0;t<s.length;t++)i.add(c,c,s[t]);i.normalize(c,c),g.push(c[0],c[1],c[2])}return{position:m,indices:p,colors:v,normals:g,texture:M}}(r.heatmap,r.height,r.size),n=a.createProgram(t,u.default,s.default);return{render:c({terrain:a.bindArraysToBuffers(t,{arrays:e}),gl:t,program:n})}}},function(t,r){t.exports="attribute vec4 position;\r\nattribute vec3 normal;\r\nattribute vec4 colors;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 directionalLightVector;\r\nuniform float clipZ;\r\nuniform float clipLevel;\r\n\r\nvarying highp vec3 vLighting;\r\nvarying lowp vec2 vTextureCoord;\r\nvarying lowp vec4 fragmentColor;\r\nvarying float shouldClip;\r\n\r\nvoid main() {\r\n  // light\r\n  //highp vec3 ambientLight = vec3(0.3, 0.3, 0.3);\r\n  highp vec3 ambientLight = vec3(0, 0, 0);\r\n  highp vec3 directionalLightColor = vec3(1, 1, 1);\r\n  highp vec3 directionalVector = normalize(directionalLightVector);\r\n\r\n  highp vec4 transformedNormal = vec4(normal, 1.0);\r\n  highp float directional = max(dot(transformedNormal.xyz, directionalVector), 0.0);\r\n  vLighting = ambientLight + (directionalLightColor * directional);\r\n\r\n  gl_Position = projection * view * model * position;\r\n\r\n  fragmentColor = colors;\r\n  if (clipLevel == 1.0) {\r\n    shouldClip = position.z > clipZ ? 1.0 : 0.0;\r\n  } else if (clipLevel == -1.0) {\r\n    shouldClip = position.z < clipZ ? 1.0 : 0.0;\r\n  } else {\r\n    shouldClip = 0.0;\r\n  }\r\n}"},function(t,r){t.exports="varying highp vec3 vLighting;\r\nvarying highp float shouldClip;\r\nvarying lowp vec4 fragmentColor;\r\n\r\nconst lowp vec4 nothingColor = vec4(0.0, 0.0, 0.0, 0.0);\r\nconst lowp vec4 grassColor = vec4(0.12, 0.43, 0.02, 1.0);\r\nconst lowp vec4 snowColor = vec4(1.0);\r\nconst lowp vec4 groundColor = vec4(0.85, 0.84, 0.79, 1.0);\r\n\r\nvoid main() {\r\n  if (shouldClip == 1.0) {\r\n    discard;\r\n  }\r\n  lowp float x = fragmentColor.x;\r\n  lowp float groundGrassMixFactor = smoothstep(0.1, 0.2, x);\r\n  lowp float grassSnowMixFactor = smoothstep(0.7, 0.8, x);\r\n  lowp float nothingGroundMixFactor = smoothstep(0.00, 0.015, x);\r\n  lowp vec4 color = mix(groundColor, grassColor, groundGrassMixFactor);\r\n  color = mix(color, snowColor, grassSnowMixFactor);\r\n  color = mix(nothingColor, color, nothingGroundMixFactor);\r\n\r\n  gl_FragColor = vec4(color.rgb * vLighting, color.a);\r\n}\r\n"},function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e(9);r.initControls=function(t){let r=!1;const e=new n.EventEmitter,o={},i=()=>{let t=0,r=0;o.w&&!o.s?r=1:o.s&&!o.w&&(r=-1),o.a&&!o.d?t=-1:o.d&&!o.a&&(t=1),(t||r)&&e.emit("moveCamera",{dx:t,dy:r}),requestAnimationFrame(i)};return i(),t.addEventListener("wheel",t=>{const{deltaY:r}=t;r&&(e.emit("zoom",{dy:r/Math.abs(r)*10}),t.preventDefault())}),window.addEventListener("keypress",t=>{switch(t.key){case"1":e.emit("toggleRenderTerrain");break;case"2":e.emit("toggleRenderWater");break;case"3":e.emit("toggleRefraction");break;case"4":e.emit("toggleReflection");break;case"5":e.emit("toggleRenderSun");break;default:o[t.key]=!0}}),window.addEventListener("keyup",t=>{o[t.key]=!1}),t.addEventListener("mousedown",()=>{r=!0}),window.addEventListener("mouseup",()=>{r=!1}),window.addEventListener("mousemove",t=>{const{movementX:n,movementY:o}=t;r&&e.emit("moveCamera",{dx:-n,dy:o})}),e}},function(t,r){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(t){return"function"==typeof t}function o(t){return"object"==typeof t&&null!==t}function i(t){return void 0===t}t.exports=e,e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},e.prototype.emit=function(t){var r,e,a,u,s,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((r=arguments[1])instanceof Error)throw r;var f=new Error('Uncaught, unspecified "error" event. ('+r+")");throw f.context=r,f}if(i(e=this._events[t]))return!1;if(n(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),e.apply(this,u)}else if(o(e))for(u=Array.prototype.slice.call(arguments,1),a=(c=e.slice()).length,s=0;s<a;s++)c[s].apply(this,u);return!0},e.prototype.addListener=function(t,r){var a;if(!n(r))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,n(r.listener)?r.listener:r),this._events[t]?o(this._events[t])?this._events[t].push(r):this._events[t]=[this._events[t],r]:this._events[t]=r,o(this._events[t])&&!this._events[t].warned&&(a=i(this._maxListeners)?e.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[t].length>a&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(t,r){if(!n(r))throw TypeError("listener must be a function");var e=!1;function o(){this.removeListener(t,o),e||(e=!0,r.apply(this,arguments))}return o.listener=r,this.on(t,o),this},e.prototype.removeListener=function(t,r){var e,i,a,u;if(!n(r))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(a=(e=this._events[t]).length,i=-1,e===r||n(e.listener)&&e.listener===r)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,r);else if(o(e)){for(u=a;u-- >0;)if(e[u]===r||e[u].listener&&e[u].listener===r){i=u;break}if(i<0)return this;1===e.length?(e.length=0,delete this._events[t]):e.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,r)}return this},e.prototype.removeAllListeners=function(t){var r,e;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(r in this._events)"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events={},this}if(n(e=this._events[t]))this.removeListener(t,e);else if(e)for(;e.length;)this.removeListener(t,e[e.length-1]);return delete this._events[t],this},e.prototype.listeners=function(t){return this._events&&this._events[t]?n(this._events[t])?[this._events[t]]:this._events[t].slice():[]},e.prototype.listenerCount=function(t){if(this._events){var r=this._events[t];if(n(r))return 1;if(r)return r.length}return 0},e.listenerCount=function(t,r){return t.listenerCount(r)}},function(t,r,e){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const o=e(2),i=e(3),a=n(e(11)),u=n(e(12));function s(t){return function(r){const{gl:e,water:n,size:o}=t;e.bindFramebuffer(e.FRAMEBUFFER,n.framebuffers.reflection),e.viewport(0,0,o,o),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),r(),e.bindFramebuffer(e.FRAMEBUFFER,null)}}function c(t){return function(r){const{gl:e,water:n,size:o}=t;e.bindFramebuffer(e.FRAMEBUFFER,n.framebuffers.refraction),e.viewport(0,0,o,o),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),r(),e.bindFramebuffer(e.FRAMEBUFFER,null)}}function f(t){return function(r){const{size:e,program:n,gl:a,water:u}=t,{cameraPosition:s,center:c,aspect:f,time:l,waterHeight:d,useReflection:h,useRefraction:m,directionalLightVector:p}=r,{projection:v,model:g,view:M}=i.createMatrices({cameraPosition:s,center:c,aspect:f});o.translate(g,g,[0,0,d]),o.scale(g,g,[e,e,1]),a.useProgram(n.program),i.bindBuffer(a,u.buffers.position,n.attributes.position,3),i.bindBuffer(a,u.buffers.texture,n.attributes.textureCoord,2),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,u.buffers.indices),a.uniform1f(n.uniforms.dudvOffset,l/1e3*.06%1),a.uniform1i(n.uniforms.useRefraction,Number(m)),a.uniform1i(n.uniforms.useReflection,Number(h)),a.uniform3fv(n.uniforms.center,c),a.uniform3fv(n.uniforms.cameraPosition,s),a.uniform3fv(n.uniforms.directionalLightVector,p),a.uniformMatrix4fv(n.uniforms.projection,!1,v),a.uniformMatrix4fv(n.uniforms.model,!1,g),a.uniformMatrix4fv(n.uniforms.view,!1,M),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,u.textures.dudv),a.uniform1i(n.uniforms.dudvTexture,0),a.activeTexture(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,u.textures.normalMap),a.uniform1i(n.uniforms.normalMapTexture,1),a.activeTexture(a.TEXTURE2),a.bindTexture(a.TEXTURE_2D,u.textures.refraction),a.uniform1i(n.uniforms.refractionTexture,2),a.activeTexture(a.TEXTURE3),a.bindTexture(a.TEXTURE_2D,u.textures.reflection),a.uniform1i(n.uniforms.reflectionTexture,3),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawElements(a.TRIANGLES,u.size,a.UNSIGNED_SHORT,0),a.disable(a.BLEND)}}r.createWater=async function(t,r){const{size:e}=r,n=await i.loadTexture(t,"textures/dudvmap.png"),o=await i.loadTexture(t,"textures/normalmap.png"),[l,d]=i.createFramebufferAndTexture(t,e,e),[h,m]=i.createFramebufferAndTexture(t,e,e),p={position:[-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0],indices:[0,2,1,1,2,3],texture:[0,0,1,0,0,1,1,1]},v={gl:t,program:i.createProgram(t,a.default,u.default),size:e,water:i.bindArraysToBuffers(t,{arrays:p,framebuffers:{refraction:d,reflection:m},textures:{dudv:n,normalMap:o,refraction:l,reflection:h}})};return{render:f(v),updateReflectionTexture:s(v),updateRefractionTexture:c(v)}}},function(t,r){t.exports="attribute vec4 position;\r\nattribute vec2 textureCoord;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 cameraPosition;\r\n\r\nvarying highp vec2 vTextureCoord;\r\nvarying highp vec4 clipSpace;\r\nvarying highp vec3 fromFragmentToCamera;\r\n\r\nconst lowp float tiling = 10.0;\r\n\r\nvoid main() {\r\n    vec4 worldPosition = model * position;\r\n    gl_Position = clipSpace = projection * view * worldPosition;\r\n\r\n    fromFragmentToCamera = cameraPosition - worldPosition.xyz;\r\n    vTextureCoord = textureCoord * tiling;\r\n}"},function(t,r){t.exports="varying lowp vec2 vTextureCoord;\r\nvarying lowp vec4 clipSpace;\r\nvarying lowp vec3 fromFragmentToCamera;\r\n\r\nuniform sampler2D dudvTexture;\r\nuniform sampler2D normalMapTexture;\r\nuniform sampler2D refractionTexture;\r\nuniform sampler2D reflectionTexture;\r\nuniform lowp float dudvOffset;\r\nuniform int useRefraction;\r\nuniform int useReflection;\r\nuniform lowp vec3 directionalLightVector;\r\n\r\nconst lowp float waterDistortionStrenth = 0.03;\r\nconst lowp float fresnelStrength = 1.5;\r\nconst lowp float waterReflectivity = 0.5;\r\nconst lowp vec3 sunlightColor = vec3(1.0, 1.0, 1.0);\r\nconst lowp vec4 shallowWaterColor =  vec4(0.0, 0.1, 0.3, 1.0);\r\n// const lowp vec4 deepWaterColor = vec4(0.0, 0.1, 0.2, 1.0);\r\nconst lowp float shineDamper = 20.0;\r\n\r\nvoid main() {\r\n    // distortion\r\n    lowp vec2 distortedTexCoords = texture2D(dudvTexture, vec2(vTextureCoord.x, vTextureCoord.y + dudvOffset)).xy * 0.1;\r\n    distortedTexCoords = vTextureCoord + vec2(distortedTexCoords.x + dudvOffset, distortedTexCoords.y);\r\n\r\n    lowp vec2 totalDistortion = (texture2D(dudvTexture, distortedTexCoords).xy * 2.0 - 1.0) * waterDistortionStrenth;\r\n\r\n    // base refract/reflect texture coordinates\r\n    lowp vec2 ndc = (clipSpace.xy / clipSpace.w) / 2.0 + 0.5;\r\n    lowp vec2 refractTexCoords = vec2(ndc.x, +ndc.y);\r\n    lowp vec2 reflectTexCoords = vec2(ndc.x, 1.0-ndc.y);\r\n\r\n    // refractive factor\r\n    lowp vec3 toCamera = normalize(fromFragmentToCamera);\r\n    lowp vec4 normalMapColor = texture2D(normalMapTexture, distortedTexCoords);\r\n    lowp vec3 normal = vec3(\r\n      normalMapColor.r * 2.0 - 1.0,\r\n      normalMapColor.g * 2.0 - 1.0,\r\n      normalMapColor.b * 2.0 - 1.0\r\n    );\r\n    normal = normalize(normal);\r\n    lowp float refractiveFactor = dot(toCamera, normal);\r\n    refractiveFactor = pow(refractiveFactor, fresnelStrength);\r\n\r\n    // puting all together\r\n    refractTexCoords += totalDistortion;\r\n    reflectTexCoords += totalDistortion;\r\n    // refractTexCoords = clamp(refractTexCoords, 0.001, 0.999);\r\n    // reflectTexCoords.x = clamp(reflectTexCoords.x, 0.001, 0.999);\r\n    // reflectTexCoords.y = clamp(reflectTexCoords.y, -0.999, -0.001);\r\n\r\n    // lighs\r\n    lowp vec3 reflectedLight = reflect(normalize(directionalLightVector), normal);\r\n    lowp float specular = max(dot(reflectedLight, toCamera), 0.0);\r\n    specular = pow(specular, shineDamper);\r\n    lowp vec3 specularHighlights = sunlightColor * specular * waterReflectivity;\r\n\r\n    // color\r\n    lowp vec4 refractColor = texture2D(refractionTexture, refractTexCoords);\r\n    lowp vec4 reflectColor = texture2D(reflectionTexture, reflectTexCoords);\r\n\r\n    if (useReflection == 1 && useRefraction == 1) {\r\n      gl_FragColor = mix(reflectColor, refractColor, refractiveFactor);\r\n    } else if (useReflection == 1) {\r\n      gl_FragColor = reflectColor;\r\n    } else if (useRefraction == 1) {\r\n      gl_FragColor = refractColor;\r\n    }\r\n    gl_FragColor = mix(gl_FragColor, shallowWaterColor, 0.2);\r\n\r\n    gl_FragColor = gl_FragColor + vec4(specularHighlights, 0.0);\r\n}\r\n"},function(t,r,e){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(r,"__esModule",{value:!0});const o=e(1),i=e(2),a=e(3),u=n(e(14)),s=n(e(15)),{cos:c,sin:f,tan:l,PI:d}=Math;function h(t){return function(r){const{gl:e,program:n,sun:o}=t,{cameraPosition:u,center:s,aspect:c,sunPosition:f}=r,{projection:l,model:d,view:h}=a.createMatrices({cameraPosition:u,center:s,aspect:c,far:4e3});i.scale(d,d,[2e3,2e3,2e3]),e.useProgram(n.program),a.bindBuffer(e,o.buffers.position,n.attributes.position,3),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffers.indices),e.uniform1f(n.uniforms.domeRadius,2e3),e.uniform3fv(n.uniforms.sunPosition,f),e.uniformMatrix4fv(n.uniforms.projection,!1,l),e.uniformMatrix4fv(n.uniforms.view,!1,h),e.uniformMatrix4fv(n.uniforms.model,!1,d),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawElements(e.TRIANGLES,o.size,e.UNSIGNED_SHORT,0),e.disable(e.BLEND)}}function m(){const t=50,r=[],e=[];for(let n=0;n<=t;n++){const o=d/t*n-d/2;for(let i=0;i<t;i++){const a=2*d/t*i,u=c(a)*c(o),s=f(a)*c(o),l=f(o),h=n*t+i;r.push(u,s,l),n!==t&&(49===i?e.push(n*t,h+t,h,h+t,h+1,n*t):e.push(h,h+1,h+t,h+1,h+t,h+t+1))}}return{position:r,indices:e}}r.createSun=function(t){const r=a.createProgram(t,u.default,s.default);return{render:h({gl:t,sun:a.bindArraysToBuffers(t,{arrays:m()}),program:r})}};const p=.004;r.getSunPosition=function(t){const r=t*p%24*3600*1e3,e=Math.ceil(r/60/1e3),n=e%60,i=Math.floor(e/60),a=function(t){return l(-4.83049e-16*t*t+4.21414e-8*t-.420437)}(r)/2,u=function(t){return 7.344052639206152e-8*t-.1829595519336553}(r),s=c(a)*c(u),d=c(a)*f(u),h=f(a);return{sunTime:`${i}:${n}`,altitude:a,azimuth:u,sunPosition:o.fromValues(s,-d,h)}}},function(t,r){t.exports="attribute vec4 position;\r\n\r\nuniform lowp mat4 view;\r\nuniform lowp mat4 model;\r\nuniform lowp mat4 projection;\r\n\r\nvarying lowp vec4 worldPosition;\r\n\r\nvoid main() {\r\n    worldPosition = model * position;\r\n    gl_Position = projection * view * worldPosition;\r\n}"},function(t,r){t.exports="uniform lowp float domeRadius;\r\nuniform lowp vec3 sunPosition;\r\n\r\nvarying lowp vec4 worldPosition;\r\n\r\nconst lowp float PI = 3.1415926535897932384626433832795;\r\nconst lowp float PI_2 = 1.57079632679489661923;\r\nconst lowp vec4 daySkyColor = vec4(0.67, 0.96, 0.98, 1.00);\r\nconst lowp vec4 nigthSkyColor = vec4(0.0, 0.0, 0.0, 1.0);\r\nconst lowp vec4 sunColorInner = vec4(0.89, 0.40, 0.00, 1.00);\r\nconst lowp vec4 sunColorOuter = vec4(0.95, 0.77, 0.35, 1.00);\r\nconst lowp float maxSunHeight = 0.2;\r\n\r\n\r\nvoid main() {\r\n    lowp float sunSize = 150.0;\r\n    lowp float sunToFragment = distance(sunPosition * domeRadius, worldPosition.xyz);\r\n    lowp float colorFactor = smoothstep(0.0, sunSize, pow(sunToFragment, 1.0));\r\n    lowp float alpha = 0.5 - atan((sunToFragment - sunSize) / domeRadius * 10.0) / PI;\r\n    lowp vec4 skyColor = mix(\r\n        daySkyColor,\r\n        nigthSkyColor,\r\n        smoothstep(maxSunHeight, -maxSunHeight, sunPosition.z)\r\n    );\r\n\r\n    lowp vec4 sunColor = mix(sunColorInner, sunColorOuter, colorFactor);\r\n    gl_FragColor = mix(skyColor, sunColor, alpha);\r\n}"},function(t,r,e){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=e(1),o={center:n.fromValues(0,0,0),cameraPosition:n.fromValues(678,115,69),directionalLightVector:n.fromValues(0,0,-1),sunPosition:n.fromValues(0,0,-1),start:Date.now(),time:0,renderWater:!0,renderTerrain:!0,useReflection:!0,useRefraction:!0,renderSun:!0},i="wp-program-params",a=t=>Array.from(t).map(t=>{return(t>0?"+":"-")+Math.abs(t).toFixed(1)}).join(", ");r.initProperties=function(){const t=localStorage.getItem(i),r=t?JSON.parse(t):o;return Object.assign({},r,{start:Date.now()})},r.saveProperties=function(t){const r=Object.assign({},t,{center:Array.from(t.center),cameraPosition:Array.from(t.cameraPosition)});localStorage.setItem(i,JSON.stringify(r))},r.renderProperties=function(t,r){const e=[{title:"sun position",value:a(r.sunPosition)},{title:"sun time",value:r.sunTime},{title:"altitude",value:(180*r.altitude/Math.PI).toFixed(2)},{title:"azimuth",value:(180*r.azimuth/Math.PI).toFixed(2)},{title:"camera",control:"a d w s wheel mouse",value:a(r.cameraPosition)},{title:"terrain",control:"1",value:r.renderTerrain},{title:"water",control:"2",value:r.renderWater},{title:"use refraction",control:"3",value:r.useRefraction},{title:"use reflection",control:"4",value:r.useReflection},{title:"render sun disk",control:"5",value:r.renderSun}],n=["title","control","value"],o=t.querySelector("tbody");o.innerHTML="",e.forEach(t=>{const r=document.createElement("tr");n.forEach(e=>{const n=document.createElement("td");n.innerText=e in t?t[e]:"",r.appendChild(n)}),o.appendChild(r)})}}]);
//# sourceMappingURL=index.js.map