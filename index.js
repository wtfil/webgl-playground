!function(r){var t={};function e(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return r[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=r,e.c=t,e.d=function(r,t,n){e.o(r,t)||Object.defineProperty(r,t,{enumerable:!0,get:n})},e.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,t){if(1&t&&(r=e(r)),8&t)return r;if(4&t&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&t&&"string"!=typeof r)for(var o in r)e.d(n,o,function(t){return r[t]}.bind(null,o));return n},e.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(t,"a",t),t},e.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},e.p="",e(e.s=6)}([function(r,t,e){"use strict";e.d(t,"b",function(){return n}),e.d(t,"a",function(){return o}),e.d(t,"c",function(){return a});var n=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array,a=Math.random;Math.PI},function(r,t,e){"use strict";e.r(t),e.d(t,"create",function(){return o}),e.d(t,"clone",function(){return a}),e.d(t,"copy",function(){return i}),e.d(t,"fromValues",function(){return u}),e.d(t,"set",function(){return c}),e.d(t,"identity",function(){return s}),e.d(t,"transpose",function(){return f}),e.d(t,"invert",function(){return l}),e.d(t,"adjoint",function(){return d}),e.d(t,"determinant",function(){return m}),e.d(t,"multiply",function(){return h}),e.d(t,"translate",function(){return v}),e.d(t,"scale",function(){return p}),e.d(t,"rotate",function(){return g}),e.d(t,"rotateX",function(){return T}),e.d(t,"rotateY",function(){return M}),e.d(t,"rotateZ",function(){return E}),e.d(t,"fromTranslation",function(){return b}),e.d(t,"fromScaling",function(){return x}),e.d(t,"fromRotation",function(){return w}),e.d(t,"fromXRotation",function(){return R}),e.d(t,"fromYRotation",function(){return _}),e.d(t,"fromZRotation",function(){return C}),e.d(t,"fromRotationTranslation",function(){return y}),e.d(t,"fromQuat2",function(){return F}),e.d(t,"getTranslation",function(){return A}),e.d(t,"getScaling",function(){return P}),e.d(t,"getRotation",function(){return D}),e.d(t,"fromRotationTranslationScale",function(){return L}),e.d(t,"fromRotationTranslationScaleOrigin",function(){return S}),e.d(t,"fromQuat",function(){return U}),e.d(t,"frustum",function(){return B}),e.d(t,"perspective",function(){return I}),e.d(t,"perspectiveFromFieldOfView",function(){return z}),e.d(t,"ortho",function(){return N}),e.d(t,"lookAt",function(){return O}),e.d(t,"targetTo",function(){return X}),e.d(t,"str",function(){return k}),e.d(t,"frob",function(){return V}),e.d(t,"add",function(){return q}),e.d(t,"subtract",function(){return j}),e.d(t,"multiplyScalar",function(){return W}),e.d(t,"multiplyScalarAndAdd",function(){return G}),e.d(t,"exactEquals",function(){return H}),e.d(t,"equals",function(){return Y}),e.d(t,"mul",function(){return Q}),e.d(t,"sub",function(){return Z});var n=e(0);function o(){var r=new n.a(16);return n.a!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function a(r){var t=new n.a(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function i(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function u(r,t,e,o,a,i,u,c,s,f,l,d,m,h,v,p){var g=new n.a(16);return g[0]=r,g[1]=t,g[2]=e,g[3]=o,g[4]=a,g[5]=i,g[6]=u,g[7]=c,g[8]=s,g[9]=f,g[10]=l,g[11]=d,g[12]=m,g[13]=h,g[14]=v,g[15]=p,g}function c(r,t,e,n,o,a,i,u,c,s,f,l,d,m,h,v,p){return r[0]=t,r[1]=e,r[2]=n,r[3]=o,r[4]=a,r[5]=i,r[6]=u,r[7]=c,r[8]=s,r[9]=f,r[10]=l,r[11]=d,r[12]=m,r[13]=h,r[14]=v,r[15]=p,r}function s(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function f(r,t){if(r===t){var e=t[1],n=t[2],o=t[3],a=t[6],i=t[7],u=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=e,r[6]=t[9],r[7]=t[13],r[8]=n,r[9]=a,r[11]=t[14],r[12]=o,r[13]=i,r[14]=u}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function l(r,t){var e=t[0],n=t[1],o=t[2],a=t[3],i=t[4],u=t[5],c=t[6],s=t[7],f=t[8],l=t[9],d=t[10],m=t[11],h=t[12],v=t[13],p=t[14],g=t[15],T=e*u-n*i,M=e*c-o*i,E=e*s-a*i,b=n*c-o*u,x=n*s-a*u,w=o*s-a*c,R=f*v-l*h,_=f*p-d*h,C=f*g-m*h,y=l*p-d*v,F=l*g-m*v,A=d*g-m*p,P=T*A-M*F+E*y+b*C-x*_+w*R;return P?(P=1/P,r[0]=(u*A-c*F+s*y)*P,r[1]=(o*F-n*A-a*y)*P,r[2]=(v*w-p*x+g*b)*P,r[3]=(d*x-l*w-m*b)*P,r[4]=(c*C-i*A-s*_)*P,r[5]=(e*A-o*C+a*_)*P,r[6]=(p*E-h*w-g*M)*P,r[7]=(f*w-d*E+m*M)*P,r[8]=(i*F-u*C+s*R)*P,r[9]=(n*C-e*F-a*R)*P,r[10]=(h*x-v*E+g*T)*P,r[11]=(l*E-f*x-m*T)*P,r[12]=(u*_-i*y-c*R)*P,r[13]=(e*y-n*_+o*R)*P,r[14]=(v*M-h*b-p*T)*P,r[15]=(f*b-l*M+d*T)*P,r):null}function d(r,t){var e=t[0],n=t[1],o=t[2],a=t[3],i=t[4],u=t[5],c=t[6],s=t[7],f=t[8],l=t[9],d=t[10],m=t[11],h=t[12],v=t[13],p=t[14],g=t[15];return r[0]=u*(d*g-m*p)-l*(c*g-s*p)+v*(c*m-s*d),r[1]=-(n*(d*g-m*p)-l*(o*g-a*p)+v*(o*m-a*d)),r[2]=n*(c*g-s*p)-u*(o*g-a*p)+v*(o*s-a*c),r[3]=-(n*(c*m-s*d)-u*(o*m-a*d)+l*(o*s-a*c)),r[4]=-(i*(d*g-m*p)-f*(c*g-s*p)+h*(c*m-s*d)),r[5]=e*(d*g-m*p)-f*(o*g-a*p)+h*(o*m-a*d),r[6]=-(e*(c*g-s*p)-i*(o*g-a*p)+h*(o*s-a*c)),r[7]=e*(c*m-s*d)-i*(o*m-a*d)+f*(o*s-a*c),r[8]=i*(l*g-m*v)-f*(u*g-s*v)+h*(u*m-s*l),r[9]=-(e*(l*g-m*v)-f*(n*g-a*v)+h*(n*m-a*l)),r[10]=e*(u*g-s*v)-i*(n*g-a*v)+h*(n*s-a*u),r[11]=-(e*(u*m-s*l)-i*(n*m-a*l)+f*(n*s-a*u)),r[12]=-(i*(l*p-d*v)-f*(u*p-c*v)+h*(u*d-c*l)),r[13]=e*(l*p-d*v)-f*(n*p-o*v)+h*(n*d-o*l),r[14]=-(e*(u*p-c*v)-i*(n*p-o*v)+h*(n*c-o*u)),r[15]=e*(u*d-c*l)-i*(n*d-o*l)+f*(n*c-o*u),r}function m(r){var t=r[0],e=r[1],n=r[2],o=r[3],a=r[4],i=r[5],u=r[6],c=r[7],s=r[8],f=r[9],l=r[10],d=r[11],m=r[12],h=r[13],v=r[14],p=r[15];return(t*i-e*a)*(l*p-d*v)-(t*u-n*a)*(f*p-d*h)+(t*c-o*a)*(f*v-l*h)+(e*u-n*i)*(s*p-d*m)-(e*c-o*i)*(s*v-l*m)+(n*c-o*u)*(s*h-f*m)}function h(r,t,e){var n=t[0],o=t[1],a=t[2],i=t[3],u=t[4],c=t[5],s=t[6],f=t[7],l=t[8],d=t[9],m=t[10],h=t[11],v=t[12],p=t[13],g=t[14],T=t[15],M=e[0],E=e[1],b=e[2],x=e[3];return r[0]=M*n+E*u+b*l+x*v,r[1]=M*o+E*c+b*d+x*p,r[2]=M*a+E*s+b*m+x*g,r[3]=M*i+E*f+b*h+x*T,M=e[4],E=e[5],b=e[6],x=e[7],r[4]=M*n+E*u+b*l+x*v,r[5]=M*o+E*c+b*d+x*p,r[6]=M*a+E*s+b*m+x*g,r[7]=M*i+E*f+b*h+x*T,M=e[8],E=e[9],b=e[10],x=e[11],r[8]=M*n+E*u+b*l+x*v,r[9]=M*o+E*c+b*d+x*p,r[10]=M*a+E*s+b*m+x*g,r[11]=M*i+E*f+b*h+x*T,M=e[12],E=e[13],b=e[14],x=e[15],r[12]=M*n+E*u+b*l+x*v,r[13]=M*o+E*c+b*d+x*p,r[14]=M*a+E*s+b*m+x*g,r[15]=M*i+E*f+b*h+x*T,r}function v(r,t,e){var n,o,a,i,u,c,s,f,l,d,m,h,v=e[0],p=e[1],g=e[2];return t===r?(r[12]=t[0]*v+t[4]*p+t[8]*g+t[12],r[13]=t[1]*v+t[5]*p+t[9]*g+t[13],r[14]=t[2]*v+t[6]*p+t[10]*g+t[14],r[15]=t[3]*v+t[7]*p+t[11]*g+t[15]):(n=t[0],o=t[1],a=t[2],i=t[3],u=t[4],c=t[5],s=t[6],f=t[7],l=t[8],d=t[9],m=t[10],h=t[11],r[0]=n,r[1]=o,r[2]=a,r[3]=i,r[4]=u,r[5]=c,r[6]=s,r[7]=f,r[8]=l,r[9]=d,r[10]=m,r[11]=h,r[12]=n*v+u*p+l*g+t[12],r[13]=o*v+c*p+d*g+t[13],r[14]=a*v+s*p+m*g+t[14],r[15]=i*v+f*p+h*g+t[15]),r}function p(r,t,e){var n=e[0],o=e[1],a=e[2];return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*o,r[5]=t[5]*o,r[6]=t[6]*o,r[7]=t[7]*o,r[8]=t[8]*a,r[9]=t[9]*a,r[10]=t[10]*a,r[11]=t[11]*a,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function g(r,t,e,o){var a,i,u,c,s,f,l,d,m,h,v,p,g,T,M,E,b,x,w,R,_,C,y,F,A=o[0],P=o[1],D=o[2],L=Math.sqrt(A*A+P*P+D*D);return L<n.b?null:(A*=L=1/L,P*=L,D*=L,a=Math.sin(e),u=1-(i=Math.cos(e)),c=t[0],s=t[1],f=t[2],l=t[3],d=t[4],m=t[5],h=t[6],v=t[7],p=t[8],g=t[9],T=t[10],M=t[11],E=A*A*u+i,b=P*A*u+D*a,x=D*A*u-P*a,w=A*P*u-D*a,R=P*P*u+i,_=D*P*u+A*a,C=A*D*u+P*a,y=P*D*u-A*a,F=D*D*u+i,r[0]=c*E+d*b+p*x,r[1]=s*E+m*b+g*x,r[2]=f*E+h*b+T*x,r[3]=l*E+v*b+M*x,r[4]=c*w+d*R+p*_,r[5]=s*w+m*R+g*_,r[6]=f*w+h*R+T*_,r[7]=l*w+v*R+M*_,r[8]=c*C+d*y+p*F,r[9]=s*C+m*y+g*F,r[10]=f*C+h*y+T*F,r[11]=l*C+v*y+M*F,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function T(r,t,e){var n=Math.sin(e),o=Math.cos(e),a=t[4],i=t[5],u=t[6],c=t[7],s=t[8],f=t[9],l=t[10],d=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=a*o+s*n,r[5]=i*o+f*n,r[6]=u*o+l*n,r[7]=c*o+d*n,r[8]=s*o-a*n,r[9]=f*o-i*n,r[10]=l*o-u*n,r[11]=d*o-c*n,r}function M(r,t,e){var n=Math.sin(e),o=Math.cos(e),a=t[0],i=t[1],u=t[2],c=t[3],s=t[8],f=t[9],l=t[10],d=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=a*o-s*n,r[1]=i*o-f*n,r[2]=u*o-l*n,r[3]=c*o-d*n,r[8]=a*n+s*o,r[9]=i*n+f*o,r[10]=u*n+l*o,r[11]=c*n+d*o,r}function E(r,t,e){var n=Math.sin(e),o=Math.cos(e),a=t[0],i=t[1],u=t[2],c=t[3],s=t[4],f=t[5],l=t[6],d=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=a*o+s*n,r[1]=i*o+f*n,r[2]=u*o+l*n,r[3]=c*o+d*n,r[4]=s*o-a*n,r[5]=f*o-i*n,r[6]=l*o-u*n,r[7]=d*o-c*n,r}function b(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function x(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function w(r,t,e){var o,a,i,u=e[0],c=e[1],s=e[2],f=Math.sqrt(u*u+c*c+s*s);return f<n.b?null:(u*=f=1/f,c*=f,s*=f,o=Math.sin(t),i=1-(a=Math.cos(t)),r[0]=u*u*i+a,r[1]=c*u*i+s*o,r[2]=s*u*i-c*o,r[3]=0,r[4]=u*c*i-s*o,r[5]=c*c*i+a,r[6]=s*c*i+u*o,r[7]=0,r[8]=u*s*i+c*o,r[9]=c*s*i-u*o,r[10]=s*s*i+a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function R(r,t){var e=Math.sin(t),n=Math.cos(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=e,r[7]=0,r[8]=0,r[9]=-e,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function _(r,t){var e=Math.sin(t),n=Math.cos(t);return r[0]=n,r[1]=0,r[2]=-e,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=e,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function C(r,t){var e=Math.sin(t),n=Math.cos(t);return r[0]=n,r[1]=e,r[2]=0,r[3]=0,r[4]=-e,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function y(r,t,e){var n=t[0],o=t[1],a=t[2],i=t[3],u=n+n,c=o+o,s=a+a,f=n*u,l=n*c,d=n*s,m=o*c,h=o*s,v=a*s,p=i*u,g=i*c,T=i*s;return r[0]=1-(m+v),r[1]=l+T,r[2]=d-g,r[3]=0,r[4]=l-T,r[5]=1-(f+v),r[6]=h+p,r[7]=0,r[8]=d+g,r[9]=h-p,r[10]=1-(f+m),r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function F(r,t){var e=new n.a(3),o=-t[0],a=-t[1],i=-t[2],u=t[3],c=t[4],s=t[5],f=t[6],l=t[7],d=o*o+a*a+i*i+u*u;return d>0?(e[0]=2*(c*u+l*o+s*i-f*a)/d,e[1]=2*(s*u+l*a+f*o-c*i)/d,e[2]=2*(f*u+l*i+c*a-s*o)/d):(e[0]=2*(c*u+l*o+s*i-f*a),e[1]=2*(s*u+l*a+f*o-c*i),e[2]=2*(f*u+l*i+c*a-s*o)),y(r,t,e),r}function A(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function P(r,t){var e=t[0],n=t[1],o=t[2],a=t[4],i=t[5],u=t[6],c=t[8],s=t[9],f=t[10];return r[0]=Math.sqrt(e*e+n*n+o*o),r[1]=Math.sqrt(a*a+i*i+u*u),r[2]=Math.sqrt(c*c+s*s+f*f),r}function D(r,t){var e=t[0]+t[5]+t[10],n=0;return e>0?(n=2*Math.sqrt(e+1),r[3]=.25*n,r[0]=(t[6]-t[9])/n,r[1]=(t[8]-t[2])/n,r[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),r[3]=(t[6]-t[9])/n,r[0]=.25*n,r[1]=(t[1]+t[4])/n,r[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),r[3]=(t[8]-t[2])/n,r[0]=(t[1]+t[4])/n,r[1]=.25*n,r[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),r[3]=(t[1]-t[4])/n,r[0]=(t[8]+t[2])/n,r[1]=(t[6]+t[9])/n,r[2]=.25*n),r}function L(r,t,e,n){var o=t[0],a=t[1],i=t[2],u=t[3],c=o+o,s=a+a,f=i+i,l=o*c,d=o*s,m=o*f,h=a*s,v=a*f,p=i*f,g=u*c,T=u*s,M=u*f,E=n[0],b=n[1],x=n[2];return r[0]=(1-(h+p))*E,r[1]=(d+M)*E,r[2]=(m-T)*E,r[3]=0,r[4]=(d-M)*b,r[5]=(1-(l+p))*b,r[6]=(v+g)*b,r[7]=0,r[8]=(m+T)*x,r[9]=(v-g)*x,r[10]=(1-(l+h))*x,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function S(r,t,e,n,o){var a=t[0],i=t[1],u=t[2],c=t[3],s=a+a,f=i+i,l=u+u,d=a*s,m=a*f,h=a*l,v=i*f,p=i*l,g=u*l,T=c*s,M=c*f,E=c*l,b=n[0],x=n[1],w=n[2],R=o[0],_=o[1],C=o[2],y=(1-(v+g))*b,F=(m+E)*b,A=(h-M)*b,P=(m-E)*x,D=(1-(d+g))*x,L=(p+T)*x,S=(h+M)*w,U=(p-T)*w,B=(1-(d+v))*w;return r[0]=y,r[1]=F,r[2]=A,r[3]=0,r[4]=P,r[5]=D,r[6]=L,r[7]=0,r[8]=S,r[9]=U,r[10]=B,r[11]=0,r[12]=e[0]+R-(y*R+P*_+S*C),r[13]=e[1]+_-(F*R+D*_+U*C),r[14]=e[2]+C-(A*R+L*_+B*C),r[15]=1,r}function U(r,t){var e=t[0],n=t[1],o=t[2],a=t[3],i=e+e,u=n+n,c=o+o,s=e*i,f=n*i,l=n*u,d=o*i,m=o*u,h=o*c,v=a*i,p=a*u,g=a*c;return r[0]=1-l-h,r[1]=f+g,r[2]=d-p,r[3]=0,r[4]=f-g,r[5]=1-s-h,r[6]=m+v,r[7]=0,r[8]=d+p,r[9]=m-v,r[10]=1-s-l,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function B(r,t,e,n,o,a,i){var u=1/(e-t),c=1/(o-n),s=1/(a-i);return r[0]=2*a*u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*a*c,r[6]=0,r[7]=0,r[8]=(e+t)*u,r[9]=(o+n)*c,r[10]=(i+a)*s,r[11]=-1,r[12]=0,r[13]=0,r[14]=i*a*2*s,r[15]=0,r}function I(r,t,e,n,o){var a,i=1/Math.tan(t/2);return r[0]=i/e,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=o&&o!==1/0?(a=1/(n-o),r[10]=(o+n)*a,r[14]=2*o*n*a):(r[10]=-1,r[14]=-2*n),r}function z(r,t,e,n){var o=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),c=2/(i+u),s=2/(o+a);return r[0]=c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=-(i-u)*c*.5,r[9]=(o-a)*s*.5,r[10]=n/(e-n),r[11]=-1,r[12]=0,r[13]=0,r[14]=n*e/(e-n),r[15]=0,r}function N(r,t,e,n,o,a,i){var u=1/(t-e),c=1/(n-o),s=1/(a-i);return r[0]=-2*u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*s,r[11]=0,r[12]=(t+e)*u,r[13]=(o+n)*c,r[14]=(i+a)*s,r[15]=1,r}function O(r,t,e,o){var a,i,u,c,f,l,d,m,h,v,p=t[0],g=t[1],T=t[2],M=o[0],E=o[1],b=o[2],x=e[0],w=e[1],R=e[2];return Math.abs(p-x)<n.b&&Math.abs(g-w)<n.b&&Math.abs(T-R)<n.b?s(r):(d=p-x,m=g-w,h=T-R,a=E*(h*=v=1/Math.sqrt(d*d+m*m+h*h))-b*(m*=v),i=b*(d*=v)-M*h,u=M*m-E*d,(v=Math.sqrt(a*a+i*i+u*u))?(a*=v=1/v,i*=v,u*=v):(a=0,i=0,u=0),c=m*u-h*i,f=h*a-d*u,l=d*i-m*a,(v=Math.sqrt(c*c+f*f+l*l))?(c*=v=1/v,f*=v,l*=v):(c=0,f=0,l=0),r[0]=a,r[1]=c,r[2]=d,r[3]=0,r[4]=i,r[5]=f,r[6]=m,r[7]=0,r[8]=u,r[9]=l,r[10]=h,r[11]=0,r[12]=-(a*p+i*g+u*T),r[13]=-(c*p+f*g+l*T),r[14]=-(d*p+m*g+h*T),r[15]=1,r)}function X(r,t,e,n){var o=t[0],a=t[1],i=t[2],u=n[0],c=n[1],s=n[2],f=o-e[0],l=a-e[1],d=i-e[2],m=f*f+l*l+d*d;m>0&&(f*=m=1/Math.sqrt(m),l*=m,d*=m);var h=c*d-s*l,v=s*f-u*d,p=u*l-c*f;return(m=h*h+v*v+p*p)>0&&(h*=m=1/Math.sqrt(m),v*=m,p*=m),r[0]=h,r[1]=v,r[2]=p,r[3]=0,r[4]=l*p-d*v,r[5]=d*h-f*p,r[6]=f*v-l*h,r[7]=0,r[8]=f,r[9]=l,r[10]=d,r[11]=0,r[12]=o,r[13]=a,r[14]=i,r[15]=1,r}function k(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function V(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2)+Math.pow(r[3],2)+Math.pow(r[4],2)+Math.pow(r[5],2)+Math.pow(r[6],2)+Math.pow(r[7],2)+Math.pow(r[8],2)+Math.pow(r[9],2)+Math.pow(r[10],2)+Math.pow(r[11],2)+Math.pow(r[12],2)+Math.pow(r[13],2)+Math.pow(r[14],2)+Math.pow(r[15],2))}function q(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r[3]=t[3]+e[3],r[4]=t[4]+e[4],r[5]=t[5]+e[5],r[6]=t[6]+e[6],r[7]=t[7]+e[7],r[8]=t[8]+e[8],r[9]=t[9]+e[9],r[10]=t[10]+e[10],r[11]=t[11]+e[11],r[12]=t[12]+e[12],r[13]=t[13]+e[13],r[14]=t[14]+e[14],r[15]=t[15]+e[15],r}function j(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r[3]=t[3]-e[3],r[4]=t[4]-e[4],r[5]=t[5]-e[5],r[6]=t[6]-e[6],r[7]=t[7]-e[7],r[8]=t[8]-e[8],r[9]=t[9]-e[9],r[10]=t[10]-e[10],r[11]=t[11]-e[11],r[12]=t[12]-e[12],r[13]=t[13]-e[13],r[14]=t[14]-e[14],r[15]=t[15]-e[15],r}function W(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*e,r[5]=t[5]*e,r[6]=t[6]*e,r[7]=t[7]*e,r[8]=t[8]*e,r[9]=t[9]*e,r[10]=t[10]*e,r[11]=t[11]*e,r[12]=t[12]*e,r[13]=t[13]*e,r[14]=t[14]*e,r[15]=t[15]*e,r}function G(r,t,e,n){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r[3]=t[3]+e[3]*n,r[4]=t[4]+e[4]*n,r[5]=t[5]+e[5]*n,r[6]=t[6]+e[6]*n,r[7]=t[7]+e[7]*n,r[8]=t[8]+e[8]*n,r[9]=t[9]+e[9]*n,r[10]=t[10]+e[10]*n,r[11]=t[11]+e[11]*n,r[12]=t[12]+e[12]*n,r[13]=t[13]+e[13]*n,r[14]=t[14]+e[14]*n,r[15]=t[15]+e[15]*n,r}function H(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]}function Y(r,t){var e=r[0],o=r[1],a=r[2],i=r[3],u=r[4],c=r[5],s=r[6],f=r[7],l=r[8],d=r[9],m=r[10],h=r[11],v=r[12],p=r[13],g=r[14],T=r[15],M=t[0],E=t[1],b=t[2],x=t[3],w=t[4],R=t[5],_=t[6],C=t[7],y=t[8],F=t[9],A=t[10],P=t[11],D=t[12],L=t[13],S=t[14],U=t[15];return Math.abs(e-M)<=n.b*Math.max(1,Math.abs(e),Math.abs(M))&&Math.abs(o-E)<=n.b*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-b)<=n.b*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(i-x)<=n.b*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(u-w)<=n.b*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(c-R)<=n.b*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(s-_)<=n.b*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(f-C)<=n.b*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(l-y)<=n.b*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(d-F)<=n.b*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(m-A)<=n.b*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(h-P)<=n.b*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(v-D)<=n.b*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(p-L)<=n.b*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(g-S)<=n.b*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(T-U)<=n.b*Math.max(1,Math.abs(T),Math.abs(U))}var Q=h,Z=j},function(r,t,e){"use strict";e.r(t),e.d(t,"create",function(){return o}),e.d(t,"clone",function(){return a}),e.d(t,"length",function(){return i}),e.d(t,"fromValues",function(){return u}),e.d(t,"copy",function(){return c}),e.d(t,"set",function(){return s}),e.d(t,"add",function(){return f}),e.d(t,"subtract",function(){return l}),e.d(t,"multiply",function(){return d}),e.d(t,"divide",function(){return m}),e.d(t,"ceil",function(){return h}),e.d(t,"floor",function(){return v}),e.d(t,"min",function(){return p}),e.d(t,"max",function(){return g}),e.d(t,"round",function(){return T}),e.d(t,"scale",function(){return M}),e.d(t,"scaleAndAdd",function(){return E}),e.d(t,"distance",function(){return b}),e.d(t,"squaredDistance",function(){return x}),e.d(t,"squaredLength",function(){return w}),e.d(t,"negate",function(){return R}),e.d(t,"inverse",function(){return _}),e.d(t,"normalize",function(){return C}),e.d(t,"dot",function(){return y}),e.d(t,"cross",function(){return F}),e.d(t,"lerp",function(){return A}),e.d(t,"hermite",function(){return P}),e.d(t,"bezier",function(){return D}),e.d(t,"random",function(){return L}),e.d(t,"transformMat4",function(){return S}),e.d(t,"transformMat3",function(){return U}),e.d(t,"transformQuat",function(){return B}),e.d(t,"rotateX",function(){return I}),e.d(t,"rotateY",function(){return z}),e.d(t,"rotateZ",function(){return N}),e.d(t,"angle",function(){return O}),e.d(t,"zero",function(){return X}),e.d(t,"str",function(){return k}),e.d(t,"exactEquals",function(){return V}),e.d(t,"equals",function(){return q}),e.d(t,"sub",function(){return W}),e.d(t,"mul",function(){return G}),e.d(t,"div",function(){return H}),e.d(t,"dist",function(){return Y}),e.d(t,"sqrDist",function(){return Q}),e.d(t,"len",function(){return Z}),e.d(t,"sqrLen",function(){return $}),e.d(t,"forEach",function(){return K});var n=e(0);function o(){var r=new n.a(3);return n.a!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function a(r){var t=new n.a(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function i(r){var t=r[0],e=r[1],n=r[2];return Math.sqrt(t*t+e*e+n*n)}function u(r,t,e){var o=new n.a(3);return o[0]=r,o[1]=t,o[2]=e,o}function c(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function s(r,t,e,n){return r[0]=t,r[1]=e,r[2]=n,r}function f(r,t,e){return r[0]=t[0]+e[0],r[1]=t[1]+e[1],r[2]=t[2]+e[2],r}function l(r,t,e){return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],r}function d(r,t,e){return r[0]=t[0]*e[0],r[1]=t[1]*e[1],r[2]=t[2]*e[2],r}function m(r,t,e){return r[0]=t[0]/e[0],r[1]=t[1]/e[1],r[2]=t[2]/e[2],r}function h(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function v(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function p(r,t,e){return r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.min(t[2],e[2]),r}function g(r,t,e){return r[0]=Math.max(t[0],e[0]),r[1]=Math.max(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r}function T(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function M(r,t,e){return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r}function E(r,t,e,n){return r[0]=t[0]+e[0]*n,r[1]=t[1]+e[1]*n,r[2]=t[2]+e[2]*n,r}function b(r,t){var e=t[0]-r[0],n=t[1]-r[1],o=t[2]-r[2];return Math.sqrt(e*e+n*n+o*o)}function x(r,t){var e=t[0]-r[0],n=t[1]-r[1],o=t[2]-r[2];return e*e+n*n+o*o}function w(r){var t=r[0],e=r[1],n=r[2];return t*t+e*e+n*n}function R(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function _(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function C(r,t){var e=t[0],n=t[1],o=t[2],a=e*e+n*n+o*o;return a>0&&(a=1/Math.sqrt(a)),r[0]=t[0]*a,r[1]=t[1]*a,r[2]=t[2]*a,r}function y(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function F(r,t,e){var n=t[0],o=t[1],a=t[2],i=e[0],u=e[1],c=e[2];return r[0]=o*c-a*u,r[1]=a*i-n*c,r[2]=n*u-o*i,r}function A(r,t,e,n){var o=t[0],a=t[1],i=t[2];return r[0]=o+n*(e[0]-o),r[1]=a+n*(e[1]-a),r[2]=i+n*(e[2]-i),r}function P(r,t,e,n,o,a){var i=a*a,u=i*(2*a-3)+1,c=i*(a-2)+a,s=i*(a-1),f=i*(3-2*a);return r[0]=t[0]*u+e[0]*c+n[0]*s+o[0]*f,r[1]=t[1]*u+e[1]*c+n[1]*s+o[1]*f,r[2]=t[2]*u+e[2]*c+n[2]*s+o[2]*f,r}function D(r,t,e,n,o,a){var i=1-a,u=i*i,c=a*a,s=u*i,f=3*a*u,l=3*c*i,d=c*a;return r[0]=t[0]*s+e[0]*f+n[0]*l+o[0]*d,r[1]=t[1]*s+e[1]*f+n[1]*l+o[1]*d,r[2]=t[2]*s+e[2]*f+n[2]*l+o[2]*d,r}function L(r,t){t=t||1;var e=2*n.c()*Math.PI,o=2*n.c()-1,a=Math.sqrt(1-o*o)*t;return r[0]=Math.cos(e)*a,r[1]=Math.sin(e)*a,r[2]=o*t,r}function S(r,t,e){var n=t[0],o=t[1],a=t[2],i=e[3]*n+e[7]*o+e[11]*a+e[15];return i=i||1,r[0]=(e[0]*n+e[4]*o+e[8]*a+e[12])/i,r[1]=(e[1]*n+e[5]*o+e[9]*a+e[13])/i,r[2]=(e[2]*n+e[6]*o+e[10]*a+e[14])/i,r}function U(r,t,e){var n=t[0],o=t[1],a=t[2];return r[0]=n*e[0]+o*e[3]+a*e[6],r[1]=n*e[1]+o*e[4]+a*e[7],r[2]=n*e[2]+o*e[5]+a*e[8],r}function B(r,t,e){var n=e[0],o=e[1],a=e[2],i=e[3],u=t[0],c=t[1],s=t[2],f=o*s-a*c,l=a*u-n*s,d=n*c-o*u,m=o*d-a*l,h=a*f-n*d,v=n*l-o*f,p=2*i;return f*=p,l*=p,d*=p,m*=2,h*=2,v*=2,r[0]=u+f+m,r[1]=c+l+h,r[2]=s+d+v,r}function I(r,t,e,n){var o=[],a=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],a[0]=o[0],a[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),a[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),r[0]=a[0]+e[0],r[1]=a[1]+e[1],r[2]=a[2]+e[2],r}function z(r,t,e,n){var o=[],a=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],a[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),a[1]=o[1],a[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),r[0]=a[0]+e[0],r[1]=a[1]+e[1],r[2]=a[2]+e[2],r}function N(r,t,e,n){var o=[],a=[];return o[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],a[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),a[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),a[2]=o[2],r[0]=a[0]+e[0],r[1]=a[1]+e[1],r[2]=a[2]+e[2],r}function O(r,t){var e=u(r[0],r[1],r[2]),n=u(t[0],t[1],t[2]);C(e,e),C(n,n);var o=y(e,n);return o>1?0:o<-1?Math.PI:Math.acos(o)}function X(r){return r[0]=0,r[1]=0,r[2]=0,r}function k(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function V(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function q(r,t){var e=r[0],o=r[1],a=r[2],i=t[0],u=t[1],c=t[2];return Math.abs(e-i)<=n.b*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(o-u)<=n.b*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(a-c)<=n.b*Math.max(1,Math.abs(a),Math.abs(c))}var j,W=l,G=d,H=m,Y=b,Q=x,Z=i,$=w,K=(j=o(),function(r,t,e,n,o,a){var i,u;for(t||(t=3),e||(e=0),u=n?Math.min(n*t+e,r.length):r.length,i=e;i<u;i+=t)j[0]=r[i],j[1]=r[i+1],j[2]=r[i+2],o(j,j,a),r[i]=j[0],r[i+1]=j[1],r[i+2]=j[2];return r})},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e(1),o=e(2);function a(r,t,e){const n=r.createShader(t);return n?(r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(console.log(e),console.warn(r.getShaderInfoLog(n)),r.deleteShader(n),null)):null}function i(r,t,e){const n=r.createBuffer();return r.bindBuffer(t,n),r.bufferData(t,e,r.STATIC_DRAW),n}t.loadTexture=async function(r,t){const e=await new Promise((r,e)=>{const n=new Image;n.src=t,n.onload=(()=>r(n)),n.onerror=e}),n=r.createTexture(),o=r=>0==(r&r-1);return r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,1),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),o(e.width)&&o(e.height)||(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),n},t.createProgram=function(r,t,e){const n=a(r,r.VERTEX_SHADER,t),o=a(r,r.FRAGMENT_SHADER,e),i=r.createProgram();if(!i||!n||!o)throw new Error("Failed to create shader program");if(r.attachShader(i,n),r.attachShader(i,o),r.linkProgram(i),!r.getProgramParameter(i,r.LINK_STATUS))throw console.warn(r.getProgramInfoLog(i)),new Error("Can not creat program");const u={},c={},s=r.getProgramParameter(i,r.ACTIVE_ATTRIBUTES),f=r.getProgramParameter(i,r.ACTIVE_UNIFORMS);for(let t=0;t<s;t++){const e=r.getActiveAttrib(i,t).name;u[e]=r.getAttribLocation(i,e)}for(let t=0;t<f;t++){const e=r.getActiveUniform(i,t).name;c[e]=r.getUniformLocation(i,e)}return{program:i,uniforms:c,attributes:u,gl:r}},t.createMatrices=function(r){const t=n.create(),e=n.create(),a=n.create();n.perspective(t,Math.PI/4,r.aspect,.1,r.far||2e3);const i=o.clone(r.camera.position),u=o.clone(r.camera.center);return r.flip&&(u[2]=-u[2],i[2]=-i[2]),n.lookAt(e,i,u,[0,0,1]),{model:a,projection:t,view:e}},t.createBuffer=i,t.bindBuffer=function(r,t,e,n){r.bindBuffer(r.ARRAY_BUFFER,t),r.vertexAttribPointer(e,n,r.FLOAT,!1,0,0),r.enableVertexAttribArray(e)},t.bindArraysToBuffers=function(r,t){const{arrays:e,textures:n={},framebuffers:o={}}=t;return{buffers:{position:i(r,r.ARRAY_BUFFER,new Float32Array(e.position)),colors:i(r,r.ARRAY_BUFFER,new Float32Array(e.colors)),indices:i(r,r.ELEMENT_ARRAY_BUFFER,new Uint16Array(e.indices)),normal:i(r,r.ARRAY_BUFFER,new Float32Array(e.normals)),texture:i(r,r.ARRAY_BUFFER,new Float32Array(e.texture))},textures:n,framebuffers:o,size:e.indices.length}},t.createFramebufferAndTexture=function(r,t,e,n=!1){const o=r.createTexture(),a=r.createTexture(),i=r.createFramebuffer(),u=r.createRenderbuffer();return r.bindFramebuffer(r.FRAMEBUFFER,i),r.bindTexture(r.TEXTURE_2D,o),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,e,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,o,0),n?(r.getExtension("WEBGL_depth_texture")||console.warn("WEBGL_depth_texture is not supported"),r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,r.DEPTH_COMPONENT,t,e,0,r.DEPTH_COMPONENT,r.UNSIGNED_SHORT,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,a,0)):(r.bindRenderbuffer(r.RENDERBUFFER,u),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,t,e),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,u)),r.bindFramebuffer(r.FRAMEBUFFER,null),{colorTexture:o,depthTexture:a,framebuffer:i,depthRenderBuffer:u}},t.inRange=function(r,t,e){return r<t?t:r>e?e:r},t.toggleViaQS=((r,t)=>window.location.search.includes(r)?!t:t)},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e(2),o=e(3),a=e(5),i={app:{active:!0,autoPilot:o.toggleViaQS("ap",!1)},camera:{center:n.fromValues(270,330,87),position:n.fromValues(330,414,84)},terrain:{visible:!0},water:{start:Date.now(),time:0,visible:!0,useReflection:o.toggleViaQS("rfl",!0),useRefraction:o.toggleViaQS("rfr",!0)},light:{direction:n.fromValues(0,0,0),color:n.fromValues(0,0,0)},sky:{dayTime:324e5,visible:!0,sunPosition:n.fromValues(0,0,0),autoSunMove:o.toggleViaQS("asm",!1)}};t.getInitialState=(()=>(u(i,i.sky.dayTime),i)),t.toggle=((r,t,e)=>{r[t][e]=!r[t][e]}),t.zoom=((r,t)=>{const{position:e,center:a}=r.camera,i=n.create(),u=n.distance(a,e),c=o.inRange(u+t,50,1e3);n.sub(i,e,a),n.scale(i,i,c/u),n.add(e,a,i)}),t.moveCamera=((r,t)=>{const{position:e,center:o}=r.camera,a=n.create(),i=n.create(),u=n.create();n.sub(a,o,e),n.rotateZ(i,a,[0,0,1],Math.PI/2),i[2]=0,t.forward>0&&n.add(u,u,a),t.forward<0&&n.sub(u,u,a),t.left>0&&n.add(u,u,i),t.left<0&&n.sub(u,u,i),n.normalize(u,u),n.add(u,u,[0,0,t.up]),n.scale(u,u,6),n.add(e,e,u),n.add(o,o,u)}),t.rotateCamera=((r,t,e)=>{const{position:o,center:a}=r.camera,i=n.create();n.sub(i,a,o);const u=n.length(i);n.rotateZ(i,i,[0,0,0],t),i[2]-=e,n.normalize(i,i),n.scale(i,i,u),n.add(a,o,i)}),t.moveSun=((r,t)=>{let e=r.sky.dayTime+t;e<0?e+=864e5:e>864e5&&(e-=864e5),u(r,e)}),t.autoMoveSun=((r,e)=>{r.sky.autoSunMove&&t.moveSun(r,e)}),t.updateWaterTime=(r=>{r.water.time=Date.now()-r.water.start}),t.autoPilot=(r=>{r.app.autoPilot&&t.rotateCamera(r,.003,0)});const u=(r,t)=>{const{sunPosition:e,directionalLightColor:n,directionalLightVector:o}=a.getSunPosition(t);r.sky.dayTime=t,r.sky.sunPosition=e,r.light.color=n,r.light.direction=o}},function(r,t,e){"use strict";var n=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(t,"__esModule",{value:!0});const o=e(2),a=e(1),i=e(3),u=n(e(11)),c=n(e(12)),{cos:s,sin:f,tan:l,PI:d}=Math;function m(r){return function(t){const{gl:e,program:n,sun:o,size:u}=r,{state:c,aspect:s,flip:f=!1}=t,{projection:l,model:d,view:m}=i.createMatrices({camera:c.camera,aspect:s,flip:f,far:1.1*u}),[h,v,p]=c.camera.position;a.translate(d,d,[h,v,f?-p:p]),a.scale(d,d,[u,u,u]),e.useProgram(n.program),i.bindBuffer(e,o.buffers.position,n.attributes.position,3),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o.buffers.indices),e.uniform3fv(n.uniforms.sunPosition,c.sky.sunPosition),e.uniform3fv(n.uniforms.cameraPosition,c.camera.position),e.uniformMatrix4fv(n.uniforms.projection,!1,l),e.uniformMatrix4fv(n.uniforms.view,!1,m),e.uniformMatrix4fv(n.uniforms.model,!1,d),e.drawElements(e.TRIANGLES,o.size,e.UNSIGNED_SHORT,0)}}function h(){const r=50,t=[],e=[];for(let n=0;n<=r;n++){const o=d/r*n-d/2;for(let a=0;a<r;a++){const i=2*d/r*a,u=s(i)*s(o),c=f(i)*s(o),l=f(o),m=n*r+a;t.push(u,c,l),n!==r&&(49===a?e.push(n*r,m+r,m,m+r,m+1,n*r):e.push(m,m+1,m+r,m+1,m+r,m+r+1))}}return{position:t,indices:e}}function v(r){return("00"+r).slice(-2)}t.createSky=function(r,t){const e=i.createProgram(r,u.default,c.default);return{render:m({gl:r,sun:i.bindArraysToBuffers(r,{arrays:h()}),program:e,size:t.size})}},t.sunTimeToString=function(r){const t=Math.ceil(r/60/1e3),e=t%60;return`${v(Math.floor(t/60))}:${v(e)}`},t.getSunPosition=function(r){const t=r%864e5,e=function(r){return l(-4.83049e-16*r*r+4.21414e-8*r-.420437)}(t),n=function(r){return 7.344052639206152e-8*r-.1829595519336553}(t),a=s(e)*s(n),u=s(e)*f(n),c=f(e),d=o.fromValues(a,-u,c),m=o.fromValues(1,1,1),h=o.create(),v=i.inRange(3*c,0,1);return o.negate(h,d),o.scale(m,m,v),{sunPosition:o.fromValues(a,-u,c),directionalLightColor:m,directionalLightVector:h}}},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e(7),o=e(10),a=e(13),i=e(5),u=e(4);window.addEventListener("load",async function(){const r=document.querySelector("canvas");r.style.width=c+"px",r.style.height=c+"px",r.width=s,r.height=f;const t=r.getContext("experimental-webgl");if(!t)return void console.warn("Can not create webgl context");const e=await n.createTerrain(t,{heatmap:"heightmaps/terrain5.png",chunkSize:20/h,baseLevel:120,size:[l,l,200]}),v=await a.createWater(t,{size:d}),p=i.createSky(t,{size:m}),g=u.getInitialState();o.initControls(r,g),function r(){if(!g.app.active)return requestAnimationFrame(r);u.updateWaterTime(g);u.autoMoveSun(g,1e5);u.autoPilot(g);!function(r){const t=s/f,{gl:e,terrain:n,water:o,sky:a,state:i}=r,u={state:i,aspect:t};e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),i.water.visible&&(o.updateReflectionTexture(()=>{i.sky.visible&&a.render({...u,flip:!0}),i.terrain.visible&&n.render({...u,clipDirection:-1,flip:!0})}),o.updateRefractionTexture(()=>{i.terrain.visible&&n.render({...u,clipDirection:1})}));e.viewport(0,0,s,f),i.water.visible&&o.render(u);i.terrain.visible&&n.render(u);i.sky.visible?a.render(u):e.clearColor(.53,.8,.98,1)}({gl:t,state:g,terrain:e,water:v,sky:p});requestAnimationFrame(r)}()});const c=Math.min(window.innerWidth-1,window.innerHeight-1,1024),s=512,f=512,l=1024,d=1024,m=1024,h=4},function(r,t,e){"use strict";var n=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(t,"__esModule",{value:!0});const o=e(1),a=e(2),i=e(3),u=n(e(8)),c=n(e(9));function s(r){return function(t){const{gl:e,terrain:n,program:a,size:u}=r,{state:c,aspect:s,clipDirection:f=0,clipLevel:l=0,flip:d=!1}=t,{projection:m,model:h,view:v}=i.createMatrices({camera:c.camera,aspect:s,flip:d});o.scale(h,h,u),e.useProgram(a.program),i.bindBuffer(e,n.buffers.position,a.attributes.position,3),i.bindBuffer(e,n.buffers.normal,a.attributes.normal,3),i.bindBuffer(e,n.buffers.colors,a.attributes.colors,4),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.buffers.indices),e.uniformMatrix4fv(a.uniforms.projection,!1,m),e.uniformMatrix4fv(a.uniforms.model,!1,h),e.uniformMatrix4fv(a.uniforms.view,!1,v),e.uniform3fv(a.uniforms.directionalLightVector,c.light.direction),e.uniform3fv(a.uniforms.directionalLightColor,c.light.color),e.uniform1f(a.uniforms.clipDirection,f),e.uniform1f(a.uniforms.clipLevel,l),e.drawElements(e.TRIANGLES,n.size,e.UNSIGNED_SHORT,0)}}t.createTerrain=async function(r,t){const e=await async function(r,t,e=0){const n=document.createElement("canvas"),o=await function(r){return new Promise((t,e)=>{const n=new Image;n.src=r,n.onload=(()=>t(n)),n.onerror=e})}(r);n.width=o.width,n.height=o.height;const i=n.getContext("2d");if(!i)throw new Error("Can not create 2d context");i.drawImage(o,0,0);const{data:u}=i.getImageData(0,0,o.width,o.height),c=new Uint32Array(u),s=Math.floor(o.width/t),f=Math.floor(o.height/t),l=new Float32Array(s*f);let d=0;for(let r=0;r<f;r++)for(let e=0;e<s;e++){let n=0;for(let a=0;a<t;a++)for(let i=0;i<t;i++)n+=c[4*(r*t*o.width+e*t+a*t+i)];const a=n/t/t;l[r*s+e]=a,d<a&&(d=a)}const m=[],h=[],v=[],p=[],g=[];for(let r=0;r<f;r++)for(let t=0;t<s;t++){const n=r*s+t,o=l[n]/d;Number.isFinite(o)||console.log({i:r,j:t,c:o}),m.push(t/s-.5,r/f-.5,(l[n]-e)/d),v.push(o,o,o,1),r!==f-1&&t!==s-1&&h.push(n,n+s,n+1,n+1,n+s,n+s+1),g.push(t/s,r/f)}for(let r=0;r<m.length/3;r++){const t=s,e=f,n=r%t,o=~~(r/t),i=[n>0&&o>0&&[r-t,r-1,r],n+1<t&&o>0&&[r-t,r,r-t+1],n+1<t&&o>0&&[r-t+1,r,r+1],n>0&&o<e&&[r-1,r+t-1,r],n>0&&o<e&&[r,r+t-1,r+t],n+1<t&&o<e&&[r,r+t,r+1]],u=[],c=[];for(let r=0;r<i.length;r++){const t=i[r];for(let r=0;r<3;r++)t&&u.push(m[3*t[r]],m[3*t[r]+1],m[3*t[r]+2])}for(let r=0;r<u.length/9;r++){const t=a.fromValues(u[9*r+0],u[9*r+1],u[9*r+2]),e=a.fromValues(u[9*r+3],u[9*r+4],u[9*r+5]),n=a.fromValues(u[9*r+6],u[9*r+7],u[9*r+8]);a.subtract(e,e,t),a.subtract(n,n,t),a.cross(e,e,n),a.normalize(e,e),c.push(e)}const l=a.fromValues(0,0,0);for(let r=0;r<c.length;r++)a.add(l,l,c[r]);a.normalize(l,l),p.push(l[0],l[1],l[2])}return{position:m,indices:h,colors:v,normals:p,texture:g}}(t.heatmap,t.chunkSize,t.baseLevel),n=i.createProgram(r,u.default,c.default);return{render:s({terrain:i.bindArraysToBuffers(r,{arrays:e}),gl:r,program:n,size:t.size})}}},function(r,t){r.exports="precision lowp float;\r\n\r\nattribute vec4 position;\r\nattribute vec3 normal;\r\nattribute vec4 colors;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 directionalLightVector;\r\nuniform vec3 directionalLightColor;\r\nuniform float clipDirection;\r\nuniform float clipLevel;\r\n\r\nvarying vec3 vLighting;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 fragmentColor;\r\nvarying float shouldClip;\r\n\r\nvoid main() {\r\n  vec3 ambientLight = vec3(0.1, 0.1, 0.1);\r\n  vec3 directionalVector = normalize(directionalLightVector);\r\n\r\n  float directional = max(dot(normal, directionalVector), 0.0);\r\n  vLighting = ambientLight + (directionalLightColor * directional);\r\n\r\n  gl_Position = projection * view * model * position;\r\n\r\n  fragmentColor = colors;\r\n  if (clipDirection == 1.0) {\r\n    shouldClip = position.z > clipLevel ? 1.0 : 0.0;\r\n  } else if (clipDirection == -1.0) {\r\n    shouldClip = position.z < clipLevel ? 1.0 : 0.0;\r\n  } else {\r\n    shouldClip = 0.0;\r\n  }\r\n}"},function(r,t){r.exports="precision lowp float;\r\n\r\nvarying vec3 vLighting;\r\nvarying float shouldClip;\r\nvarying vec4 fragmentColor;\r\n\r\nconst vec4 grassColor = vec4(0.12, 0.43, 0.02, 1.0);\r\nconst vec4 snowColor = vec4(1.0);\r\nconst vec4 groundColor = vec4(0.85, 0.84, 0.79, 1.0);\r\n\r\nvoid main() {\r\n  if (shouldClip == 1.0) {\r\n    discard;\r\n  }\r\n  float x = fragmentColor.x;\r\n  float groundGrassMixFactor = smoothstep(0.1, 0.2, x);\r\n  float grassSnowMixFactor = smoothstep(0.7, 0.8, x);\r\n  vec4 color = mix(groundColor, grassColor, groundGrassMixFactor);\r\n  color = mix(color, snowColor, grassSnowMixFactor);\r\n\r\n  gl_FragColor = vec4(color.rgb * vLighting, color.a);\r\n}\r\n"},function(r,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=e(4);t.initControls=function(r,t){const e=[{id:"terrain",key:"1",getValue:()=>t.terrain.visible,action:()=>n.toggle(t,"terrain","visible")},{id:"water",key:"2",getValue:()=>t.water.visible,action:()=>n.toggle(t,"water","visible")},{id:"refraction",key:"3",getValue:()=>t.water.useRefraction,action:()=>n.toggle(t,"water","useRefraction")},{id:"reflection",key:"4",getValue:()=>t.water.useReflection,action:()=>n.toggle(t,"water","useReflection")},{id:"sky",key:"5",getValue:()=>t.sky.visible,action:()=>n.toggle(t,"sky","visible")},{id:"auto-sun",key:"6",getValue:()=>t.sky.autoSunMove,action:()=>n.toggle(t,"sky","autoSunMove")},{id:"autopilot",key:"7",getValue:()=>t.app.autoPilot,action:()=>n.toggle(t,"app","autoPilot")}],o=r=>{var t,e;const n=document.querySelector(`[data-toggle-id=${r.id}]`);r.getValue()?null===(t=n)||void 0===t||t.setAttribute("checked","checked"):null===(e=n)||void 0===e||e.removeAttribute("checked")};let a,i=!1;const u=new Set,c=()=>{let r=0,e=0,o=0,a=0;u.has("w")&&e++,u.has("s")&&e--,u.has("a")&&r++,u.has("d")&&r--,u.has("e")&&o++,u.has("q")&&o--,u.has("j")&&a--,u.has("k")&&a++,a&&n.moveSun(t,3e5*a),(r||e||o)&&n.moveCamera(t,{left:r,forward:e,up:o}),requestAnimationFrame(c)},s=r=>{for(const t of e)if(r.key===t.key)return t.action(),void o(t);u.add(r.key)},f=r=>{const{deltaY:e}=r;e&&(n.zoom(t,e/Math.abs(e)*10),r.preventDefault())},l=r=>{u.delete(r.key)},d=()=>{i=!0},m=()=>{i=!1},h=r=>{const{movementX:e,movementY:o}=r;i&&n.rotateCamera(t,-e/500,o)},v=r=>{r.preventDefault()},p=r=>{const e=r.touches[0];a&&n.rotateCamera(t,(e.clientX-a.clientX)/500,a.clientY-e.clientY),a=e},g=r=>{a=null};return c(),r.addEventListener("wheel",f),r.addEventListener("mousedown",d),r.addEventListener("contextmenu",v),r.addEventListener("touchmove",p),r.addEventListener("touchstart",g),window.addEventListener("mouseup",m),window.addEventListener("mousemove",h),window.addEventListener("keypress",s),window.addEventListener("keyup",l),e.forEach(r=>{var t;o(r),null===(t=document.querySelector(`[data-toggle-id=${r.id}]`))||void 0===t||t.addEventListener("toggle",r.action)}),{tearDown:()=>{r.removeEventListener("wheel",f),r.removeEventListener("mousedown",d),r.removeEventListener("contextmenu",v),r.removeEventListener("touchmove",p),r.removeEventListener("touchstart",g),window.removeEventListener("mouseup",m),window.removeEventListener("mousemove",h),window.removeEventListener("keypress",s),window.removeEventListener("keyup",l),e.forEach(r=>{var t;null===(t=document.querySelector(`[data-toggle-id=${r.id}]`))||void 0===t||t.removeEventListener("toggle",r.action)})}}}},function(r,t){r.exports="precision lowp float;\r\n\r\nattribute vec4 position;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\n\r\nvarying vec4 worldPosition;\r\n\r\nvoid main() {\r\n    worldPosition = position;\r\n    gl_Position = projection * view * model * worldPosition;\r\n}"},function(r,t){r.exports="// credits https://www.shadertoy.com/view/MsVSWt\r\nprecision highp float;\r\n\r\nuniform vec3 sunPosition;\r\nvarying vec4 worldPosition;\r\n\r\nvec3 getSunColor(\r\n    vec3 position,\r\n    vec3 sun\r\n) {\r\n    float dis = 1.0 - distance(sun, position);\r\n    dis = clamp(dis, 0.01, 1.0);\r\n    float z = clamp(sun.z, 0.0, 1.0);\r\n    float z2 = pow(z, 1.5);\r\n    \r\n    float glow = dis;\r\n    \r\n    dis = pow(dis, 100.0);\r\n    dis *= 10.0;\r\n    dis = clamp(dis, 0.0, 1.0);\r\n    \r\n    glow = pow(glow, z * 12.0);\r\n    glow = clamp(glow, 0.0, 1.0);\r\n    \r\n    dis *= pow(z2, 1.0 / 1.65);\r\n    glow *= pow(z2, 1.0 / 2.0);\r\n    \r\n    dis += glow;\r\n    \r\n    return vec3(1.0,0.6,0.05) * dis;\r\n    \r\n}\r\n\r\nvec3 getFastScattering(vec3 position, vec3 sun) {\r\n    float atmosphere = sqrt(1.0 - position.z);\r\n    vec3 skyColor = vec3(0.2, 0.4, 0.8);\r\n    float scatter = pow(sun.z, 1.0 / 15.0);\r\n    scatter = 1.0 - clamp(scatter, 0.8, 1.0);\r\n    vec3 scatterColor = mix(\r\n        vec3(1.0),\r\n        vec3(1.0, 0.3, 0.0) * 1.5,\r\n        scatter * 2.0\r\n    );\r\n    skyColor = mix(\r\n        skyColor,\r\n        scatterColor,\r\n        atmosphere / 1.3\r\n    );\r\n    skyColor = mix(skyColor, vec3(0.0), clamp(-sun.z * 3.0, 0.0, 1.0));\r\n    return skyColor;\r\n}\r\n\r\nvoid main() {\r\n    vec3 world = normalize(worldPosition.xyz);\r\n    vec3 sun = normalize(sunPosition);\r\n    vec3 color = vec3(0.0);\r\n    color += getSunColor(world, sun);\r\n    color += getFastScattering(world, sun);\r\n\r\n    gl_FragColor = vec4(color, 1.0);\r\n}"},function(r,t,e){"use strict";var n=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(t,"__esModule",{value:!0});const o=e(1),a=e(3),i=n(e(14)),u=n(e(15));function c(r){return function(t){const{gl:e,water:n,size:o}=r;e.bindFramebuffer(e.FRAMEBUFFER,n.framebuffers.reflection),e.viewport(0,0,o,o),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t(),e.bindFramebuffer(e.FRAMEBUFFER,null)}}function s(r){return function(t){const{gl:e,water:n,size:o}=r;e.bindFramebuffer(e.FRAMEBUFFER,n.framebuffers.refraction),e.viewport(0,0,o,o),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),t(),e.bindFramebuffer(e.FRAMEBUFFER,null)}}function f(r){const{size:t,program:e,gl:n,water:i}=r;return n.useProgram(e.program),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,i.textures.dudv),n.uniform1i(e.uniforms.dudvTexture,0),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,i.textures.normalMap),n.uniform1i(e.uniforms.normalMapTexture,1),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,i.textures.refraction),n.uniform1i(e.uniforms.refractionTexture,2),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,i.textures.reflection),n.uniform1i(e.uniforms.reflectionTexture,3),n.activeTexture(n.TEXTURE4),n.bindTexture(n.TEXTURE_2D,i.textures.depth),n.uniform1i(e.uniforms.depthTexture,4),function(r){const{state:u,aspect:c}=r,{projection:s,model:f,view:l}=a.createMatrices({camera:u.camera,aspect:c});o.scale(f,f,[t,t,1]),n.useProgram(e.program),a.bindBuffer(n,i.buffers.position,e.attributes.position,3),a.bindBuffer(n,i.buffers.texture,e.attributes.textureCoord,2),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.buffers.indices),n.uniform1f(e.uniforms.dudvOffset,u.water.time/1e3*.03%1),n.uniform1i(e.uniforms.useRefraction,Number(u.water.useRefraction)),n.uniform1i(e.uniforms.useReflection,Number(u.water.useReflection)),n.uniform3fv(e.uniforms.cameraPosition,u.camera.position),n.uniform3fv(e.uniforms.directionalLightVector,u.light.direction),n.uniform3fv(e.uniforms.directionalLightColor,u.light.color),n.uniformMatrix4fv(e.uniforms.projection,!1,s),n.uniformMatrix4fv(e.uniforms.model,!1,f),n.uniformMatrix4fv(e.uniforms.view,!1,l),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.drawElements(n.TRIANGLES,i.size,n.UNSIGNED_SHORT,0),n.disable(n.BLEND)}}t.createWater=async function(r,t){const{size:e}=t,n=await a.loadTexture(r,"textures/dudvmap.png"),o=await a.loadTexture(r,"textures/normalmap.png"),{colorTexture:l,depthTexture:d,framebuffer:m}=a.createFramebufferAndTexture(r,e,e,!0),{colorTexture:h,framebuffer:v}=a.createFramebufferAndTexture(r,e,e),p={position:[-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0],indices:[0,2,1,1,2,3],texture:[0,0,1,0,0,1,1,1]},g={gl:r,program:a.createProgram(r,i.default,u.default),size:e,water:a.bindArraysToBuffers(r,{arrays:p,framebuffers:{refraction:m,reflection:v},textures:{dudv:n,normalMap:o,refraction:l,reflection:h,depth:d}})};return{render:f(g),updateReflectionTexture:c(g),updateRefractionTexture:s(g)}}},function(r,t){r.exports="precision highp float;\r\n\r\nattribute vec4 position;\r\nattribute vec2 textureCoord;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 cameraPosition;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 clipSpace;\r\nvarying vec3 fromFragmentToCamera;\r\nvarying float reflectionYOffset;\r\n\r\nconst float tiling = 10.0;\r\n\r\nvoid main() {\r\n    vec4 worldPosition = model * position;\r\n    gl_Position = clipSpace = projection * view * worldPosition;\r\n\r\n    fromFragmentToCamera = cameraPosition - worldPosition.xyz;\r\n    vTextureCoord = textureCoord * tiling;\r\n}"},function(r,t){r.exports="// credits https://github.com/chinedufn/webgl-water-tutorial\r\nprecision highp float;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 clipSpace;\r\nvarying vec3 fromFragmentToCamera;\r\n\r\nuniform sampler2D dudvTexture;\r\nuniform sampler2D normalMapTexture;\r\nuniform sampler2D refractionTexture;\r\nuniform sampler2D reflectionTexture;\r\nuniform sampler2D depthTexture;\r\nuniform float dudvOffset;\r\nuniform int useRefraction;\r\nuniform int useReflection;\r\nuniform vec3 directionalLightVector;\r\nuniform vec3 directionalLightColor;\r\n\r\nconst float waterDistortionStrenth = 0.02;\r\nconst float fresnelStrength = 1.00;\r\nconst float waterReflectivity = 0.4;\r\nconst vec4 shallowWaterColor =  vec4(0.0, 0.1, 0.3, 1.0);\r\nconst vec4 deepWaterColor = vec4(0.0, 0.1, 0.2, 1.0);\r\nconst float shineDamper = 30.0;\r\n\r\nfloat getDepthAngle(\r\n  vec2 refractTexCoords\r\n) {\r\n    float near = 0.1;\r\n    float far = 50.0;\r\n    float nfp = far + near;\r\n    float nfm = far - near;\r\n\r\n    float cameraToFirstThingBehindWater = texture2D(depthTexture, refractTexCoords).r;\r\n    float cameraToFirstThingUnderWater = 2.0 * near * far / (nfp - (2.0 * cameraToFirstThingBehindWater - 1.0) * nfm);\r\n    float cameraToWaterDepth = gl_FragCoord.z;\r\n    float cameraToWaterDistance = 2.0 * near * far / (nfp - (2.0 * cameraToWaterDepth - 1.0) * nfm);\r\n    return cameraToFirstThingUnderWater - cameraToWaterDistance;\r\n}\r\n\r\nvoid main() {\r\n    // distortion\r\n    vec2 distortedTexCoords = texture2D(dudvTexture, vec2(vTextureCoord.x, vTextureCoord.y + dudvOffset)).xy * 0.1;\r\n    distortedTexCoords = vTextureCoord + vec2(distortedTexCoords.x + dudvOffset, distortedTexCoords.y);\r\n\r\n    vec2 totalDistortion = (texture2D(dudvTexture, distortedTexCoords).xy * 2.0 - 1.0) * waterDistortionStrenth;\r\n\r\n    // base refract/reflect texture coordinates\r\n    vec2 ndc = (clipSpace.xy / clipSpace.w) / 2.0 + 0.5;\r\n    vec2 refractTexCoords = vec2(ndc.x, +ndc.y);\r\n    vec2 reflectTexCoords = vec2(ndc.x, 1.0-ndc.y);\r\n    float angledWaterDepth = getDepthAngle(refractTexCoords);\r\n\r\n    // refractive factor\r\n    vec3 toCamera = normalize(fromFragmentToCamera);\r\n    vec4 normalMapColor = texture2D(normalMapTexture, distortedTexCoords);\r\n    vec3 normal = normalMapColor.xyz * 2.0 - 1.0;\r\n    normal = normalize(normal);\r\n    float refractiveFactor = dot(toCamera, normal);\r\n    // TODO do we need this?\r\n    refractiveFactor = pow(refractiveFactor, fresnelStrength);\r\n\r\n    // puting all together\r\n    refractTexCoords += totalDistortion;\r\n    reflectTexCoords += totalDistortion;\r\n    refractTexCoords = clamp(refractTexCoords, 0.001, 0.999);\r\n    reflectTexCoords = clamp(reflectTexCoords, 0.001, 0.999);\r\n\r\n    // lighs\r\n    vec3 reflectedLight = reflect(normalize(directionalLightVector), normal);\r\n    float specular = max(dot(reflectedLight, toCamera), 0.0);\r\n    specular = pow(specular, shineDamper);\r\n    vec3 specularHighlights = directionalLightColor * specular * waterReflectivity;\r\n\r\n    // color\r\n    vec4 refractColor = texture2D(refractionTexture, refractTexCoords);\r\n    vec4 reflectColor = texture2D(reflectionTexture, reflectTexCoords);\r\n    refractColor = mix(refractColor, deepWaterColor, clamp(angledWaterDepth / 10.0, 0.0, 1.0));\r\n\r\n    if (useReflection == 1 && useRefraction == 1) {\r\n      gl_FragColor = mix(reflectColor, refractColor, refractiveFactor);\r\n    } else if (useReflection == 1) {\r\n      gl_FragColor = reflectColor;\r\n    } else if (useRefraction == 1) {\r\n      gl_FragColor = refractColor;\r\n    }\r\n    gl_FragColor = mix(gl_FragColor, shallowWaterColor, 0.2);\r\n\r\n    gl_FragColor = gl_FragColor + vec4(specularHighlights, 1.0);\r\n}\r\n"}]);
//# sourceMappingURL=index.js.map