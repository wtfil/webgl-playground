!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";r.d(t,"b",function(){return n}),r.d(t,"a",function(){return o}),r.d(t,"c",function(){return i});var n=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array,i=Math.random;Math.PI},function(e,t,r){"use strict";r.r(t),r.d(t,"create",function(){return o}),r.d(t,"clone",function(){return i}),r.d(t,"copy",function(){return a}),r.d(t,"fromValues",function(){return s}),r.d(t,"set",function(){return u}),r.d(t,"identity",function(){return c}),r.d(t,"transpose",function(){return l}),r.d(t,"invert",function(){return f}),r.d(t,"adjoint",function(){return d}),r.d(t,"determinant",function(){return m}),r.d(t,"multiply",function(){return h}),r.d(t,"translate",function(){return p}),r.d(t,"scale",function(){return v}),r.d(t,"rotate",function(){return g}),r.d(t,"rotateX",function(){return w}),r.d(t,"rotateY",function(){return M}),r.d(t,"rotateZ",function(){return b}),r.d(t,"fromTranslation",function(){return T}),r.d(t,"fromScaling",function(){return E}),r.d(t,"fromRotation",function(){return x}),r.d(t,"fromXRotation",function(){return _}),r.d(t,"fromYRotation",function(){return R}),r.d(t,"fromZRotation",function(){return y}),r.d(t,"fromRotationTranslation",function(){return A}),r.d(t,"fromQuat2",function(){return C}),r.d(t,"getTranslation",function(){return F}),r.d(t,"getScaling",function(){return L}),r.d(t,"getRotation",function(){return S}),r.d(t,"fromRotationTranslationScale",function(){return D}),r.d(t,"fromRotationTranslationScaleOrigin",function(){return P}),r.d(t,"fromQuat",function(){return U}),r.d(t,"frustum",function(){return O}),r.d(t,"perspective",function(){return B}),r.d(t,"perspectiveFromFieldOfView",function(){return I}),r.d(t,"ortho",function(){return z}),r.d(t,"lookAt",function(){return N}),r.d(t,"targetTo",function(){return k}),r.d(t,"str",function(){return j}),r.d(t,"frob",function(){return q}),r.d(t,"add",function(){return X}),r.d(t,"subtract",function(){return V}),r.d(t,"multiplyScalar",function(){return G}),r.d(t,"multiplyScalarAndAdd",function(){return H}),r.d(t,"exactEquals",function(){return Y}),r.d(t,"equals",function(){return W}),r.d(t,"mul",function(){return Z}),r.d(t,"sub",function(){return Q});var n=r(0);function o(){var e=new n.a(16);return n.a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function i(e){var t=new n.a(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e,t,r,o,i,a,s,u,c,l,f,d,m,h,p,v){var g=new n.a(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=o,g[4]=i,g[5]=a,g[6]=s,g[7]=u,g[8]=c,g[9]=l,g[10]=f,g[11]=d,g[12]=m,g[13]=h,g[14]=p,g[15]=v,g}function u(e,t,r,n,o,i,a,s,u,c,l,f,d,m,h,p,v){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e[6]=s,e[7]=u,e[8]=c,e[9]=l,e[10]=f,e[11]=d,e[12]=m,e[13]=h,e[14]=p,e[15]=v,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function l(e,t){if(e===t){var r=t[1],n=t[2],o=t[3],i=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=o,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function f(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],d=t[10],m=t[11],h=t[12],p=t[13],v=t[14],g=t[15],w=r*s-n*a,M=r*u-o*a,b=r*c-i*a,T=n*u-o*s,E=n*c-i*s,x=o*c-i*u,_=l*p-f*h,R=l*v-d*h,y=l*g-m*h,A=f*v-d*p,C=f*g-m*p,F=d*g-m*v,L=w*F-M*C+b*A+T*y-E*R+x*_;return L?(L=1/L,e[0]=(s*F-u*C+c*A)*L,e[1]=(o*C-n*F-i*A)*L,e[2]=(p*x-v*E+g*T)*L,e[3]=(d*E-f*x-m*T)*L,e[4]=(u*y-a*F-c*R)*L,e[5]=(r*F-o*y+i*R)*L,e[6]=(v*b-h*x-g*M)*L,e[7]=(l*x-d*b+m*M)*L,e[8]=(a*C-s*y+c*_)*L,e[9]=(n*y-r*C-i*_)*L,e[10]=(h*E-p*b+g*w)*L,e[11]=(f*b-l*E-m*w)*L,e[12]=(s*R-a*A-u*_)*L,e[13]=(r*A-n*R+o*_)*L,e[14]=(p*M-h*T-v*w)*L,e[15]=(l*T-f*M+d*w)*L,e):null}function d(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],f=t[9],d=t[10],m=t[11],h=t[12],p=t[13],v=t[14],g=t[15];return e[0]=s*(d*g-m*v)-f*(u*g-c*v)+p*(u*m-c*d),e[1]=-(n*(d*g-m*v)-f*(o*g-i*v)+p*(o*m-i*d)),e[2]=n*(u*g-c*v)-s*(o*g-i*v)+p*(o*c-i*u),e[3]=-(n*(u*m-c*d)-s*(o*m-i*d)+f*(o*c-i*u)),e[4]=-(a*(d*g-m*v)-l*(u*g-c*v)+h*(u*m-c*d)),e[5]=r*(d*g-m*v)-l*(o*g-i*v)+h*(o*m-i*d),e[6]=-(r*(u*g-c*v)-a*(o*g-i*v)+h*(o*c-i*u)),e[7]=r*(u*m-c*d)-a*(o*m-i*d)+l*(o*c-i*u),e[8]=a*(f*g-m*p)-l*(s*g-c*p)+h*(s*m-c*f),e[9]=-(r*(f*g-m*p)-l*(n*g-i*p)+h*(n*m-i*f)),e[10]=r*(s*g-c*p)-a*(n*g-i*p)+h*(n*c-i*s),e[11]=-(r*(s*m-c*f)-a*(n*m-i*f)+l*(n*c-i*s)),e[12]=-(a*(f*v-d*p)-l*(s*v-u*p)+h*(s*d-u*f)),e[13]=r*(f*v-d*p)-l*(n*v-o*p)+h*(n*d-o*f),e[14]=-(r*(s*v-u*p)-a*(n*v-o*p)+h*(n*u-o*s)),e[15]=r*(s*d-u*f)-a*(n*d-o*f)+l*(n*u-o*s),e}function m(e){var t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],d=e[11],m=e[12],h=e[13],p=e[14],v=e[15];return(t*a-r*i)*(f*v-d*p)-(t*s-n*i)*(l*v-d*h)+(t*u-o*i)*(l*p-f*h)+(r*s-n*a)*(c*v-d*m)-(r*u-o*a)*(c*p-f*m)+(n*u-o*s)*(c*h-l*m)}function h(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],d=t[9],m=t[10],h=t[11],p=t[12],v=t[13],g=t[14],w=t[15],M=r[0],b=r[1],T=r[2],E=r[3];return e[0]=M*n+b*s+T*f+E*p,e[1]=M*o+b*u+T*d+E*v,e[2]=M*i+b*c+T*m+E*g,e[3]=M*a+b*l+T*h+E*w,M=r[4],b=r[5],T=r[6],E=r[7],e[4]=M*n+b*s+T*f+E*p,e[5]=M*o+b*u+T*d+E*v,e[6]=M*i+b*c+T*m+E*g,e[7]=M*a+b*l+T*h+E*w,M=r[8],b=r[9],T=r[10],E=r[11],e[8]=M*n+b*s+T*f+E*p,e[9]=M*o+b*u+T*d+E*v,e[10]=M*i+b*c+T*m+E*g,e[11]=M*a+b*l+T*h+E*w,M=r[12],b=r[13],T=r[14],E=r[15],e[12]=M*n+b*s+T*f+E*p,e[13]=M*o+b*u+T*d+E*v,e[14]=M*i+b*c+T*m+E*g,e[15]=M*a+b*l+T*h+E*w,e}function p(e,t,r){var n,o,i,a,s,u,c,l,f,d,m,h,p=r[0],v=r[1],g=r[2];return t===e?(e[12]=t[0]*p+t[4]*v+t[8]*g+t[12],e[13]=t[1]*p+t[5]*v+t[9]*g+t[13],e[14]=t[2]*p+t[6]*v+t[10]*g+t[14],e[15]=t[3]*p+t[7]*v+t[11]*g+t[15]):(n=t[0],o=t[1],i=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],d=t[9],m=t[10],h=t[11],e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=s,e[5]=u,e[6]=c,e[7]=l,e[8]=f,e[9]=d,e[10]=m,e[11]=h,e[12]=n*p+s*v+f*g+t[12],e[13]=o*p+u*v+d*g+t[13],e[14]=i*p+c*v+m*g+t[14],e[15]=a*p+l*v+h*g+t[15]),e}function v(e,t,r){var n=r[0],o=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function g(e,t,r,o){var i,a,s,u,c,l,f,d,m,h,p,v,g,w,M,b,T,E,x,_,R,y,A,C,F=o[0],L=o[1],S=o[2],D=Math.sqrt(F*F+L*L+S*S);return D<n.b?null:(F*=D=1/D,L*=D,S*=D,i=Math.sin(r),s=1-(a=Math.cos(r)),u=t[0],c=t[1],l=t[2],f=t[3],d=t[4],m=t[5],h=t[6],p=t[7],v=t[8],g=t[9],w=t[10],M=t[11],b=F*F*s+a,T=L*F*s+S*i,E=S*F*s-L*i,x=F*L*s-S*i,_=L*L*s+a,R=S*L*s+F*i,y=F*S*s+L*i,A=L*S*s-F*i,C=S*S*s+a,e[0]=u*b+d*T+v*E,e[1]=c*b+m*T+g*E,e[2]=l*b+h*T+w*E,e[3]=f*b+p*T+M*E,e[4]=u*x+d*_+v*R,e[5]=c*x+m*_+g*R,e[6]=l*x+h*_+w*R,e[7]=f*x+p*_+M*R,e[8]=u*y+d*A+v*C,e[9]=c*y+m*A+g*C,e[10]=l*y+h*A+w*C,e[11]=f*y+p*A+M*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function w(e,t,r){var n=Math.sin(r),o=Math.cos(r),i=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],f=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*o+c*n,e[5]=a*o+l*n,e[6]=s*o+f*n,e[7]=u*o+d*n,e[8]=c*o-i*n,e[9]=l*o-a*n,e[10]=f*o-s*n,e[11]=d*o-u*n,e}function M(e,t,r){var n=Math.sin(r),o=Math.cos(r),i=t[0],a=t[1],s=t[2],u=t[3],c=t[8],l=t[9],f=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o-c*n,e[1]=a*o-l*n,e[2]=s*o-f*n,e[3]=u*o-d*n,e[8]=i*n+c*o,e[9]=a*n+l*o,e[10]=s*n+f*o,e[11]=u*n+d*o,e}function b(e,t,r){var n=Math.sin(r),o=Math.cos(r),i=t[0],a=t[1],s=t[2],u=t[3],c=t[4],l=t[5],f=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*o+c*n,e[1]=a*o+l*n,e[2]=s*o+f*n,e[3]=u*o+d*n,e[4]=c*o-i*n,e[5]=l*o-a*n,e[6]=f*o-s*n,e[7]=d*o-u*n,e}function T(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function E(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t,r){var o,i,a,s=r[0],u=r[1],c=r[2],l=Math.sqrt(s*s+u*u+c*c);return l<n.b?null:(s*=l=1/l,u*=l,c*=l,o=Math.sin(t),a=1-(i=Math.cos(t)),e[0]=s*s*a+i,e[1]=u*s*a+c*o,e[2]=c*s*a-u*o,e[3]=0,e[4]=s*u*a-c*o,e[5]=u*u*a+i,e[6]=c*u*a+s*o,e[7]=0,e[8]=s*c*a+u*o,e[9]=u*c*a-s*o,e[10]=c*c*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function _(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function R(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function A(e,t,r){var n=t[0],o=t[1],i=t[2],a=t[3],s=n+n,u=o+o,c=i+i,l=n*s,f=n*u,d=n*c,m=o*u,h=o*c,p=i*c,v=a*s,g=a*u,w=a*c;return e[0]=1-(m+p),e[1]=f+w,e[2]=d-g,e[3]=0,e[4]=f-w,e[5]=1-(l+p),e[6]=h+v,e[7]=0,e[8]=d+g,e[9]=h-v,e[10]=1-(l+m),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function C(e,t){var r=new n.a(3),o=-t[0],i=-t[1],a=-t[2],s=t[3],u=t[4],c=t[5],l=t[6],f=t[7],d=o*o+i*i+a*a+s*s;return d>0?(r[0]=2*(u*s+f*o+c*a-l*i)/d,r[1]=2*(c*s+f*i+l*o-u*a)/d,r[2]=2*(l*s+f*a+u*i-c*o)/d):(r[0]=2*(u*s+f*o+c*a-l*i),r[1]=2*(c*s+f*i+l*o-u*a),r[2]=2*(l*s+f*a+u*i-c*o)),A(e,t,r),e}function F(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function L(e,t){var r=t[0],n=t[1],o=t[2],i=t[4],a=t[5],s=t[6],u=t[8],c=t[9],l=t[10];return e[0]=Math.sqrt(r*r+n*n+o*o),e[1]=Math.sqrt(i*i+a*a+s*s),e[2]=Math.sqrt(u*u+c*c+l*l),e}function S(e,t){var r=t[0]+t[5]+t[10],n=0;return r>0?(n=2*Math.sqrt(r+1),e[3]=.25*n,e[0]=(t[6]-t[9])/n,e[1]=(t[8]-t[2])/n,e[2]=(t[1]-t[4])/n):t[0]>t[5]&&t[0]>t[10]?(n=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/n,e[0]=.25*n,e[1]=(t[1]+t[4])/n,e[2]=(t[8]+t[2])/n):t[5]>t[10]?(n=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/n,e[0]=(t[1]+t[4])/n,e[1]=.25*n,e[2]=(t[6]+t[9])/n):(n=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/n,e[0]=(t[8]+t[2])/n,e[1]=(t[6]+t[9])/n,e[2]=.25*n),e}function D(e,t,r,n){var o=t[0],i=t[1],a=t[2],s=t[3],u=o+o,c=i+i,l=a+a,f=o*u,d=o*c,m=o*l,h=i*c,p=i*l,v=a*l,g=s*u,w=s*c,M=s*l,b=n[0],T=n[1],E=n[2];return e[0]=(1-(h+v))*b,e[1]=(d+M)*b,e[2]=(m-w)*b,e[3]=0,e[4]=(d-M)*T,e[5]=(1-(f+v))*T,e[6]=(p+g)*T,e[7]=0,e[8]=(m+w)*E,e[9]=(p-g)*E,e[10]=(1-(f+h))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function P(e,t,r,n,o){var i=t[0],a=t[1],s=t[2],u=t[3],c=i+i,l=a+a,f=s+s,d=i*c,m=i*l,h=i*f,p=a*l,v=a*f,g=s*f,w=u*c,M=u*l,b=u*f,T=n[0],E=n[1],x=n[2],_=o[0],R=o[1],y=o[2],A=(1-(p+g))*T,C=(m+b)*T,F=(h-M)*T,L=(m-b)*E,S=(1-(d+g))*E,D=(v+w)*E,P=(h+M)*x,U=(v-w)*x,O=(1-(d+p))*x;return e[0]=A,e[1]=C,e[2]=F,e[3]=0,e[4]=L,e[5]=S,e[6]=D,e[7]=0,e[8]=P,e[9]=U,e[10]=O,e[11]=0,e[12]=r[0]+_-(A*_+L*R+P*y),e[13]=r[1]+R-(C*_+S*R+U*y),e[14]=r[2]+y-(F*_+D*R+O*y),e[15]=1,e}function U(e,t){var r=t[0],n=t[1],o=t[2],i=t[3],a=r+r,s=n+n,u=o+o,c=r*a,l=n*a,f=n*s,d=o*a,m=o*s,h=o*u,p=i*a,v=i*s,g=i*u;return e[0]=1-f-h,e[1]=l+g,e[2]=d-v,e[3]=0,e[4]=l-g,e[5]=1-c-h,e[6]=m+p,e[7]=0,e[8]=d+v,e[9]=m-p,e[10]=1-c-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function O(e,t,r,n,o,i,a){var s=1/(r-t),u=1/(o-n),c=1/(i-a);return e[0]=2*i*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*u,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(o+n)*u,e[10]=(a+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*i*2*c,e[15]=0,e}function B(e,t,r,n,o){var i,a=1/Math.tan(t/2);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(i=1/(n-o),e[10]=(o+n)*i,e[14]=2*o*n*i):(e[10]=-1,e[14]=-2*n),e}function I(e,t,r,n){var o=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(o+i);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(o-i)*c*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function z(e,t,r,n,o,i,a){var s=1/(t-r),u=1/(n-o),c=1/(i-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(o+n)*u,e[14]=(a+i)*c,e[15]=1,e}function N(e,t,r,o){var i,a,s,u,l,f,d,m,h,p,v=t[0],g=t[1],w=t[2],M=o[0],b=o[1],T=o[2],E=r[0],x=r[1],_=r[2];return Math.abs(v-E)<n.b&&Math.abs(g-x)<n.b&&Math.abs(w-_)<n.b?c(e):(d=v-E,m=g-x,h=w-_,i=b*(h*=p=1/Math.sqrt(d*d+m*m+h*h))-T*(m*=p),a=T*(d*=p)-M*h,s=M*m-b*d,(p=Math.sqrt(i*i+a*a+s*s))?(i*=p=1/p,a*=p,s*=p):(i=0,a=0,s=0),u=m*s-h*a,l=h*i-d*s,f=d*a-m*i,(p=Math.sqrt(u*u+l*l+f*f))?(u*=p=1/p,l*=p,f*=p):(u=0,l=0,f=0),e[0]=i,e[1]=u,e[2]=d,e[3]=0,e[4]=a,e[5]=l,e[6]=m,e[7]=0,e[8]=s,e[9]=f,e[10]=h,e[11]=0,e[12]=-(i*v+a*g+s*w),e[13]=-(u*v+l*g+f*w),e[14]=-(d*v+m*g+h*w),e[15]=1,e)}function k(e,t,r,n){var o=t[0],i=t[1],a=t[2],s=n[0],u=n[1],c=n[2],l=o-r[0],f=i-r[1],d=a-r[2],m=l*l+f*f+d*d;m>0&&(l*=m=1/Math.sqrt(m),f*=m,d*=m);var h=u*d-c*f,p=c*l-s*d,v=s*f-u*l;return(m=h*h+p*p+v*v)>0&&(h*=m=1/Math.sqrt(m),p*=m,v*=m),e[0]=h,e[1]=p,e[2]=v,e[3]=0,e[4]=f*v-d*p,e[5]=d*h-l*v,e[6]=l*p-f*h,e[7]=0,e[8]=l,e[9]=f,e[10]=d,e[11]=0,e[12]=o,e[13]=i,e[14]=a,e[15]=1,e}function j(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function q(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function X(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function V(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function G(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function H(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function Y(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function W(e,t){var r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=e[9],m=e[10],h=e[11],p=e[12],v=e[13],g=e[14],w=e[15],M=t[0],b=t[1],T=t[2],E=t[3],x=t[4],_=t[5],R=t[6],y=t[7],A=t[8],C=t[9],F=t[10],L=t[11],S=t[12],D=t[13],P=t[14],U=t[15];return Math.abs(r-M)<=n.b*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(o-b)<=n.b*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-T)<=n.b*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(a-E)<=n.b*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-x)<=n.b*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(u-_)<=n.b*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(c-R)<=n.b*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(l-y)<=n.b*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-A)<=n.b*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(d-C)<=n.b*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(m-F)<=n.b*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(h-L)<=n.b*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(p-S)<=n.b*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(v-D)<=n.b*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(g-P)<=n.b*Math.max(1,Math.abs(g),Math.abs(P))&&Math.abs(w-U)<=n.b*Math.max(1,Math.abs(w),Math.abs(U))}var Z=h,Q=V},function(e,t,r){"use strict";r.r(t),r.d(t,"create",function(){return o}),r.d(t,"clone",function(){return i}),r.d(t,"length",function(){return a}),r.d(t,"fromValues",function(){return s}),r.d(t,"copy",function(){return u}),r.d(t,"set",function(){return c}),r.d(t,"add",function(){return l}),r.d(t,"subtract",function(){return f}),r.d(t,"multiply",function(){return d}),r.d(t,"divide",function(){return m}),r.d(t,"ceil",function(){return h}),r.d(t,"floor",function(){return p}),r.d(t,"min",function(){return v}),r.d(t,"max",function(){return g}),r.d(t,"round",function(){return w}),r.d(t,"scale",function(){return M}),r.d(t,"scaleAndAdd",function(){return b}),r.d(t,"distance",function(){return T}),r.d(t,"squaredDistance",function(){return E}),r.d(t,"squaredLength",function(){return x}),r.d(t,"negate",function(){return _}),r.d(t,"inverse",function(){return R}),r.d(t,"normalize",function(){return y}),r.d(t,"dot",function(){return A}),r.d(t,"cross",function(){return C}),r.d(t,"lerp",function(){return F}),r.d(t,"hermite",function(){return L}),r.d(t,"bezier",function(){return S}),r.d(t,"random",function(){return D}),r.d(t,"transformMat4",function(){return P}),r.d(t,"transformMat3",function(){return U}),r.d(t,"transformQuat",function(){return O}),r.d(t,"rotateX",function(){return B}),r.d(t,"rotateY",function(){return I}),r.d(t,"rotateZ",function(){return z}),r.d(t,"angle",function(){return N}),r.d(t,"zero",function(){return k}),r.d(t,"str",function(){return j}),r.d(t,"exactEquals",function(){return q}),r.d(t,"equals",function(){return X}),r.d(t,"sub",function(){return G}),r.d(t,"mul",function(){return H}),r.d(t,"div",function(){return Y}),r.d(t,"dist",function(){return W}),r.d(t,"sqrDist",function(){return Z}),r.d(t,"len",function(){return Q}),r.d(t,"sqrLen",function(){return $}),r.d(t,"forEach",function(){return K});var n=r(0);function o(){var e=new n.a(3);return n.a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e){var t=new n.a(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function s(e,t,r){var o=new n.a(3);return o[0]=e,o[1]=t,o[2]=r,o}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function c(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function l(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function f(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function d(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function m(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function h(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function p(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function v(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function g(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function w(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function M(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function b(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function T(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+n*n+o*o)}function E(e,t){var r=t[0]-e[0],n=t[1]-e[1],o=t[2]-e[2];return r*r+n*n+o*o}function x(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function _(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function R(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function y(e,t){var r=t[0],n=t[1],o=t[2],i=r*r+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function A(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function C(e,t,r){var n=t[0],o=t[1],i=t[2],a=r[0],s=r[1],u=r[2];return e[0]=o*u-i*s,e[1]=i*a-n*u,e[2]=n*s-o*a,e}function F(e,t,r,n){var o=t[0],i=t[1],a=t[2];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e[2]=a+n*(r[2]-a),e}function L(e,t,r,n,o,i){var a=i*i,s=a*(2*i-3)+1,u=a*(i-2)+i,c=a*(i-1),l=a*(3-2*i);return e[0]=t[0]*s+r[0]*u+n[0]*c+o[0]*l,e[1]=t[1]*s+r[1]*u+n[1]*c+o[1]*l,e[2]=t[2]*s+r[2]*u+n[2]*c+o[2]*l,e}function S(e,t,r,n,o,i){var a=1-i,s=a*a,u=i*i,c=s*a,l=3*i*s,f=3*u*a,d=u*i;return e[0]=t[0]*c+r[0]*l+n[0]*f+o[0]*d,e[1]=t[1]*c+r[1]*l+n[1]*f+o[1]*d,e[2]=t[2]*c+r[2]*l+n[2]*f+o[2]*d,e}function D(e,t){t=t||1;var r=2*n.c()*Math.PI,o=2*n.c()-1,i=Math.sqrt(1-o*o)*t;return e[0]=Math.cos(r)*i,e[1]=Math.sin(r)*i,e[2]=o*t,e}function P(e,t,r){var n=t[0],o=t[1],i=t[2],a=r[3]*n+r[7]*o+r[11]*i+r[15];return a=a||1,e[0]=(r[0]*n+r[4]*o+r[8]*i+r[12])/a,e[1]=(r[1]*n+r[5]*o+r[9]*i+r[13])/a,e[2]=(r[2]*n+r[6]*o+r[10]*i+r[14])/a,e}function U(e,t,r){var n=t[0],o=t[1],i=t[2];return e[0]=n*r[0]+o*r[3]+i*r[6],e[1]=n*r[1]+o*r[4]+i*r[7],e[2]=n*r[2]+o*r[5]+i*r[8],e}function O(e,t,r){var n=r[0],o=r[1],i=r[2],a=r[3],s=t[0],u=t[1],c=t[2],l=o*c-i*u,f=i*s-n*c,d=n*u-o*s,m=o*d-i*f,h=i*l-n*d,p=n*f-o*l,v=2*a;return l*=v,f*=v,d*=v,m*=2,h*=2,p*=2,e[0]=s+l+m,e[1]=u+f+h,e[2]=c+d+p,e}function B(e,t,r,n){var o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function I(e,t,r,n){var o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function z(e,t,r,n){var o=[],i=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function N(e,t){var r=s(e[0],e[1],e[2]),n=s(t[0],t[1],t[2]);y(r,r),y(n,n);var o=A(r,n);return o>1?0:o<-1?Math.PI:Math.acos(o)}function k(e){return e[0]=0,e[1]=0,e[2]=0,e}function j(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function X(e,t){var r=e[0],o=e[1],i=e[2],a=t[0],s=t[1],u=t[2];return Math.abs(r-a)<=n.b*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(o-s)<=n.b*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(i-u)<=n.b*Math.max(1,Math.abs(i),Math.abs(u))}var V,G=f,H=d,Y=m,W=T,Z=E,Q=a,$=x,K=(V=o(),function(e,t,r,n,o,i){var a,s;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,a=r;a<s;a+=t)V[0]=e[a],V[1]=e[a+1],V[2]=e[a+2],o(V,V,i),e[a]=V[0],e[a+1]=V[1],e[a+2]=V[2];return e})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),o=r(2);function i(e,t,r){const n=e.createShader(t);return n?(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.log(r),console.warn(e.getShaderInfoLog(n)),e.deleteShader(n),null)):null}function a(e,t,r){const n=e.createBuffer();return e.bindBuffer(t,n),e.bufferData(t,r,e.STATIC_DRAW),n}t.loadTexture=async function(e,t){const r=await new Promise((e,r)=>{const n=new Image;n.src=t,n.onload=(()=>e(n)),n.onerror=r}),n=e.createTexture(),o=e=>0==(e&e-1);return e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),o(r.width)&&o(r.height)?e.generateMipmap(e.TEXTURE_2D):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),n},t.createProgram=function(e,t,r){const n=i(e,e.VERTEX_SHADER,t),o=i(e,e.FRAGMENT_SHADER,r),a=e.createProgram();if(!a||!n||!o)throw new Error("Failed to create shader program");if(e.attachShader(a,n),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw console.warn(e.getProgramInfoLog(a)),new Error("Can not creat program");const s={},u={},c=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES),l=e.getProgramParameter(a,e.ACTIVE_UNIFORMS);for(let t=0;t<c;t++){const r=e.getActiveAttrib(a,t).name;s[r]=e.getAttribLocation(a,r)}for(let t=0;t<l;t++){const r=e.getActiveUniform(a,t).name;u[r]=e.getUniformLocation(a,r)}return{program:a,uniforms:u,attributes:s,gl:e}},t.createMatrices=function(e){const t=n.create(),r=n.create(),i=n.create();n.perspective(t,Math.PI/4,e.aspect,.1,e.far||2e3);const a=o.clone(e.camera.position),s=o.clone(e.camera.center);return e.flip&&(s[2]=-s[2],a[2]=-a[2]),n.lookAt(r,a,s,[0,0,1]),{model:i,projection:t,view:r}},t.createBuffer=a,t.bindBuffer=function(e,t,r,n){e.bindBuffer(e.ARRAY_BUFFER,t),e.vertexAttribPointer(r,n,e.FLOAT,!1,0,0),e.enableVertexAttribArray(r)},t.bindArraysToBuffers=function(e,t){const{arrays:r,textures:n={},framebuffers:o={}}=t;return{buffers:{position:a(e,e.ARRAY_BUFFER,new Float32Array(r.position)),colors:a(e,e.ARRAY_BUFFER,new Float32Array(r.colors)),indices:a(e,e.ELEMENT_ARRAY_BUFFER,new Uint16Array(r.indices)),normal:a(e,e.ARRAY_BUFFER,new Float32Array(r.normals)),texture:a(e,e.ARRAY_BUFFER,new Float32Array(r.texture))},textures:n,framebuffers:o,size:r.indices.length}},t.createFramebufferAndTexture=function(e,t,r){const n=e.createTexture(),o=e.createFramebuffer(),i=e.createRenderbuffer();return e.bindFramebuffer(e.FRAMEBUFFER,o),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t,r,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.bindRenderbuffer(e.RENDERBUFFER,i),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,i),e.bindFramebuffer(e.FRAMEBUFFER,null),[n,o]},t.inRange=function(e,t,r){return e<t?t:e>r?r:e}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(2),i=r(1),a=r(3),s=n(r(14)),u=n(r(15)),{cos:c,sin:l,tan:f,PI:d}=Math;function m(e){return function(t){const{gl:r,program:n,sun:o,size:s}=e,{state:u,aspect:c,flip:l=!1}=t,{projection:f,model:d,view:m}=a.createMatrices({camera:u.camera,aspect:c,flip:l}),[h,p]=u.camera.position;i.translate(d,d,[h,p,-100]),i.scale(d,d,[s,s,s]),r.useProgram(n.program),a.bindBuffer(r,o.buffers.position,n.attributes.position,3),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,o.buffers.indices),r.uniform3fv(n.uniforms.sunPosition,u.sky.sunPosition),r.uniform3fv(n.uniforms.cameraPosition,u.camera.position),r.uniformMatrix4fv(n.uniforms.projection,!1,f),r.uniformMatrix4fv(n.uniforms.view,!1,m),r.uniformMatrix4fv(n.uniforms.model,!1,d),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.drawElements(r.TRIANGLES,o.size,r.UNSIGNED_SHORT,0),r.disable(r.BLEND)}}function h(){const e=50,t=[],r=[];for(let n=0;n<=e;n++){const o=d/e*n-d/2;for(let i=0;i<e;i++){const a=2*d/e*i,s=c(a)*c(o),u=l(a)*c(o),f=l(o),m=n*e+i;t.push(s,u,f),n!==e&&(49===i?r.push(n*e,m+e,m,m+e,m+1,n*e):r.push(m,m+1,m+e,m+1,m+e,m+e+1))}}return{position:t,indices:r}}function p(e){return("00"+e).slice(-2)}t.createSky=function(e,t){const r=a.createProgram(e,s.default,u.default);return{render:m({gl:e,sun:a.bindArraysToBuffers(e,{arrays:h()}),program:r,size:t.size})}},t.sunTimeToString=function(e){const t=Math.ceil(e/60/1e3),r=t%60;return`${p(Math.floor(t/60))}:${p(r)}`},t.getSunPosition=function(e){const t=e%864e5,r=function(e){return f(-4.83049e-16*e*e+4.21414e-8*e-.420437)}(t),n=function(e){return 7.344052639206152e-8*e-.1829595519336553}(t),i=c(r)*c(n),s=c(r)*l(n),u=l(r),d=o.fromValues(i,-s,u),m=o.fromValues(1,1,1),h=o.create(),p=a.inRange(3*u,0,1);return o.negate(h,d),o.scale(m,m,p),{sunPosition:o.fromValues(i,-s,u),directionalLightColor:m,directionalLightVector:h}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6),o=r(9),i=r(11),a=r(4),s=r(16);window.addEventListener("load",async function(){const e=document.querySelector("canvas");e.width=c,e.height=l;const t=e.getContext("experimental-webgl");if(!t)return void console.warn("Can not create webgl context");const r=await n.createTerrain(t,{heatmap:"heightmaps/terrain5.png",chunkSize:20/h,baseLevel:120,size:[f,f,200]}),u=await i.createWater(t,{size:d}),p=a.createSky(t,{size:m}),v=s.getInitialState(),{emitter:g}=o.initControls(e);g.on("toggleRenderWater",()=>s.toggle(v,"water","visible")).on("toggleRenderTerrain",()=>s.toggle(v,"terrain","visible")).on("toggleRefraction",()=>s.toggle(v,"water","useRefraction")).on("toggleReflection",()=>s.toggle(v,"water","useReflection")).on("toggleRenderSun",()=>s.toggle(v,"sky","visible")).on("toggleAutoSunMove",()=>s.toggle(v,"sky","autoSunMove")).on("zoom",e=>s.zoom(v,e.dy)).on("moveCamera",e=>s.moveCamera(v,e)).on("rotateCamera",e=>s.rorateCamera(v,e.dx/500,e.dy)).on("moveSun",e=>s.moveSun(v,1e5*e.sunTime)),function e(){if(!v.app.active)return requestAnimationFrame(e);s.updateWaterTime(v);s.autoMoveSun(v,3e5);!function(e){const t=c/l,{gl:r,terrain:n,water:o,sky:i,state:a}=e,s={state:a,aspect:t};r.clearDepth(1),r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),a.water.visible&&(o.updateReflectionTexture(()=>{a.sky.visible?i.render(Object.assign({},s,{flip:!0})):r.clearColor(.53,.8,.98,1),a.terrain.visible&&n.render(Object.assign({},s,{clipDirection:-1,flip:!0}))}),o.updateRefractionTexture(()=>{a.terrain.visible&&n.render(Object.assign({},s,{clipDirection:1}))}));r.viewport(0,0,c,l),a.water.visible&&o.render(s);a.terrain.visible&&n.render(s);a.sky.visible&&i.render(s)}({gl:t,state:v,terrain:r,water:u,sky:p});requestAnimationFrame(e)}()});const u=Math.min(window.innerWidth,window.innerHeight,1024),c=u,l=u,f=2*u,d=2*u,m=1e3,h=4},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(1),i=r(2),a=r(3),s=n(r(7)),u=n(r(8));function c(e){return function(t){const{gl:r,terrain:n,program:i,size:s}=e,{state:u,aspect:c,clipDirection:l=0,clipLevel:f=0,flip:d=!1}=t,{projection:m,model:h,view:p}=a.createMatrices({camera:u.camera,aspect:c,flip:d});o.scale(h,h,s),r.useProgram(i.program),a.bindBuffer(r,n.buffers.position,i.attributes.position,3),a.bindBuffer(r,n.buffers.normal,i.attributes.normal,3),a.bindBuffer(r,n.buffers.colors,i.attributes.colors,4),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n.buffers.indices),r.uniformMatrix4fv(i.uniforms.projection,!1,m),r.uniformMatrix4fv(i.uniforms.model,!1,h),r.uniformMatrix4fv(i.uniforms.view,!1,p),r.uniform3fv(i.uniforms.directionalLightVector,u.light.direction),r.uniform3fv(i.uniforms.directionalLightColor,u.light.color),r.uniform1f(i.uniforms.clipDirection,l),r.uniform1f(i.uniforms.clipLevel,f),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.drawElements(r.TRIANGLES,n.size,r.UNSIGNED_SHORT,0),r.disable(r.BLEND)}}t.createTerrain=async function(e,t){const r=await async function(e,t,r=0){const n=document.createElement("canvas"),o=await function(e){return new Promise((t,r)=>{const n=new Image;n.src=e,n.onload=(()=>t(n)),n.onerror=r})}(e);n.width=o.width,n.height=o.height;const a=n.getContext("2d");if(!a)throw new Error("Can not create 2d context");a.drawImage(o,0,0);const{data:s}=a.getImageData(0,0,o.width,o.height),u=new Uint32Array(s),c=Math.floor(o.width/t),l=Math.floor(o.height/t),f=new Float32Array(c*l);let d=0;for(let e=0;e<l;e++)for(let r=0;r<c;r++){let n=0;for(let i=0;i<t;i++)for(let a=0;a<t;a++)n+=u[4*(e*t*o.width+r*t+i*t+a)];const i=n/t/t;f[e*c+r]=i,d<i&&(d=i)}const m=[],h=[],p=[],v=[],g=[];for(let e=0;e<l;e++)for(let t=0;t<c;t++){const n=e*c+t,o=f[n]/d;Number.isFinite(o)||console.log({i:e,j:t,c:o}),m.push(t/c-.5,e/l-.5,(f[n]-r)/d),p.push(o,o,o,1),e!==l-1&&t!==c-1&&h.push(n,n+c,n+1,n+1,n+c,n+c+1),g.push(t/c,e/l)}for(let e=0;e<m.length/3;e++){const t=c,r=l,n=e%t,o=~~(e/t),a=[n>0&&o>0&&[e-t,e-1,e],n+1<t&&o>0&&[e-t,e,e-t+1],n+1<t&&o>0&&[e-t+1,e,e+1],n>0&&o<r&&[e-1,e+t-1,e],n>0&&o<r&&[e,e+t-1,e+t],n+1<t&&o<r&&[e,e+t,e+1]],s=[],u=[];for(let e=0;e<a.length;e++){const t=a[e];for(let e=0;e<3;e++)t&&s.push(m[3*t[e]],m[3*t[e]+1],m[3*t[e]+2])}for(let e=0;e<s.length/9;e++){const t=i.fromValues(s[9*e+0],s[9*e+1],s[9*e+2]),r=i.fromValues(s[9*e+3],s[9*e+4],s[9*e+5]),n=i.fromValues(s[9*e+6],s[9*e+7],s[9*e+8]);i.subtract(r,r,t),i.subtract(n,n,t),i.cross(r,r,n),i.normalize(r,r),u.push(r)}const f=i.fromValues(0,0,0);for(let e=0;e<u.length;e++)i.add(f,f,u[e]);i.normalize(f,f),v.push(f[0],f[1],f[2])}return{position:m,indices:h,colors:p,normals:v,texture:g}}(t.heatmap,t.chunkSize,t.baseLevel),n=a.createProgram(e,s.default,u.default);return{render:c({terrain:a.bindArraysToBuffers(e,{arrays:r}),gl:e,program:n,size:t.size})}}},function(e,t){e.exports="attribute vec4 position;\r\nattribute vec3 normal;\r\nattribute vec4 colors;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 directionalLightVector;\r\nuniform vec3 directionalLightColor;\r\nuniform float clipDirection;\r\nuniform float clipLevel;\r\n\r\nvarying highp vec3 vLighting;\r\nvarying lowp vec2 vTextureCoord;\r\nvarying lowp vec4 fragmentColor;\r\nvarying float shouldClip;\r\n\r\nvoid main() {\r\n  highp vec3 ambientLight = vec3(0.1, 0.1, 0.1);\r\n  highp vec3 directionalVector = normalize(directionalLightVector);\r\n\r\n  highp float directional = max(dot(normal, directionalVector), 0.0);\r\n  vLighting = ambientLight + (directionalLightColor * directional);\r\n\r\n  gl_Position = projection * view * model * position;\r\n\r\n  fragmentColor = colors;\r\n  if (clipDirection == 1.0) {\r\n    shouldClip = position.z > clipLevel ? 1.0 : 0.0;\r\n  } else if (clipDirection == -1.0) {\r\n    shouldClip = position.z < clipLevel ? 1.0 : 0.0;\r\n  } else {\r\n    shouldClip = 0.0;\r\n  }\r\n}"},function(e,t){e.exports="varying highp vec3 vLighting;\r\nvarying highp float shouldClip;\r\nvarying lowp vec4 fragmentColor;\r\n\r\nconst lowp vec4 grassColor = vec4(0.12, 0.43, 0.02, 1.0);\r\nconst lowp vec4 snowColor = vec4(1.0);\r\nconst lowp vec4 groundColor = vec4(0.85, 0.84, 0.79, 1.0);\r\n\r\nvoid main() {\r\n  if (shouldClip == 1.0) {\r\n    discard;\r\n  }\r\n  lowp float x = fragmentColor.x;\r\n  lowp float groundGrassMixFactor = smoothstep(0.1, 0.2, x);\r\n  lowp float grassSnowMixFactor = smoothstep(0.7, 0.8, x);\r\n  lowp vec4 color = mix(groundColor, grassColor, groundGrassMixFactor);\r\n  color = mix(color, snowColor, grassSnowMixFactor);\r\n\r\n  gl_FragColor = vec4(color.rgb * vLighting, color.a);\r\n}\r\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(10);t.initControls=function(e){let t=!1;const r=new Set,o=new n.EventEmitter,i=()=>{let e=0,t=0,n=0,a=0;r.has("w")&&t++,r.has("s")&&t--,r.has("a")&&e++,r.has("d")&&e--,r.has("e")&&n++,r.has("q")&&n--,r.has("j")&&a--,r.has("k")&&a++,a&&o.emit("moveSun",{sunTime:a}),(e||t||n)&&o.emit("moveCamera",{left:e,forward:t,up:n}),requestAnimationFrame(i)},a=e=>{switch(e.key){case"1":o.emit("toggleRenderTerrain");break;case"2":o.emit("toggleRenderWater");break;case"3":o.emit("toggleRefraction");break;case"4":o.emit("toggleReflection");break;case"5":o.emit("toggleRenderSun");break;case"6":o.emit("toggleAutoSunMove");break;default:r.add(e.key)}},s=e=>{const{deltaY:t}=e;t&&(o.emit("zoom",{dy:t/Math.abs(t)*10}),e.preventDefault())},u=e=>{r.delete(e.key)},c=()=>{t=!0},l=()=>{t=!1},f=e=>{const{movementX:r,movementY:n}=e;t&&o.emit("rotateCamera",{dx:-r,dy:n})},d=e=>{e.preventDefault()};return i(),e.addEventListener("wheel",s),e.addEventListener("mousedown",c),e.addEventListener("contextmenu",d),window.addEventListener("mouseup",l),window.addEventListener("mousemove",f),window.addEventListener("keypress",a),window.addEventListener("keyup",u),{emitter:o,tearDown:()=>{o.removeAllListeners(),e.removeEventListener("wheel",s),e.removeEventListener("mousedown",c),e.removeEventListener("contextmenu",d),window.removeEventListener("mouseup",l),window.removeEventListener("mousemove",f),window.removeEventListener("keypress",a),window.removeEventListener("keyup",u)}}}},function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,a,s,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(i(r=this._events[e]))return!1;if(n(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),r.apply(this,s)}else if(o(r))for(s=Array.prototype.slice.call(arguments,1),a=(c=r.slice()).length,u=0;u<a;u++)c[u].apply(this,s);return!0},r.prototype.addListener=function(e,t){var a;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(a=i(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var r=!1;function o(){this.removeListener(e,o),r||(r=!0,t.apply(this,arguments))}return o.listener=t,this.on(e,o),this},r.prototype.removeListener=function(e,t){var r,i,a,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(r=this._events[e]).length,i=-1,r===t||n(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(s=a;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){i=s;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(1),i=r(3),a=n(r(12)),s=n(r(13));function u(e){return function(t){const{gl:r,water:n,size:o}=e;r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffers.reflection),r.viewport(0,0,o,o),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),t(),r.bindFramebuffer(r.FRAMEBUFFER,null)}}function c(e){return function(t){const{gl:r,water:n,size:o}=e;r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffers.refraction),r.viewport(0,0,o,o),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),t(),r.bindFramebuffer(r.FRAMEBUFFER,null)}}function l(e){const{size:t,program:r,gl:n,water:a}=e;return n.useProgram(r.program),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.textures.dudv),n.uniform1i(r.uniforms.dudvTexture,0),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,a.textures.normalMap),n.uniform1i(r.uniforms.normalMapTexture,1),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,a.textures.refraction),n.uniform1i(r.uniforms.refractionTexture,2),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,a.textures.reflection),n.uniform1i(r.uniforms.reflectionTexture,3),function(e){const{state:s,aspect:u}=e,{projection:c,model:l,view:f}=i.createMatrices({camera:s.camera,aspect:u});o.scale(l,l,[t,t,1]),n.useProgram(r.program),i.bindBuffer(n,a.buffers.position,r.attributes.position,3),i.bindBuffer(n,a.buffers.texture,r.attributes.textureCoord,2),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a.buffers.indices),n.uniform1f(r.uniforms.dudvOffset,s.water.time/1e3*.03%1),n.uniform1i(r.uniforms.useRefraction,Number(s.water.useRefraction)),n.uniform1i(r.uniforms.useReflection,Number(s.water.useReflection)),n.uniform3fv(r.uniforms.cameraPosition,s.camera.position),n.uniform3fv(r.uniforms.directionalLightVector,s.light.direction),n.uniform3fv(r.uniforms.directionalLightColor,s.light.color),n.uniformMatrix4fv(r.uniforms.projection,!1,c),n.uniformMatrix4fv(r.uniforms.model,!1,l),n.uniformMatrix4fv(r.uniforms.view,!1,f),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.drawElements(n.TRIANGLES,a.size,n.UNSIGNED_SHORT,0),n.disable(n.BLEND)}}t.createWater=async function(e,t){const{size:r}=t,n=await i.loadTexture(e,"textures/dudvmap.png"),o=await i.loadTexture(e,"textures/normalmap.png"),[f,d]=i.createFramebufferAndTexture(e,r,r),[m,h]=i.createFramebufferAndTexture(e,r,r),p={position:[-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0],indices:[0,2,1,1,2,3],texture:[0,0,1,0,0,1,1,1]},v={gl:e,program:i.createProgram(e,a.default,s.default),size:r,water:i.bindArraysToBuffers(e,{arrays:p,framebuffers:{refraction:d,reflection:h},textures:{dudv:n,normalMap:o,refraction:f,reflection:m}})};return{render:l(v),updateReflectionTexture:u(v),updateRefractionTexture:c(v)}}},function(e,t){e.exports="attribute vec4 position;\r\nattribute vec2 textureCoord;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform lowp vec3 cameraPosition;\r\n\r\nvarying highp vec2 vTextureCoord;\r\nvarying highp vec4 clipSpace;\r\nvarying highp vec3 fromFragmentToCamera;\r\nvarying lowp float reflectionYOffset;\r\n\r\nconst lowp float tiling = 10.0;\r\n\r\nvoid main() {\r\n    vec4 worldPosition = model * position;\r\n    gl_Position = clipSpace = projection * view * worldPosition;\r\n\r\n    fromFragmentToCamera = cameraPosition - worldPosition.xyz;\r\n    vTextureCoord = textureCoord * tiling;\r\n}"},function(e,t){e.exports="varying lowp vec2 vTextureCoord;\r\nvarying lowp vec4 clipSpace;\r\nvarying lowp vec3 fromFragmentToCamera;\r\n\r\nuniform sampler2D dudvTexture;\r\nuniform sampler2D normalMapTexture;\r\nuniform sampler2D refractionTexture;\r\nuniform sampler2D reflectionTexture;\r\nuniform lowp float dudvOffset;\r\nuniform int useRefraction;\r\nuniform int useReflection;\r\nuniform lowp vec3 directionalLightVector;\r\nuniform lowp vec3 directionalLightColor;\r\n\r\nconst lowp float waterDistortionStrenth = 0.02;\r\nconst lowp float fresnelStrength = 1.0;\r\nconst lowp float waterReflectivity = 0.5;\r\nconst lowp vec4 shallowWaterColor =  vec4(0.0, 0.1, 0.3, 1.0);\r\n// const lowp vec4 deepWaterColor = vec4(0.0, 0.1, 0.2, 1.0);\r\nconst lowp float shineDamper = 20.0;\r\n\r\nvoid main() {\r\n    // distortion\r\n    lowp vec2 distortedTexCoords = texture2D(dudvTexture, vec2(vTextureCoord.x, vTextureCoord.y + dudvOffset)).xy * 0.1;\r\n    distortedTexCoords = vTextureCoord + vec2(distortedTexCoords.x + dudvOffset, distortedTexCoords.y);\r\n\r\n    lowp vec2 totalDistortion = (texture2D(dudvTexture, distortedTexCoords).xy * 2.0 - 1.0) * waterDistortionStrenth;\r\n\r\n    // base refract/reflect texture coordinates\r\n    lowp vec2 ndc = (clipSpace.xy / clipSpace.w) / 2.0 + 0.5;\r\n    lowp vec2 refractTexCoords = vec2(ndc.x, +ndc.y);\r\n    lowp vec2 reflectTexCoords = vec2(ndc.x, 1.0-ndc.y);\r\n\r\n\r\n    // refractive factor\r\n    lowp vec3 toCamera = normalize(fromFragmentToCamera);\r\n    lowp vec4 normalMapColor = texture2D(normalMapTexture, distortedTexCoords);\r\n    lowp vec3 normal = normalMapColor.xyz * 2.0 - 1.0;\r\n    normal = normalize(normal);\r\n    lowp float refractiveFactor = dot(toCamera, normal);\r\n    // TODO do we need this?\r\n    // refractiveFactor = pow(refractiveFactor, fresnelStrength);\r\n\r\n    // puting all together\r\n    refractTexCoords += totalDistortion;\r\n    reflectTexCoords += totalDistortion;\r\n    // refractTexCoords = clamp(refractTexCoords, 0.001, 0.999);\r\n    // reflectTexCoords.x = clamp(reflectTexCoords.x, 0.001, 0.999);\r\n    // reflectTexCoords.y = clamp(reflectTexCoords.y, 0.001, 0.999);\r\n\r\n    // lighs\r\n    lowp vec3 reflectedLight = reflect(normalize(directionalLightVector), normal);\r\n    lowp float specular = max(dot(reflectedLight, toCamera), 0.0);\r\n    specular = pow(specular, shineDamper);\r\n    lowp vec3 specularHighlights = directionalLightColor * specular * waterReflectivity;\r\n\r\n    // color\r\n    lowp vec4 refractColor = texture2D(refractionTexture, refractTexCoords);\r\n    lowp vec4 reflectColor = texture2D(reflectionTexture, reflectTexCoords);\r\n\r\n    if (useReflection == 1 && useRefraction == 1) {\r\n      gl_FragColor = mix(reflectColor, refractColor, refractiveFactor);\r\n    } else if (useReflection == 1) {\r\n      gl_FragColor = reflectColor;\r\n    } else if (useRefraction == 1) {\r\n      gl_FragColor = refractColor;\r\n    }\r\n    gl_FragColor = mix(gl_FragColor, shallowWaterColor, 0.2);\r\n\r\n    gl_FragColor = gl_FragColor + vec4(specularHighlights, 1.0);\r\n}\r\n"},function(e,t){e.exports="attribute vec4 position;\r\n\r\nuniform lowp mat4 view;\r\nuniform lowp mat4 model;\r\nuniform lowp mat4 projection;\r\n\r\nvarying lowp vec4 worldPosition;\r\n\r\nvoid main() {\r\n    worldPosition = position;\r\n    gl_Position = projection * view * model * worldPosition;\r\n}"},function(e,t){e.exports="uniform lowp vec3 sunPosition;\r\nuniform lowp vec3 cameraPosition;\r\n\r\nconst lowp float PI = 3.1415926535897932384626433832795;\r\nconst lowp float PI_2 = 1.57079632679489661923;\r\nconst lowp float si = 22.0; // sun intencity\r\n\r\nconst lowp float earthRadius = 6371e3;\r\nconst lowp float atmosphereRadius = 6471e3;\r\nconst lowp float rsh = 8.0e3; // Rayleigh scale height\r\nconst lowp float msh = 1.2e3; // Mie scale height\r\n\r\nconst lowp vec3 rsc = vec3(5.5e-6, 13.0e-6, 22.4e-6); // Rayleigh scattering coefficient\r\nconst lowp float msc = 21e-6; // Mie scattering coefficient\r\n\r\nconst lowp float gr = 0.0; // Rayleigh simetry constant\r\nconst lowp float gm = 0.758; // Mie simetry constant\r\n\r\nvarying lowp vec4 worldPosition;\r\nvarying lowp vec4 sunView;\r\n\r\nconst int samples = 5;\r\n\r\n// https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\r\nlowp float phase(\r\n    lowp float g,\r\n    lowp float a\r\n) {\r\n    lowp float g2 = g * g;\r\n    return 3.0 * (1.0 - g2)  * (1.0 + a * a) / 8.0 / PI / (2.0 + g2) / pow(1.0 + g2 - 2.0 * g * a, 1.5);\r\n}\r\n\r\nlowp vec3 translate(lowp vec3 dir) {\r\n    lowp float r1 = earthRadius;\r\n    lowp float r2 = atmosphereRadius;\r\n\r\n    lowp float al0 = asin(dir.z);\r\n    lowp float az0 = atan(dir.y / dir.x);\r\n    if (dir.x < 0.0) {\r\n        az0 += PI;\r\n    }\r\n    lowp float al1 = asin(r1 / r2);\r\n    lowp float al2 = al1 + (1.0 - al1 / PI_2) * al0;\r\n    return vec3(\r\n        cos(al2) * cos(az0),\r\n        cos(al2) * sin(az0),\r\n        sin(al2)\r\n    );\r\n}\r\n\r\n// http://viclw17.github.io/2018/07/16/raytracing-ray-sphere-intersection/\r\nlowp float dtse(\r\n    lowp vec3 origin,\r\n    lowp vec3 direction,\r\n    lowp float radius\r\n) {\r\n    lowp vec3 center = vec3(0.0); // could be used as parameter\r\n    lowp vec3 oc = origin - center;\r\n    lowp float a = dot(direction, direction);\r\n    lowp float b = 2.0 * dot(direction, oc);\r\n    lowp float c = dot(oc, oc) - radius * radius;\r\n    lowp float d = b * b - 4.0 * a * c;\r\n    if (d < 0.0) {\r\n        return -1.0;\r\n    }\r\n    lowp float qd = sqrt(d);\r\n    lowp float t = (-qd - b) / 2.0 / a;\r\n    if (t >= 0.0) {\r\n        return t;\r\n    }\r\n    t = (qd - b) / 2.0 / a;\r\n    if (t > 0.0) {\r\n        return t;\r\n    }\r\n    return -1.0;\r\n}\r\n\r\nlowp vec3 getSunColor(\r\n    lowp vec3 sun,\r\n    lowp vec3 position\r\n) {\r\n    lowp float angle = acos(dot(\r\n        sun,\r\n        position\r\n    ));\r\n    return vec3(1.0) * (1.0 - smoothstep(0.0, 1.0, angle * 20.0));\r\n}\r\n\r\nvoid main() {\r\n    lowp vec3 camera = vec3(0.0, 0.0, earthRadius);\r\n    lowp vec3 world = normalize(worldPosition.xyz);\r\n    lowp vec3 position = translate(world) * atmosphereRadius;\r\n    lowp vec3 ray = normalize(position - camera);\r\n    lowp vec3 sun = normalize(sunPosition);\r\n\r\n    lowp float far = dtse(camera, ray, atmosphereRadius);\r\n\r\n    lowp float lightAngle = dot(ray, sun);\r\n    lowp float rshFactor = phase(gr, lightAngle);\r\n    lowp float mieFactor = phase(gm, lightAngle);\r\n\r\n    lowp float sampleSize = far / float(samples);\r\n    lowp vec3 samplePoint = camera + ray * sampleSize * 0.5;\r\n    lowp float rshOpticalDepth = 0.0;\r\n    lowp float mieOpticalDepth = 0.0;\r\n    lowp vec3 rshAccumulated = vec3(0.0);\r\n    lowp vec3 mieAccumulated = vec3(0.0);\r\n\r\n    for (int i = 0; i < samples; i ++) {\r\n        lowp float far2 = dtse(\r\n            samplePoint,\r\n            sun,\r\n            atmosphereRadius\r\n        );\r\n        lowp float sampleSize2 = far2 / float(samples);\r\n        lowp vec3 samplePoint2 = samplePoint + sampleSize2 / 2.0 * sun;\r\n        lowp float rshOpticalDepth2 = 0.0;\r\n        lowp float mieOpticalDepth2 = 0.0;\r\n\r\n        for (int j = 0; j < samples; j ++) {\r\n            lowp float height = length(samplePoint2) - earthRadius;\r\n            lowp float rshOpticalDepthStep = exp(-height / rsh) * sampleSize2;\r\n            lowp float mieOpticalDepthStep = exp(-height / msh) * sampleSize2;\r\n\r\n            rshOpticalDepth2 += rshOpticalDepthStep;\r\n            mieOpticalDepth2 += mieOpticalDepthStep;\r\n\r\n            samplePoint2 += sun * sampleSize2;\r\n        }\r\n\r\n        lowp float height = length(samplePoint) - earthRadius;\r\n        lowp float rshOpticalDepthStep = exp(-height / rsh) * sampleSize;\r\n        lowp float mieOpticalDepthStep = exp(-height / msh) * sampleSize;\r\n\r\n        rshOpticalDepth += rshOpticalDepthStep;\r\n        mieOpticalDepth += mieOpticalDepthStep;\r\n\r\n        lowp vec3 outScattering = exp(\r\n            -rsc * (rshOpticalDepth + rshOpticalDepth2)\r\n            -msc * (mieOpticalDepth + mieOpticalDepth2)\r\n        );\r\n\r\n        rshAccumulated += rshOpticalDepthStep * outScattering;\r\n        mieAccumulated += mieOpticalDepthStep * outScattering;\r\n\r\n        samplePoint += ray * sampleSize;\r\n    }\r\n\r\n    lowp vec3 color = vec3(0.0);\r\n\r\n    // mieAccumulated *= 0.0;\r\n    // rshAccumulated *= 0.5;\r\n    lowp vec3 sunColor = getSunColor(sun, world);\r\n    lowp vec3 totalLight = si * (\r\n        rshFactor * rsc * rshAccumulated +\r\n        mieFactor * msc * mieAccumulated\r\n    );\r\n    // color += totalLight;\r\n    color += 1.0 - exp(-1.0 * totalLight);\r\n    color += sunColor;\r\n\r\n    gl_FragColor = vec4(color, 1.0);\r\n}\r\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),o=r(3),i=r(4),a={app:{active:!0},camera:{center:n.fromValues(-596,-492,111),position:n.fromValues(-201,115,168)},terrain:{visible:!0},water:{start:Date.now(),time:0,visible:!0,useReflection:!0,useRefraction:!0},light:{direction:n.fromValues(0,0,0),color:n.fromValues(0,0,0)},sky:{dayTime:324e5,visible:!0,sunPosition:n.fromValues(0,0,0),autoSunMove:!1}};t.getInitialState=(()=>(s(a,a.sky.dayTime),a)),t.toggle=((e,t,r)=>{e[t][r]=!e[t][r]}),t.zoom=((e,t)=>{const{position:r,center:i}=e.camera,a=n.create(),s=n.distance(i,r),u=o.inRange(s+t,50,1e3);n.sub(a,r,i),n.scale(a,a,u/s),n.add(r,i,a)}),t.moveCamera=((e,t)=>{const{position:r,center:o}=e.camera,i=n.create(),a=n.create(),s=n.create();n.sub(i,o,r),n.rotateZ(a,i,[0,0,1],Math.PI/2),a[2]=0,1===t.forward&&n.add(s,s,i),-1===t.forward&&n.sub(s,s,i),1===t.left&&n.add(s,s,a),-1===t.left&&n.sub(s,s,a),n.normalize(s,s),n.add(s,s,[0,0,t.up]),n.scale(s,s,6),n.add(r,r,s),n.add(o,o,s)}),t.rorateCamera=((e,t,r)=>{const{position:o,center:i}=e.camera,a=n.create();n.sub(a,i,o);const s=n.length(a);n.rotateZ(a,a,[0,0,0],t),a[2]-=r,n.normalize(a,a),n.scale(a,a,s),n.add(i,o,a)}),t.moveSun=((e,t)=>{let r=e.sky.dayTime+t;r<0?r+=864e5:r>864e5&&(r-=864e5),s(e,r)}),t.autoMoveSun=((e,r)=>{e.sky.autoSunMove&&t.moveSun(e,r)}),t.updateWaterTime=(e=>{e.water.time=Date.now()-e.water.start});const s=(e,t)=>{const{sunPosition:r,directionalLightColor:n,directionalLightVector:o}=i.getSunPosition(t);e.sky.dayTime=t,e.sky.sunPosition=r,e.light.color=n,e.light.direction=o}}]);
//# sourceMappingURL=index.js.map