!function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=5)}([function(e,r,t){"use strict";t.d(r,"b",function(){return n}),t.d(r,"a",function(){return o}),t.d(r,"c",function(){return i});var n=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array,i=Math.random;Math.PI},function(e,r,t){"use strict";t.r(r),t.d(r,"create",function(){return o}),t.d(r,"clone",function(){return i}),t.d(r,"copy",function(){return a}),t.d(r,"fromValues",function(){return u}),t.d(r,"set",function(){return s}),t.d(r,"identity",function(){return c}),t.d(r,"transpose",function(){return f}),t.d(r,"invert",function(){return l}),t.d(r,"adjoint",function(){return d}),t.d(r,"determinant",function(){return m}),t.d(r,"multiply",function(){return h}),t.d(r,"translate",function(){return v}),t.d(r,"scale",function(){return p}),t.d(r,"rotate",function(){return g}),t.d(r,"rotateX",function(){return T}),t.d(r,"rotateY",function(){return M}),t.d(r,"rotateZ",function(){return b}),t.d(r,"fromTranslation",function(){return E}),t.d(r,"fromScaling",function(){return x}),t.d(r,"fromRotation",function(){return _}),t.d(r,"fromXRotation",function(){return w}),t.d(r,"fromYRotation",function(){return R}),t.d(r,"fromZRotation",function(){return y}),t.d(r,"fromRotationTranslation",function(){return C}),t.d(r,"fromQuat2",function(){return F}),t.d(r,"getTranslation",function(){return A}),t.d(r,"getScaling",function(){return L}),t.d(r,"getRotation",function(){return P}),t.d(r,"fromRotationTranslationScale",function(){return D}),t.d(r,"fromRotationTranslationScaleOrigin",function(){return S}),t.d(r,"fromQuat",function(){return U}),t.d(r,"frustum",function(){return B}),t.d(r,"perspective",function(){return I}),t.d(r,"perspectiveFromFieldOfView",function(){return O}),t.d(r,"ortho",function(){return z}),t.d(r,"lookAt",function(){return N}),t.d(r,"targetTo",function(){return X}),t.d(r,"str",function(){return k}),t.d(r,"frob",function(){return V}),t.d(r,"add",function(){return j}),t.d(r,"subtract",function(){return q}),t.d(r,"multiplyScalar",function(){return W}),t.d(r,"multiplyScalarAndAdd",function(){return G}),t.d(r,"exactEquals",function(){return H}),t.d(r,"equals",function(){return Y}),t.d(r,"mul",function(){return Q}),t.d(r,"sub",function(){return Z});var n=t(0);function o(){var e=new n.a(16);return n.a!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function i(e){var r=new n.a(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function a(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function u(e,r,t,o,i,a,u,s,c,f,l,d,m,h,v,p){var g=new n.a(16);return g[0]=e,g[1]=r,g[2]=t,g[3]=o,g[4]=i,g[5]=a,g[6]=u,g[7]=s,g[8]=c,g[9]=f,g[10]=l,g[11]=d,g[12]=m,g[13]=h,g[14]=v,g[15]=p,g}function s(e,r,t,n,o,i,a,u,s,c,f,l,d,m,h,v,p){return e[0]=r,e[1]=t,e[2]=n,e[3]=o,e[4]=i,e[5]=a,e[6]=u,e[7]=s,e[8]=c,e[9]=f,e[10]=l,e[11]=d,e[12]=m,e[13]=h,e[14]=v,e[15]=p,e}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function f(e,r){if(e===r){var t=r[1],n=r[2],o=r[3],i=r[6],a=r[7],u=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=t,e[6]=r[9],e[7]=r[13],e[8]=n,e[9]=i,e[11]=r[14],e[12]=o,e[13]=a,e[14]=u}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function l(e,r){var t=r[0],n=r[1],o=r[2],i=r[3],a=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=r[9],d=r[10],m=r[11],h=r[12],v=r[13],p=r[14],g=r[15],T=t*u-n*a,M=t*s-o*a,b=t*c-i*a,E=n*s-o*u,x=n*c-i*u,_=o*c-i*s,w=f*v-l*h,R=f*p-d*h,y=f*g-m*h,C=l*p-d*v,F=l*g-m*v,A=d*g-m*p,L=T*A-M*F+b*C+E*y-x*R+_*w;return L?(L=1/L,e[0]=(u*A-s*F+c*C)*L,e[1]=(o*F-n*A-i*C)*L,e[2]=(v*_-p*x+g*E)*L,e[3]=(d*x-l*_-m*E)*L,e[4]=(s*y-a*A-c*R)*L,e[5]=(t*A-o*y+i*R)*L,e[6]=(p*b-h*_-g*M)*L,e[7]=(f*_-d*b+m*M)*L,e[8]=(a*F-u*y+c*w)*L,e[9]=(n*y-t*F-i*w)*L,e[10]=(h*x-v*b+g*T)*L,e[11]=(l*b-f*x-m*T)*L,e[12]=(u*R-a*C-s*w)*L,e[13]=(t*C-n*R+o*w)*L,e[14]=(v*M-h*E-p*T)*L,e[15]=(f*E-l*M+d*T)*L,e):null}function d(e,r){var t=r[0],n=r[1],o=r[2],i=r[3],a=r[4],u=r[5],s=r[6],c=r[7],f=r[8],l=r[9],d=r[10],m=r[11],h=r[12],v=r[13],p=r[14],g=r[15];return e[0]=u*(d*g-m*p)-l*(s*g-c*p)+v*(s*m-c*d),e[1]=-(n*(d*g-m*p)-l*(o*g-i*p)+v*(o*m-i*d)),e[2]=n*(s*g-c*p)-u*(o*g-i*p)+v*(o*c-i*s),e[3]=-(n*(s*m-c*d)-u*(o*m-i*d)+l*(o*c-i*s)),e[4]=-(a*(d*g-m*p)-f*(s*g-c*p)+h*(s*m-c*d)),e[5]=t*(d*g-m*p)-f*(o*g-i*p)+h*(o*m-i*d),e[6]=-(t*(s*g-c*p)-a*(o*g-i*p)+h*(o*c-i*s)),e[7]=t*(s*m-c*d)-a*(o*m-i*d)+f*(o*c-i*s),e[8]=a*(l*g-m*v)-f*(u*g-c*v)+h*(u*m-c*l),e[9]=-(t*(l*g-m*v)-f*(n*g-i*v)+h*(n*m-i*l)),e[10]=t*(u*g-c*v)-a*(n*g-i*v)+h*(n*c-i*u),e[11]=-(t*(u*m-c*l)-a*(n*m-i*l)+f*(n*c-i*u)),e[12]=-(a*(l*p-d*v)-f*(u*p-s*v)+h*(u*d-s*l)),e[13]=t*(l*p-d*v)-f*(n*p-o*v)+h*(n*d-o*l),e[14]=-(t*(u*p-s*v)-a*(n*p-o*v)+h*(n*s-o*u)),e[15]=t*(u*d-s*l)-a*(n*d-o*l)+f*(n*s-o*u),e}function m(e){var r=e[0],t=e[1],n=e[2],o=e[3],i=e[4],a=e[5],u=e[6],s=e[7],c=e[8],f=e[9],l=e[10],d=e[11],m=e[12],h=e[13],v=e[14],p=e[15];return(r*a-t*i)*(l*p-d*v)-(r*u-n*i)*(f*p-d*h)+(r*s-o*i)*(f*v-l*h)+(t*u-n*a)*(c*p-d*m)-(t*s-o*a)*(c*v-l*m)+(n*s-o*u)*(c*h-f*m)}function h(e,r,t){var n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],d=r[9],m=r[10],h=r[11],v=r[12],p=r[13],g=r[14],T=r[15],M=t[0],b=t[1],E=t[2],x=t[3];return e[0]=M*n+b*u+E*l+x*v,e[1]=M*o+b*s+E*d+x*p,e[2]=M*i+b*c+E*m+x*g,e[3]=M*a+b*f+E*h+x*T,M=t[4],b=t[5],E=t[6],x=t[7],e[4]=M*n+b*u+E*l+x*v,e[5]=M*o+b*s+E*d+x*p,e[6]=M*i+b*c+E*m+x*g,e[7]=M*a+b*f+E*h+x*T,M=t[8],b=t[9],E=t[10],x=t[11],e[8]=M*n+b*u+E*l+x*v,e[9]=M*o+b*s+E*d+x*p,e[10]=M*i+b*c+E*m+x*g,e[11]=M*a+b*f+E*h+x*T,M=t[12],b=t[13],E=t[14],x=t[15],e[12]=M*n+b*u+E*l+x*v,e[13]=M*o+b*s+E*d+x*p,e[14]=M*i+b*c+E*m+x*g,e[15]=M*a+b*f+E*h+x*T,e}function v(e,r,t){var n,o,i,a,u,s,c,f,l,d,m,h,v=t[0],p=t[1],g=t[2];return r===e?(e[12]=r[0]*v+r[4]*p+r[8]*g+r[12],e[13]=r[1]*v+r[5]*p+r[9]*g+r[13],e[14]=r[2]*v+r[6]*p+r[10]*g+r[14],e[15]=r[3]*v+r[7]*p+r[11]*g+r[15]):(n=r[0],o=r[1],i=r[2],a=r[3],u=r[4],s=r[5],c=r[6],f=r[7],l=r[8],d=r[9],m=r[10],h=r[11],e[0]=n,e[1]=o,e[2]=i,e[3]=a,e[4]=u,e[5]=s,e[6]=c,e[7]=f,e[8]=l,e[9]=d,e[10]=m,e[11]=h,e[12]=n*v+u*p+l*g+r[12],e[13]=o*v+s*p+d*g+r[13],e[14]=i*v+c*p+m*g+r[14],e[15]=a*v+f*p+h*g+r[15]),e}function p(e,r,t){var n=t[0],o=t[1],i=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*o,e[5]=r[5]*o,e[6]=r[6]*o,e[7]=r[7]*o,e[8]=r[8]*i,e[9]=r[9]*i,e[10]=r[10]*i,e[11]=r[11]*i,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function g(e,r,t,o){var i,a,u,s,c,f,l,d,m,h,v,p,g,T,M,b,E,x,_,w,R,y,C,F,A=o[0],L=o[1],P=o[2],D=Math.sqrt(A*A+L*L+P*P);return D<n.b?null:(A*=D=1/D,L*=D,P*=D,i=Math.sin(t),u=1-(a=Math.cos(t)),s=r[0],c=r[1],f=r[2],l=r[3],d=r[4],m=r[5],h=r[6],v=r[7],p=r[8],g=r[9],T=r[10],M=r[11],b=A*A*u+a,E=L*A*u+P*i,x=P*A*u-L*i,_=A*L*u-P*i,w=L*L*u+a,R=P*L*u+A*i,y=A*P*u+L*i,C=L*P*u-A*i,F=P*P*u+a,e[0]=s*b+d*E+p*x,e[1]=c*b+m*E+g*x,e[2]=f*b+h*E+T*x,e[3]=l*b+v*E+M*x,e[4]=s*_+d*w+p*R,e[5]=c*_+m*w+g*R,e[6]=f*_+h*w+T*R,e[7]=l*_+v*w+M*R,e[8]=s*y+d*C+p*F,e[9]=c*y+m*C+g*F,e[10]=f*y+h*C+T*F,e[11]=l*y+v*C+M*F,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function T(e,r,t){var n=Math.sin(t),o=Math.cos(t),i=r[4],a=r[5],u=r[6],s=r[7],c=r[8],f=r[9],l=r[10],d=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=i*o+c*n,e[5]=a*o+f*n,e[6]=u*o+l*n,e[7]=s*o+d*n,e[8]=c*o-i*n,e[9]=f*o-a*n,e[10]=l*o-u*n,e[11]=d*o-s*n,e}function M(e,r,t){var n=Math.sin(t),o=Math.cos(t),i=r[0],a=r[1],u=r[2],s=r[3],c=r[8],f=r[9],l=r[10],d=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*o-c*n,e[1]=a*o-f*n,e[2]=u*o-l*n,e[3]=s*o-d*n,e[8]=i*n+c*o,e[9]=a*n+f*o,e[10]=u*n+l*o,e[11]=s*n+d*o,e}function b(e,r,t){var n=Math.sin(t),o=Math.cos(t),i=r[0],a=r[1],u=r[2],s=r[3],c=r[4],f=r[5],l=r[6],d=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*o+c*n,e[1]=a*o+f*n,e[2]=u*o+l*n,e[3]=s*o+d*n,e[4]=c*o-i*n,e[5]=f*o-a*n,e[6]=l*o-u*n,e[7]=d*o-s*n,e}function E(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function x(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(e,r,t){var o,i,a,u=t[0],s=t[1],c=t[2],f=Math.sqrt(u*u+s*s+c*c);return f<n.b?null:(u*=f=1/f,s*=f,c*=f,o=Math.sin(r),a=1-(i=Math.cos(r)),e[0]=u*u*a+i,e[1]=s*u*a+c*o,e[2]=c*u*a-s*o,e[3]=0,e[4]=u*s*a-c*o,e[5]=s*s*a+i,e[6]=c*s*a+u*o,e[7]=0,e[8]=u*c*a+s*o,e[9]=s*c*a-u*o,e[10]=c*c*a+i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function w(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=t,e[7]=0,e[8]=0,e[9]=-t,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function R(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=0,e[2]=-t,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=t,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,r){var t=Math.sin(r),n=Math.cos(r);return e[0]=n,e[1]=t,e[2]=0,e[3]=0,e[4]=-t,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,r,t){var n=r[0],o=r[1],i=r[2],a=r[3],u=n+n,s=o+o,c=i+i,f=n*u,l=n*s,d=n*c,m=o*s,h=o*c,v=i*c,p=a*u,g=a*s,T=a*c;return e[0]=1-(m+v),e[1]=l+T,e[2]=d-g,e[3]=0,e[4]=l-T,e[5]=1-(f+v),e[6]=h+p,e[7]=0,e[8]=d+g,e[9]=h-p,e[10]=1-(f+m),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function F(e,r){var t=new n.a(3),o=-r[0],i=-r[1],a=-r[2],u=r[3],s=r[4],c=r[5],f=r[6],l=r[7],d=o*o+i*i+a*a+u*u;return d>0?(t[0]=2*(s*u+l*o+c*a-f*i)/d,t[1]=2*(c*u+l*i+f*o-s*a)/d,t[2]=2*(f*u+l*a+s*i-c*o)/d):(t[0]=2*(s*u+l*o+c*a-f*i),t[1]=2*(c*u+l*i+f*o-s*a),t[2]=2*(f*u+l*a+s*i-c*o)),C(e,r,t),e}function A(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function L(e,r){var t=r[0],n=r[1],o=r[2],i=r[4],a=r[5],u=r[6],s=r[8],c=r[9],f=r[10];return e[0]=Math.sqrt(t*t+n*n+o*o),e[1]=Math.sqrt(i*i+a*a+u*u),e[2]=Math.sqrt(s*s+c*c+f*f),e}function P(e,r){var t=r[0]+r[5]+r[10],n=0;return t>0?(n=2*Math.sqrt(t+1),e[3]=.25*n,e[0]=(r[6]-r[9])/n,e[1]=(r[8]-r[2])/n,e[2]=(r[1]-r[4])/n):r[0]>r[5]&&r[0]>r[10]?(n=2*Math.sqrt(1+r[0]-r[5]-r[10]),e[3]=(r[6]-r[9])/n,e[0]=.25*n,e[1]=(r[1]+r[4])/n,e[2]=(r[8]+r[2])/n):r[5]>r[10]?(n=2*Math.sqrt(1+r[5]-r[0]-r[10]),e[3]=(r[8]-r[2])/n,e[0]=(r[1]+r[4])/n,e[1]=.25*n,e[2]=(r[6]+r[9])/n):(n=2*Math.sqrt(1+r[10]-r[0]-r[5]),e[3]=(r[1]-r[4])/n,e[0]=(r[8]+r[2])/n,e[1]=(r[6]+r[9])/n,e[2]=.25*n),e}function D(e,r,t,n){var o=r[0],i=r[1],a=r[2],u=r[3],s=o+o,c=i+i,f=a+a,l=o*s,d=o*c,m=o*f,h=i*c,v=i*f,p=a*f,g=u*s,T=u*c,M=u*f,b=n[0],E=n[1],x=n[2];return e[0]=(1-(h+p))*b,e[1]=(d+M)*b,e[2]=(m-T)*b,e[3]=0,e[4]=(d-M)*E,e[5]=(1-(l+p))*E,e[6]=(v+g)*E,e[7]=0,e[8]=(m+T)*x,e[9]=(v-g)*x,e[10]=(1-(l+h))*x,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function S(e,r,t,n,o){var i=r[0],a=r[1],u=r[2],s=r[3],c=i+i,f=a+a,l=u+u,d=i*c,m=i*f,h=i*l,v=a*f,p=a*l,g=u*l,T=s*c,M=s*f,b=s*l,E=n[0],x=n[1],_=n[2],w=o[0],R=o[1],y=o[2],C=(1-(v+g))*E,F=(m+b)*E,A=(h-M)*E,L=(m-b)*x,P=(1-(d+g))*x,D=(p+T)*x,S=(h+M)*_,U=(p-T)*_,B=(1-(d+v))*_;return e[0]=C,e[1]=F,e[2]=A,e[3]=0,e[4]=L,e[5]=P,e[6]=D,e[7]=0,e[8]=S,e[9]=U,e[10]=B,e[11]=0,e[12]=t[0]+w-(C*w+L*R+S*y),e[13]=t[1]+R-(F*w+P*R+U*y),e[14]=t[2]+y-(A*w+D*R+B*y),e[15]=1,e}function U(e,r){var t=r[0],n=r[1],o=r[2],i=r[3],a=t+t,u=n+n,s=o+o,c=t*a,f=n*a,l=n*u,d=o*a,m=o*u,h=o*s,v=i*a,p=i*u,g=i*s;return e[0]=1-l-h,e[1]=f+g,e[2]=d-p,e[3]=0,e[4]=f-g,e[5]=1-c-h,e[6]=m+v,e[7]=0,e[8]=d+p,e[9]=m-v,e[10]=1-c-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function B(e,r,t,n,o,i,a){var u=1/(t-r),s=1/(o-n),c=1/(i-a);return e[0]=2*i*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*s,e[6]=0,e[7]=0,e[8]=(t+r)*u,e[9]=(o+n)*s,e[10]=(a+i)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*i*2*c,e[15]=0,e}function I(e,r,t,n,o){var i,a=1/Math.tan(r/2);return e[0]=a/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(i=1/(n-o),e[10]=(o+n)*i,e[14]=2*o*n*i):(e[10]=-1,e[14]=-2*n),e}function O(e,r,t,n){var o=Math.tan(r.upDegrees*Math.PI/180),i=Math.tan(r.downDegrees*Math.PI/180),a=Math.tan(r.leftDegrees*Math.PI/180),u=Math.tan(r.rightDegrees*Math.PI/180),s=2/(a+u),c=2/(o+i);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-u)*s*.5,e[9]=(o-i)*c*.5,e[10]=n/(t-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*t/(t-n),e[15]=0,e}function z(e,r,t,n,o,i,a){var u=1/(r-t),s=1/(n-o),c=1/(i-a);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(r+t)*u,e[13]=(o+n)*s,e[14]=(a+i)*c,e[15]=1,e}function N(e,r,t,o){var i,a,u,s,f,l,d,m,h,v,p=r[0],g=r[1],T=r[2],M=o[0],b=o[1],E=o[2],x=t[0],_=t[1],w=t[2];return Math.abs(p-x)<n.b&&Math.abs(g-_)<n.b&&Math.abs(T-w)<n.b?c(e):(d=p-x,m=g-_,h=T-w,i=b*(h*=v=1/Math.sqrt(d*d+m*m+h*h))-E*(m*=v),a=E*(d*=v)-M*h,u=M*m-b*d,(v=Math.sqrt(i*i+a*a+u*u))?(i*=v=1/v,a*=v,u*=v):(i=0,a=0,u=0),s=m*u-h*a,f=h*i-d*u,l=d*a-m*i,(v=Math.sqrt(s*s+f*f+l*l))?(s*=v=1/v,f*=v,l*=v):(s=0,f=0,l=0),e[0]=i,e[1]=s,e[2]=d,e[3]=0,e[4]=a,e[5]=f,e[6]=m,e[7]=0,e[8]=u,e[9]=l,e[10]=h,e[11]=0,e[12]=-(i*p+a*g+u*T),e[13]=-(s*p+f*g+l*T),e[14]=-(d*p+m*g+h*T),e[15]=1,e)}function X(e,r,t,n){var o=r[0],i=r[1],a=r[2],u=n[0],s=n[1],c=n[2],f=o-t[0],l=i-t[1],d=a-t[2],m=f*f+l*l+d*d;m>0&&(f*=m=1/Math.sqrt(m),l*=m,d*=m);var h=s*d-c*l,v=c*f-u*d,p=u*l-s*f;return(m=h*h+v*v+p*p)>0&&(h*=m=1/Math.sqrt(m),v*=m,p*=m),e[0]=h,e[1]=v,e[2]=p,e[3]=0,e[4]=l*p-d*v,e[5]=d*h-f*p,e[6]=f*v-l*h,e[7]=0,e[8]=f,e[9]=l,e[10]=d,e[11]=0,e[12]=o,e[13]=i,e[14]=a,e[15]=1,e}function k(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function V(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))}function j(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e[3]=r[3]+t[3],e[4]=r[4]+t[4],e[5]=r[5]+t[5],e[6]=r[6]+t[6],e[7]=r[7]+t[7],e[8]=r[8]+t[8],e[9]=r[9]+t[9],e[10]=r[10]+t[10],e[11]=r[11]+t[11],e[12]=r[12]+t[12],e[13]=r[13]+t[13],e[14]=r[14]+t[14],e[15]=r[15]+t[15],e}function q(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e[3]=r[3]-t[3],e[4]=r[4]-t[4],e[5]=r[5]-t[5],e[6]=r[6]-t[6],e[7]=r[7]-t[7],e[8]=r[8]-t[8],e[9]=r[9]-t[9],e[10]=r[10]-t[10],e[11]=r[11]-t[11],e[12]=r[12]-t[12],e[13]=r[13]-t[13],e[14]=r[14]-t[14],e[15]=r[15]-t[15],e}function W(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*t,e[5]=r[5]*t,e[6]=r[6]*t,e[7]=r[7]*t,e[8]=r[8]*t,e[9]=r[9]*t,e[10]=r[10]*t,e[11]=r[11]*t,e[12]=r[12]*t,e[13]=r[13]*t,e[14]=r[14]*t,e[15]=r[15]*t,e}function G(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e[3]=r[3]+t[3]*n,e[4]=r[4]+t[4]*n,e[5]=r[5]+t[5]*n,e[6]=r[6]+t[6]*n,e[7]=r[7]+t[7]*n,e[8]=r[8]+t[8]*n,e[9]=r[9]+t[9]*n,e[10]=r[10]+t[10]*n,e[11]=r[11]+t[11]*n,e[12]=r[12]+t[12]*n,e[13]=r[13]+t[13]*n,e[14]=r[14]+t[14]*n,e[15]=r[15]+t[15]*n,e}function H(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function Y(e,r){var t=e[0],o=e[1],i=e[2],a=e[3],u=e[4],s=e[5],c=e[6],f=e[7],l=e[8],d=e[9],m=e[10],h=e[11],v=e[12],p=e[13],g=e[14],T=e[15],M=r[0],b=r[1],E=r[2],x=r[3],_=r[4],w=r[5],R=r[6],y=r[7],C=r[8],F=r[9],A=r[10],L=r[11],P=r[12],D=r[13],S=r[14],U=r[15];return Math.abs(t-M)<=n.b*Math.max(1,Math.abs(t),Math.abs(M))&&Math.abs(o-b)<=n.b*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-E)<=n.b*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-x)<=n.b*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(u-_)<=n.b*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(s-w)<=n.b*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(c-R)<=n.b*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(f-y)<=n.b*Math.max(1,Math.abs(f),Math.abs(y))&&Math.abs(l-C)<=n.b*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(d-F)<=n.b*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(m-A)<=n.b*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(h-L)<=n.b*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(v-P)<=n.b*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(p-D)<=n.b*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(g-S)<=n.b*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(T-U)<=n.b*Math.max(1,Math.abs(T),Math.abs(U))}var Q=h,Z=q},function(e,r,t){"use strict";t.r(r),t.d(r,"create",function(){return o}),t.d(r,"clone",function(){return i}),t.d(r,"length",function(){return a}),t.d(r,"fromValues",function(){return u}),t.d(r,"copy",function(){return s}),t.d(r,"set",function(){return c}),t.d(r,"add",function(){return f}),t.d(r,"subtract",function(){return l}),t.d(r,"multiply",function(){return d}),t.d(r,"divide",function(){return m}),t.d(r,"ceil",function(){return h}),t.d(r,"floor",function(){return v}),t.d(r,"min",function(){return p}),t.d(r,"max",function(){return g}),t.d(r,"round",function(){return T}),t.d(r,"scale",function(){return M}),t.d(r,"scaleAndAdd",function(){return b}),t.d(r,"distance",function(){return E}),t.d(r,"squaredDistance",function(){return x}),t.d(r,"squaredLength",function(){return _}),t.d(r,"negate",function(){return w}),t.d(r,"inverse",function(){return R}),t.d(r,"normalize",function(){return y}),t.d(r,"dot",function(){return C}),t.d(r,"cross",function(){return F}),t.d(r,"lerp",function(){return A}),t.d(r,"hermite",function(){return L}),t.d(r,"bezier",function(){return P}),t.d(r,"random",function(){return D}),t.d(r,"transformMat4",function(){return S}),t.d(r,"transformMat3",function(){return U}),t.d(r,"transformQuat",function(){return B}),t.d(r,"rotateX",function(){return I}),t.d(r,"rotateY",function(){return O}),t.d(r,"rotateZ",function(){return z}),t.d(r,"angle",function(){return N}),t.d(r,"zero",function(){return X}),t.d(r,"str",function(){return k}),t.d(r,"exactEquals",function(){return V}),t.d(r,"equals",function(){return j}),t.d(r,"sub",function(){return W}),t.d(r,"mul",function(){return G}),t.d(r,"div",function(){return H}),t.d(r,"dist",function(){return Y}),t.d(r,"sqrDist",function(){return Q}),t.d(r,"len",function(){return Z}),t.d(r,"sqrLen",function(){return K}),t.d(r,"forEach",function(){return $});var n=t(0);function o(){var e=new n.a(3);return n.a!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e){var r=new n.a(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function a(e){var r=e[0],t=e[1],n=e[2];return Math.sqrt(r*r+t*t+n*n)}function u(e,r,t){var o=new n.a(3);return o[0]=e,o[1]=r,o[2]=t,o}function s(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function c(e,r,t,n){return e[0]=r,e[1]=t,e[2]=n,e}function f(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function l(e,r,t){return e[0]=r[0]-t[0],e[1]=r[1]-t[1],e[2]=r[2]-t[2],e}function d(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function m(e,r,t){return e[0]=r[0]/t[0],e[1]=r[1]/t[1],e[2]=r[2]/t[2],e}function h(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function v(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function p(e,r,t){return e[0]=Math.min(r[0],t[0]),e[1]=Math.min(r[1],t[1]),e[2]=Math.min(r[2],t[2]),e}function g(e,r,t){return e[0]=Math.max(r[0],t[0]),e[1]=Math.max(r[1],t[1]),e[2]=Math.max(r[2],t[2]),e}function T(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function M(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e}function b(e,r,t,n){return e[0]=r[0]+t[0]*n,e[1]=r[1]+t[1]*n,e[2]=r[2]+t[2]*n,e}function E(e,r){var t=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2];return Math.sqrt(t*t+n*n+o*o)}function x(e,r){var t=r[0]-e[0],n=r[1]-e[1],o=r[2]-e[2];return t*t+n*n+o*o}function _(e){var r=e[0],t=e[1],n=e[2];return r*r+t*t+n*n}function w(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function R(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function y(e,r){var t=r[0],n=r[1],o=r[2],i=t*t+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e}function C(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function F(e,r,t){var n=r[0],o=r[1],i=r[2],a=t[0],u=t[1],s=t[2];return e[0]=o*s-i*u,e[1]=i*a-n*s,e[2]=n*u-o*a,e}function A(e,r,t,n){var o=r[0],i=r[1],a=r[2];return e[0]=o+n*(t[0]-o),e[1]=i+n*(t[1]-i),e[2]=a+n*(t[2]-a),e}function L(e,r,t,n,o,i){var a=i*i,u=a*(2*i-3)+1,s=a*(i-2)+i,c=a*(i-1),f=a*(3-2*i);return e[0]=r[0]*u+t[0]*s+n[0]*c+o[0]*f,e[1]=r[1]*u+t[1]*s+n[1]*c+o[1]*f,e[2]=r[2]*u+t[2]*s+n[2]*c+o[2]*f,e}function P(e,r,t,n,o,i){var a=1-i,u=a*a,s=i*i,c=u*a,f=3*i*u,l=3*s*a,d=s*i;return e[0]=r[0]*c+t[0]*f+n[0]*l+o[0]*d,e[1]=r[1]*c+t[1]*f+n[1]*l+o[1]*d,e[2]=r[2]*c+t[2]*f+n[2]*l+o[2]*d,e}function D(e,r){r=r||1;var t=2*n.c()*Math.PI,o=2*n.c()-1,i=Math.sqrt(1-o*o)*r;return e[0]=Math.cos(t)*i,e[1]=Math.sin(t)*i,e[2]=o*r,e}function S(e,r,t){var n=r[0],o=r[1],i=r[2],a=t[3]*n+t[7]*o+t[11]*i+t[15];return a=a||1,e[0]=(t[0]*n+t[4]*o+t[8]*i+t[12])/a,e[1]=(t[1]*n+t[5]*o+t[9]*i+t[13])/a,e[2]=(t[2]*n+t[6]*o+t[10]*i+t[14])/a,e}function U(e,r,t){var n=r[0],o=r[1],i=r[2];return e[0]=n*t[0]+o*t[3]+i*t[6],e[1]=n*t[1]+o*t[4]+i*t[7],e[2]=n*t[2]+o*t[5]+i*t[8],e}function B(e,r,t){var n=t[0],o=t[1],i=t[2],a=t[3],u=r[0],s=r[1],c=r[2],f=o*c-i*s,l=i*u-n*c,d=n*s-o*u,m=o*d-i*l,h=i*f-n*d,v=n*l-o*f,p=2*a;return f*=p,l*=p,d*=p,m*=2,h*=2,v*=2,e[0]=u+f+m,e[1]=s+l+h,e[2]=c+d+v,e}function I(e,r,t,n){var o=[],i=[];return o[0]=r[0]-t[0],o[1]=r[1]-t[1],o[2]=r[2]-t[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e}function O(e,r,t,n){var o=[],i=[];return o[0]=r[0]-t[0],o[1]=r[1]-t[1],o[2]=r[2]-t[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e}function z(e,r,t,n){var o=[],i=[];return o[0]=r[0]-t[0],o[1]=r[1]-t[1],o[2]=r[2]-t[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],e[0]=i[0]+t[0],e[1]=i[1]+t[1],e[2]=i[2]+t[2],e}function N(e,r){var t=u(e[0],e[1],e[2]),n=u(r[0],r[1],r[2]);y(t,t),y(n,n);var o=C(t,n);return o>1?0:o<-1?Math.PI:Math.acos(o)}function X(e){return e[0]=0,e[1]=0,e[2]=0,e}function k(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function V(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function j(e,r){var t=e[0],o=e[1],i=e[2],a=r[0],u=r[1],s=r[2];return Math.abs(t-a)<=n.b*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(o-u)<=n.b*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(i-s)<=n.b*Math.max(1,Math.abs(i),Math.abs(s))}var q,W=l,G=d,H=m,Y=E,Q=x,Z=a,K=_,$=(q=o(),function(e,r,t,n,o,i){var a,u;for(r||(r=3),t||(t=0),u=n?Math.min(n*r+t,e.length):e.length,a=t;a<u;a+=r)q[0]=e[a],q[1]=e[a+1],q[2]=e[a+2],o(q,q,i),e[a]=q[0],e[a+1]=q[1],e[a+2]=q[2];return e})},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=t(1),o=t(2);function i(e,r,t){const n=e.createShader(r);return n?(e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.log(t),console.warn(e.getShaderInfoLog(n)),e.deleteShader(n),null)):null}function a(e,r,t){const n=e.createBuffer();return e.bindBuffer(r,n),e.bufferData(r,t,e.STATIC_DRAW),n}r.loadTexture=async function(e,r){const t=await new Promise((e,t)=>{const n=new Image;n.src=r,n.onload=(()=>e(n)),n.onerror=t}),n=e.createTexture(),o=e=>0==(e&e-1);return e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),o(t.width)&&o(t.height)||(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)),n},r.createProgram=function(e,r,t){const n=i(e,e.VERTEX_SHADER,r),o=i(e,e.FRAGMENT_SHADER,t),a=e.createProgram();if(!a||!n||!o)throw new Error("Failed to create shader program");if(e.attachShader(a,n),e.attachShader(a,o),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw console.warn(e.getProgramInfoLog(a)),new Error("Can not creat program");const u={},s={},c=e.getProgramParameter(a,e.ACTIVE_ATTRIBUTES),f=e.getProgramParameter(a,e.ACTIVE_UNIFORMS);for(let r=0;r<c;r++){const t=e.getActiveAttrib(a,r).name;u[t]=e.getAttribLocation(a,t)}for(let r=0;r<f;r++){const t=e.getActiveUniform(a,r).name;s[t]=e.getUniformLocation(a,t)}return{program:a,uniforms:s,attributes:u,gl:e}},r.createMatrices=function(e){const r=n.create(),t=n.create(),i=n.create();n.perspective(r,Math.PI/4,e.aspect,.1,e.far||2e3);const a=o.clone(e.camera.position),u=o.clone(e.camera.center);return e.flip&&(u[2]=-u[2],a[2]=-a[2]),n.lookAt(t,a,u,[0,0,1]),{model:i,projection:r,view:t}},r.createBuffer=a,r.bindBuffer=function(e,r,t,n){e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(t,n,e.FLOAT,!1,0,0),e.enableVertexAttribArray(t)},r.bindArraysToBuffers=function(e,r){const{arrays:t,textures:n={},framebuffers:o={}}=r;return{buffers:{position:a(e,e.ARRAY_BUFFER,new Float32Array(t.position)),colors:a(e,e.ARRAY_BUFFER,new Float32Array(t.colors)),indices:a(e,e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.indices)),normal:a(e,e.ARRAY_BUFFER,new Float32Array(t.normals)),texture:a(e,e.ARRAY_BUFFER,new Float32Array(t.texture))},textures:n,framebuffers:o,size:t.indices.length}},r.createFramebufferAndTexture=function(e,r,t,n=!1){const o=e.createTexture(),i=e.createTexture(),a=e.createFramebuffer(),u=e.createRenderbuffer();return e.bindFramebuffer(e.FRAMEBUFFER,a),e.bindTexture(e.TEXTURE_2D,o),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,t,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,o,0),n?(e.getExtension("WEBGL_depth_texture")||console.warn("WEBGL_depth_texture is not supported"),e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,e.DEPTH_COMPONENT,r,t,0,e.DEPTH_COMPONENT,e.UNSIGNED_SHORT,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,i,0)):(e.bindRenderbuffer(e.RENDERBUFFER,u),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,r,t),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,u)),e.bindFramebuffer(e.FRAMEBUFFER,null),{colorTexture:o,depthTexture:i,framebuffer:a,depthRenderBuffer:u}},r.inRange=function(e,r,t){return e<r?r:e>t?t:e},r.toggleViaQS=((e,r)=>window.location.search.includes(e)?!r:r)},function(e,r,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=t(2),i=t(1),a=t(3),u=n(t(14)),s=n(t(15)),{cos:c,sin:f,tan:l,PI:d}=Math;function m(e){return function(r){const{gl:t,program:n,sun:o,size:u}=e,{state:s,aspect:c,flip:f=!1}=r,{projection:l,model:d,view:m}=a.createMatrices({camera:s.camera,aspect:c,flip:f,far:1.1*u}),[h,v,p]=s.camera.position;i.translate(d,d,[h,v,f?-p:p]),i.scale(d,d,[u,u,u]),t.useProgram(n.program),a.bindBuffer(t,o.buffers.position,n.attributes.position,3),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.buffers.indices),t.uniform3fv(n.uniforms.sunPosition,s.sky.sunPosition),t.uniform3fv(n.uniforms.cameraPosition,s.camera.position),t.uniformMatrix4fv(n.uniforms.projection,!1,l),t.uniformMatrix4fv(n.uniforms.view,!1,m),t.uniformMatrix4fv(n.uniforms.model,!1,d),t.drawElements(t.TRIANGLES,o.size,t.UNSIGNED_SHORT,0)}}function h(){const e=50,r=[],t=[];for(let n=0;n<=e;n++){const o=d/e*n-d/2;for(let i=0;i<e;i++){const a=2*d/e*i,u=c(a)*c(o),s=f(a)*c(o),l=f(o),m=n*e+i;r.push(u,s,l),n!==e&&(49===i?t.push(n*e,m+e,m,m+e,m+1,n*e):t.push(m,m+1,m+e,m+1,m+e,m+e+1))}}return{position:r,indices:t}}function v(e){return("00"+e).slice(-2)}r.createSky=function(e,r){const t=a.createProgram(e,u.default,s.default);return{render:m({gl:e,sun:a.bindArraysToBuffers(e,{arrays:h()}),program:t,size:r.size})}},r.sunTimeToString=function(e){const r=Math.ceil(e/60/1e3),t=r%60;return`${v(Math.floor(r/60))}:${v(t)}`},r.getSunPosition=function(e){const r=e%864e5,t=function(e){return l(-4.83049e-16*e*e+4.21414e-8*e-.420437)}(r),n=function(e){return 7.344052639206152e-8*e-.1829595519336553}(r),i=c(t)*c(n),u=c(t)*f(n),s=f(t),d=o.fromValues(i,-u,s),m=o.fromValues(1,1,1),h=o.create(),v=a.inRange(3*s,0,1);return o.negate(h,d),o.scale(m,m,v),{sunPosition:o.fromValues(i,-u,s),directionalLightColor:m,directionalLightVector:h}}},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=t(6),o=t(9),i=t(11),a=t(4),u=t(16);window.addEventListener("load",async function(){const e=document.querySelector("canvas");e.style.width=s+"px",e.style.height=s+"px",e.width=c,e.height=f;const r=e.getContext("experimental-webgl");if(!r)return void console.warn("Can not create webgl context");const t=await n.createTerrain(r,{heatmap:"heightmaps/terrain5.png",chunkSize:20/h,baseLevel:120,size:[l,l,200]}),v=await i.createWater(r,{size:d}),p=a.createSky(r,{size:m}),g=u.getInitialState(),{emitter:T}=o.initControls(e);T.on("toggleRenderWater",()=>u.toggle(g,"water","visible")).on("toggleRenderTerrain",()=>u.toggle(g,"terrain","visible")).on("toggleRefraction",()=>u.toggle(g,"water","useRefraction")).on("toggleReflection",()=>u.toggle(g,"water","useReflection")).on("toggleRenderSun",()=>u.toggle(g,"sky","visible")).on("toggleAutoSunMove",()=>u.toggle(g,"sky","autoSunMove")).on("toggleAutoPilot",()=>u.toggle(g,"app","autoPilot")).on("zoom",e=>u.zoom(g,e.dy)).on("moveCamera",e=>u.moveCamera(g,e)).on("rotateCamera",e=>u.rotateCamera(g,e.dx/500,e.dy)).on("moveSun",e=>u.moveSun(g,1e5*e.sunTime)),function e(){if(!g.app.active)return requestAnimationFrame(e);u.updateWaterTime(g);u.autoMoveSun(g,1e5);u.autoPilot(g);!function(e){const r=c/f,{gl:t,terrain:n,water:o,sky:i,state:a}=e,u={state:a,aspect:r};t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),a.water.visible&&(o.updateReflectionTexture(()=>{a.sky.visible&&i.render(Object.assign({},u,{flip:!0})),a.terrain.visible&&n.render(Object.assign({},u,{clipDirection:-1,flip:!0}))}),o.updateRefractionTexture(()=>{a.terrain.visible&&n.render(Object.assign({},u,{clipDirection:1}))}));t.viewport(0,0,c,f),a.water.visible&&o.render(u);a.terrain.visible&&n.render(u);a.sky.visible?i.render(u):t.clearColor(.53,.8,.98,1)}({gl:r,state:g,terrain:t,water:v,sky:p});requestAnimationFrame(e)}()});const s=Math.min(window.innerWidth,window.innerHeight,1024),c=512,f=512,l=1024,d=1024,m=1024,h=4},function(e,r,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=t(1),i=t(2),a=t(3),u=n(t(7)),s=n(t(8));function c(e){return function(r){const{gl:t,terrain:n,program:i,size:u}=e,{state:s,aspect:c,clipDirection:f=0,clipLevel:l=0,flip:d=!1}=r,{projection:m,model:h,view:v}=a.createMatrices({camera:s.camera,aspect:c,flip:d});o.scale(h,h,u),t.useProgram(i.program),a.bindBuffer(t,n.buffers.position,i.attributes.position,3),a.bindBuffer(t,n.buffers.normal,i.attributes.normal,3),a.bindBuffer(t,n.buffers.colors,i.attributes.colors,4),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.buffers.indices),t.uniformMatrix4fv(i.uniforms.projection,!1,m),t.uniformMatrix4fv(i.uniforms.model,!1,h),t.uniformMatrix4fv(i.uniforms.view,!1,v),t.uniform3fv(i.uniforms.directionalLightVector,s.light.direction),t.uniform3fv(i.uniforms.directionalLightColor,s.light.color),t.uniform1f(i.uniforms.clipDirection,f),t.uniform1f(i.uniforms.clipLevel,l),t.drawElements(t.TRIANGLES,n.size,t.UNSIGNED_SHORT,0)}}r.createTerrain=async function(e,r){const t=await async function(e,r,t=0){const n=document.createElement("canvas"),o=await function(e){return new Promise((r,t)=>{const n=new Image;n.src=e,n.onload=(()=>r(n)),n.onerror=t})}(e);n.width=o.width,n.height=o.height;const a=n.getContext("2d");if(!a)throw new Error("Can not create 2d context");a.drawImage(o,0,0);const{data:u}=a.getImageData(0,0,o.width,o.height),s=new Uint32Array(u),c=Math.floor(o.width/r),f=Math.floor(o.height/r),l=new Float32Array(c*f);let d=0;for(let e=0;e<f;e++)for(let t=0;t<c;t++){let n=0;for(let i=0;i<r;i++)for(let a=0;a<r;a++)n+=s[4*(e*r*o.width+t*r+i*r+a)];const i=n/r/r;l[e*c+t]=i,d<i&&(d=i)}const m=[],h=[],v=[],p=[],g=[];for(let e=0;e<f;e++)for(let r=0;r<c;r++){const n=e*c+r,o=l[n]/d;Number.isFinite(o)||console.log({i:e,j:r,c:o}),m.push(r/c-.5,e/f-.5,(l[n]-t)/d),v.push(o,o,o,1),e!==f-1&&r!==c-1&&h.push(n,n+c,n+1,n+1,n+c,n+c+1),g.push(r/c,e/f)}for(let e=0;e<m.length/3;e++){const r=c,t=f,n=e%r,o=~~(e/r),a=[n>0&&o>0&&[e-r,e-1,e],n+1<r&&o>0&&[e-r,e,e-r+1],n+1<r&&o>0&&[e-r+1,e,e+1],n>0&&o<t&&[e-1,e+r-1,e],n>0&&o<t&&[e,e+r-1,e+r],n+1<r&&o<t&&[e,e+r,e+1]],u=[],s=[];for(let e=0;e<a.length;e++){const r=a[e];for(let e=0;e<3;e++)r&&u.push(m[3*r[e]],m[3*r[e]+1],m[3*r[e]+2])}for(let e=0;e<u.length/9;e++){const r=i.fromValues(u[9*e+0],u[9*e+1],u[9*e+2]),t=i.fromValues(u[9*e+3],u[9*e+4],u[9*e+5]),n=i.fromValues(u[9*e+6],u[9*e+7],u[9*e+8]);i.subtract(t,t,r),i.subtract(n,n,r),i.cross(t,t,n),i.normalize(t,t),s.push(t)}const l=i.fromValues(0,0,0);for(let e=0;e<s.length;e++)i.add(l,l,s[e]);i.normalize(l,l),p.push(l[0],l[1],l[2])}return{position:m,indices:h,colors:v,normals:p,texture:g}}(r.heatmap,r.chunkSize,r.baseLevel),n=a.createProgram(e,u.default,s.default);return{render:c({terrain:a.bindArraysToBuffers(e,{arrays:t}),gl:e,program:n,size:r.size})}}},function(e,r){e.exports="precision lowp float;\r\n\r\nattribute vec4 position;\r\nattribute vec3 normal;\r\nattribute vec4 colors;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 directionalLightVector;\r\nuniform vec3 directionalLightColor;\r\nuniform float clipDirection;\r\nuniform float clipLevel;\r\n\r\nvarying vec3 vLighting;\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 fragmentColor;\r\nvarying float shouldClip;\r\n\r\nvoid main() {\r\n  vec3 ambientLight = vec3(0.1, 0.1, 0.1);\r\n  vec3 directionalVector = normalize(directionalLightVector);\r\n\r\n  float directional = max(dot(normal, directionalVector), 0.0);\r\n  vLighting = ambientLight + (directionalLightColor * directional);\r\n\r\n  gl_Position = projection * view * model * position;\r\n\r\n  fragmentColor = colors;\r\n  if (clipDirection == 1.0) {\r\n    shouldClip = position.z > clipLevel ? 1.0 : 0.0;\r\n  } else if (clipDirection == -1.0) {\r\n    shouldClip = position.z < clipLevel ? 1.0 : 0.0;\r\n  } else {\r\n    shouldClip = 0.0;\r\n  }\r\n}"},function(e,r){e.exports="precision lowp float;\r\n\r\nvarying vec3 vLighting;\r\nvarying float shouldClip;\r\nvarying vec4 fragmentColor;\r\n\r\nconst vec4 grassColor = vec4(0.12, 0.43, 0.02, 1.0);\r\nconst vec4 snowColor = vec4(1.0);\r\nconst vec4 groundColor = vec4(0.85, 0.84, 0.79, 1.0);\r\n\r\nvoid main() {\r\n  if (shouldClip == 1.0) {\r\n    discard;\r\n  }\r\n  float x = fragmentColor.x;\r\n  float groundGrassMixFactor = smoothstep(0.1, 0.2, x);\r\n  float grassSnowMixFactor = smoothstep(0.7, 0.8, x);\r\n  vec4 color = mix(groundColor, grassColor, groundGrassMixFactor);\r\n  color = mix(color, snowColor, grassSnowMixFactor);\r\n\r\n  gl_FragColor = vec4(color.rgb * vLighting, color.a);\r\n}\r\n"},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=t(10);r.initControls=function(e){let r=!1;const t=new Set,o=new n.EventEmitter,i=()=>{let e=0,r=0,n=0,a=0;t.has("w")&&r++,t.has("s")&&r--,t.has("a")&&e++,t.has("d")&&e--,t.has("e")&&n++,t.has("q")&&n--,t.has("j")&&a--,t.has("k")&&a++,a&&o.emit("moveSun",{sunTime:a}),(e||r||n)&&o.emit("moveCamera",{left:e,forward:r,up:n}),requestAnimationFrame(i)},a=e=>{switch(e.key){case"1":o.emit("toggleRenderTerrain");break;case"2":o.emit("toggleRenderWater");break;case"3":o.emit("toggleRefraction");break;case"4":o.emit("toggleReflection");break;case"5":o.emit("toggleRenderSun");break;case"6":o.emit("toggleAutoSunMove");break;case"7":o.emit("toggleAutoPilot");break;default:t.add(e.key)}},u=e=>{const{deltaY:r}=e;r&&(o.emit("zoom",{dy:r/Math.abs(r)*10}),e.preventDefault())},s=e=>{t.delete(e.key)},c=()=>{r=!0},f=()=>{r=!1},l=e=>{const{movementX:t,movementY:n}=e;r&&o.emit("rotateCamera",{dx:-t,dy:n})},d=e=>{e.preventDefault()};return i(),e.addEventListener("wheel",u),e.addEventListener("mousedown",c),e.addEventListener("contextmenu",d),window.addEventListener("mouseup",f),window.addEventListener("mousemove",l),window.addEventListener("keypress",a),window.addEventListener("keyup",s),{emitter:o,tearDown:()=>{o.removeAllListeners(),e.removeEventListener("wheel",u),e.removeEventListener("mousedown",c),e.removeEventListener("contextmenu",d),window.removeEventListener("mouseup",f),window.removeEventListener("mousemove",l),window.removeEventListener("keypress",a),window.removeEventListener("keyup",s)}}}},function(e,r){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function o(e){return"object"==typeof e&&null!==e}function i(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var r,t,a,u,s,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((r=arguments[1])instanceof Error)throw r;var f=new Error('Uncaught, unspecified "error" event. ('+r+")");throw f.context=r,f}if(i(t=this._events[e]))return!1;if(n(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:u=Array.prototype.slice.call(arguments,1),t.apply(this,u)}else if(o(t))for(u=Array.prototype.slice.call(arguments,1),a=(c=t.slice()).length,s=0;s<a;s++)c[s].apply(this,u);return!0},t.prototype.addListener=function(e,r){var a;if(!n(r))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(r.listener)?r.listener:r),this._events[e]?o(this._events[e])?this._events[e].push(r):this._events[e]=[this._events[e],r]:this._events[e]=r,o(this._events[e])&&!this._events[e].warned&&(a=i(this._maxListeners)?t.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[e].length>a&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,r){if(!n(r))throw TypeError("listener must be a function");var t=!1;function o(){this.removeListener(e,o),t||(t=!0,r.apply(this,arguments))}return o.listener=r,this.on(e,o),this},t.prototype.removeListener=function(e,r){var t,i,a,u;if(!n(r))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=(t=this._events[e]).length,i=-1,t===r||n(t.listener)&&t.listener===r)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,r);else if(o(t)){for(u=a;u-- >0;)if(t[u]===r||t[u].listener&&t[u].listener===r){i=u;break}if(i<0)return this;1===t.length?(t.length=0,delete this._events[e]):t.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,r)}return this},t.prototype.removeAllListeners=function(e){var r,t;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(r in this._events)"removeListener"!==r&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events={},this}if(n(t=this._events[e]))this.removeListener(e,t);else if(t)for(;t.length;)this.removeListener(e,t[t.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.prototype.listenerCount=function(e){if(this._events){var r=this._events[e];if(n(r))return 1;if(r)return r.length}return 0},t.listenerCount=function(e,r){return e.listenerCount(r)}},function(e,r,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=t(1),i=t(3),a=n(t(12)),u=n(t(13));function s(e){return function(r){const{gl:t,water:n,size:o}=e;t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffers.reflection),t.viewport(0,0,o,o),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),r(),t.bindFramebuffer(t.FRAMEBUFFER,null)}}function c(e){return function(r){const{gl:t,water:n,size:o}=e;t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffers.refraction),t.viewport(0,0,o,o),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),r(),t.bindFramebuffer(t.FRAMEBUFFER,null)}}function f(e){const{size:r,program:t,gl:n,water:a}=e;return n.useProgram(t.program),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.textures.dudv),n.uniform1i(t.uniforms.dudvTexture,0),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,a.textures.normalMap),n.uniform1i(t.uniforms.normalMapTexture,1),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,a.textures.refraction),n.uniform1i(t.uniforms.refractionTexture,2),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,a.textures.reflection),n.uniform1i(t.uniforms.reflectionTexture,3),n.activeTexture(n.TEXTURE4),n.bindTexture(n.TEXTURE_2D,a.textures.depth),n.uniform1i(t.uniforms.depthTexture,4),function(e){const{state:u,aspect:s}=e,{projection:c,model:f,view:l}=i.createMatrices({camera:u.camera,aspect:s});o.scale(f,f,[r,r,1]),n.useProgram(t.program),i.bindBuffer(n,a.buffers.position,t.attributes.position,3),i.bindBuffer(n,a.buffers.texture,t.attributes.textureCoord,2),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a.buffers.indices),n.uniform1f(t.uniforms.dudvOffset,u.water.time/1e3*.03%1),n.uniform1i(t.uniforms.useRefraction,Number(u.water.useRefraction)),n.uniform1i(t.uniforms.useReflection,Number(u.water.useReflection)),n.uniform3fv(t.uniforms.cameraPosition,u.camera.position),n.uniform3fv(t.uniforms.directionalLightVector,u.light.direction),n.uniform3fv(t.uniforms.directionalLightColor,u.light.color),n.uniformMatrix4fv(t.uniforms.projection,!1,c),n.uniformMatrix4fv(t.uniforms.model,!1,f),n.uniformMatrix4fv(t.uniforms.view,!1,l),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.drawElements(n.TRIANGLES,a.size,n.UNSIGNED_SHORT,0),n.disable(n.BLEND)}}r.createWater=async function(e,r){const{size:t}=r,n=await i.loadTexture(e,"textures/dudvmap.png"),o=await i.loadTexture(e,"textures/normalmap.png"),{colorTexture:l,depthTexture:d,framebuffer:m}=i.createFramebufferAndTexture(e,t,t,!0),{colorTexture:h,framebuffer:v}=i.createFramebufferAndTexture(e,t,t),p={position:[-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0],indices:[0,2,1,1,2,3],texture:[0,0,1,0,0,1,1,1]},g={gl:e,program:i.createProgram(e,a.default,u.default),size:t,water:i.bindArraysToBuffers(e,{arrays:p,framebuffers:{refraction:m,reflection:v},textures:{dudv:n,normalMap:o,refraction:l,reflection:h,depth:d}})};return{render:f(g),updateReflectionTexture:s(g),updateRefractionTexture:c(g)}}},function(e,r){e.exports="precision highp float;\r\n\r\nattribute vec4 position;\r\nattribute vec2 textureCoord;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 cameraPosition;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 clipSpace;\r\nvarying vec3 fromFragmentToCamera;\r\nvarying float reflectionYOffset;\r\n\r\nconst float tiling = 10.0;\r\n\r\nvoid main() {\r\n    vec4 worldPosition = model * position;\r\n    gl_Position = clipSpace = projection * view * worldPosition;\r\n\r\n    fromFragmentToCamera = cameraPosition - worldPosition.xyz;\r\n    vTextureCoord = textureCoord * tiling;\r\n}"},function(e,r){e.exports="// credits https://github.com/chinedufn/webgl-water-tutorial\r\nprecision highp float;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying vec4 clipSpace;\r\nvarying vec3 fromFragmentToCamera;\r\n\r\nuniform sampler2D dudvTexture;\r\nuniform sampler2D normalMapTexture;\r\nuniform sampler2D refractionTexture;\r\nuniform sampler2D reflectionTexture;\r\nuniform sampler2D depthTexture;\r\nuniform float dudvOffset;\r\nuniform int useRefraction;\r\nuniform int useReflection;\r\nuniform vec3 directionalLightVector;\r\nuniform vec3 directionalLightColor;\r\n\r\nconst float waterDistortionStrenth = 0.02;\r\nconst float fresnelStrength = 1.00;\r\nconst float waterReflectivity = 0.4;\r\nconst vec4 shallowWaterColor =  vec4(0.0, 0.1, 0.3, 1.0);\r\nconst vec4 deepWaterColor = vec4(0.0, 0.1, 0.2, 1.0);\r\nconst float shineDamper = 30.0;\r\n\r\nfloat getDepthAngle(\r\n  vec2 refractTexCoords\r\n) {\r\n    float near = 0.1;\r\n    float far = 50.0;\r\n    float nfp = far + near;\r\n    float nfm = far - near;\r\n\r\n    float cameraToFirstThingBehindWater = texture2D(depthTexture, refractTexCoords).r;\r\n    float cameraToFirstThingUnderWater = 2.0 * near * far / (nfp - (2.0 * cameraToFirstThingBehindWater - 1.0) * nfm);\r\n    float cameraToWaterDepth = gl_FragCoord.z;\r\n    float cameraToWaterDistance = 2.0 * near * far / (nfp - (2.0 * cameraToWaterDepth - 1.0) * nfm);\r\n    return cameraToFirstThingUnderWater - cameraToWaterDistance;\r\n}\r\n\r\nvoid main() {\r\n    // distortion\r\n    vec2 distortedTexCoords = texture2D(dudvTexture, vec2(vTextureCoord.x, vTextureCoord.y + dudvOffset)).xy * 0.1;\r\n    distortedTexCoords = vTextureCoord + vec2(distortedTexCoords.x + dudvOffset, distortedTexCoords.y);\r\n\r\n    vec2 totalDistortion = (texture2D(dudvTexture, distortedTexCoords).xy * 2.0 - 1.0) * waterDistortionStrenth;\r\n\r\n    // base refract/reflect texture coordinates\r\n    vec2 ndc = (clipSpace.xy / clipSpace.w) / 2.0 + 0.5;\r\n    vec2 refractTexCoords = vec2(ndc.x, +ndc.y);\r\n    vec2 reflectTexCoords = vec2(ndc.x, 1.0-ndc.y);\r\n    float angledWaterDepth = getDepthAngle(refractTexCoords);\r\n\r\n    // refractive factor\r\n    vec3 toCamera = normalize(fromFragmentToCamera);\r\n    vec4 normalMapColor = texture2D(normalMapTexture, distortedTexCoords);\r\n    vec3 normal = normalMapColor.xyz * 2.0 - 1.0;\r\n    normal = normalize(normal);\r\n    float refractiveFactor = dot(toCamera, normal);\r\n    // TODO do we need this?\r\n    refractiveFactor = pow(refractiveFactor, fresnelStrength);\r\n\r\n    // puting all together\r\n    refractTexCoords += totalDistortion;\r\n    reflectTexCoords += totalDistortion;\r\n    refractTexCoords = clamp(refractTexCoords, 0.001, 0.999);\r\n    reflectTexCoords = clamp(reflectTexCoords, 0.001, 0.999);\r\n\r\n    // lighs\r\n    vec3 reflectedLight = reflect(normalize(directionalLightVector), normal);\r\n    float specular = max(dot(reflectedLight, toCamera), 0.0);\r\n    specular = pow(specular, shineDamper);\r\n    vec3 specularHighlights = directionalLightColor * specular * waterReflectivity;\r\n\r\n    // color\r\n    vec4 refractColor = texture2D(refractionTexture, refractTexCoords);\r\n    vec4 reflectColor = texture2D(reflectionTexture, reflectTexCoords);\r\n    refractColor = mix(refractColor, deepWaterColor, clamp(angledWaterDepth / 10.0, 0.0, 1.0));\r\n\r\n    if (useReflection == 1 && useRefraction == 1) {\r\n      gl_FragColor = mix(reflectColor, refractColor, refractiveFactor);\r\n    } else if (useReflection == 1) {\r\n      gl_FragColor = reflectColor;\r\n    } else if (useRefraction == 1) {\r\n      gl_FragColor = refractColor;\r\n    }\r\n    gl_FragColor = mix(gl_FragColor, shallowWaterColor, 0.2);\r\n\r\n    gl_FragColor = gl_FragColor + vec4(specularHighlights, 1.0);\r\n}\r\n"},function(e,r){e.exports="precision lowp float;\r\n\r\nattribute vec4 position;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\n\r\nvarying vec4 worldPosition;\r\n\r\nvoid main() {\r\n    worldPosition = position;\r\n    gl_Position = projection * view * model * worldPosition;\r\n}"},function(e,r){e.exports="// credits https://www.shadertoy.com/view/MsVSWt\r\nprecision highp float;\r\n\r\nuniform vec3 sunPosition;\r\nvarying vec4 worldPosition;\r\n\r\nvec3 getSunColor(\r\n    vec3 position,\r\n    vec3 sun\r\n) {\r\n    float dis = 1.0 - distance(sun, position);\r\n    dis = clamp(dis, 0.01, 1.0);\r\n    float z = clamp(sun.z, 0.0, 1.0);\r\n    float z2 = pow(z, 1.5);\r\n    \r\n    float glow = dis;\r\n    \r\n    dis = pow(dis, 100.0);\r\n    dis *= 10.0;\r\n    dis = clamp(dis, 0.0, 1.0);\r\n    \r\n    glow = pow(glow, z * 12.0);\r\n    glow = clamp(glow, 0.0, 1.0);\r\n    \r\n    dis *= pow(z2, 1.0 / 1.65);\r\n    glow *= pow(z2, 1.0 / 2.0);\r\n    \r\n    dis += glow;\r\n    \r\n    return vec3(1.0,0.6,0.05) * dis;\r\n    \r\n}\r\n\r\nvec3 getFastScattering(vec3 position, vec3 sun) {\r\n    float atmosphere = sqrt(1.0 - position.z);\r\n    vec3 skyColor = vec3(0.2, 0.4, 0.8);\r\n    float scatter = pow(sun.z, 1.0 / 15.0);\r\n    scatter = 1.0 - clamp(scatter, 0.8, 1.0);\r\n    vec3 scatterColor = mix(\r\n        vec3(1.0),\r\n        vec3(1.0, 0.3, 0.0) * 1.5,\r\n        scatter * 2.0\r\n    );\r\n    skyColor = mix(\r\n        skyColor,\r\n        scatterColor,\r\n        atmosphere / 1.3\r\n    );\r\n    skyColor = mix(skyColor, vec3(0.0), clamp(-sun.z * 3.0, 0.0, 1.0));\r\n    return skyColor;\r\n}\r\n\r\nvoid main() {\r\n    vec3 world = normalize(worldPosition.xyz);\r\n    vec3 sun = normalize(sunPosition);\r\n    vec3 color = vec3(0.0);\r\n    color += getSunColor(world, sun);\r\n    color += getFastScattering(world, sun);\r\n\r\n    gl_FragColor = vec4(color, 1.0);\r\n}"},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const n=t(2),o=t(3),i=t(4),a={app:{active:!0,autoPilot:o.toggleViaQS("ap",!1)},camera:{center:n.fromValues(270,330,87),position:n.fromValues(330,414,84)},terrain:{visible:!0},water:{start:Date.now(),time:0,visible:!0,useReflection:o.toggleViaQS("rfl",!0),useRefraction:o.toggleViaQS("rfr",!0)},light:{direction:n.fromValues(0,0,0),color:n.fromValues(0,0,0)},sky:{dayTime:324e5,visible:!0,sunPosition:n.fromValues(0,0,0),autoSunMove:o.toggleViaQS("asm",!1)}};r.getInitialState=(()=>(u(a,a.sky.dayTime),a)),r.toggle=((e,r,t)=>{e[r][t]=!e[r][t]}),r.zoom=((e,r)=>{const{position:t,center:i}=e.camera,a=n.create(),u=n.distance(i,t),s=o.inRange(u+r,50,1e3);n.sub(a,t,i),n.scale(a,a,s/u),n.add(t,i,a)}),r.moveCamera=((e,r)=>{const{position:t,center:o}=e.camera,i=n.create(),a=n.create(),u=n.create();n.sub(i,o,t),n.rotateZ(a,i,[0,0,1],Math.PI/2),a[2]=0,r.forward>0&&n.add(u,u,i),r.forward<0&&n.sub(u,u,i),r.left>0&&n.add(u,u,a),r.left<0&&n.sub(u,u,a),n.normalize(u,u),n.add(u,u,[0,0,r.up]),n.scale(u,u,6),n.add(t,t,u),n.add(o,o,u)}),r.rotateCamera=((e,r,t)=>{const{position:o,center:i}=e.camera,a=n.create();n.sub(a,i,o);const u=n.length(a);n.rotateZ(a,a,[0,0,0],r),a[2]-=t,n.normalize(a,a),n.scale(a,a,u),n.add(i,o,a)}),r.moveSun=((e,r)=>{let t=e.sky.dayTime+r;t<0?t+=864e5:t>864e5&&(t-=864e5),u(e,t)}),r.autoMoveSun=((e,t)=>{e.sky.autoSunMove&&r.moveSun(e,t)}),r.updateWaterTime=(e=>{e.water.time=Date.now()-e.water.start}),r.autoPilot=(e=>{e.app.autoPilot&&r.rotateCamera(e,.003,0)});const u=(e,r)=>{const{sunPosition:t,directionalLightColor:n,directionalLightVector:o}=i.getSunPosition(r);e.sky.dayTime=r,e.sky.sunPosition=t,e.light.color=n,e.light.direction=o}}]);
//# sourceMappingURL=index.js.map