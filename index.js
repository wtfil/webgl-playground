!function(r){var e={};function t(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return r[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=r,t.c=e,t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},t.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,e){if(1&e&&(r=t(r)),8&e)return r;if(4&e&&"object"==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:r}),2&e&&"string"!=typeof r)for(var o in r)t.d(n,o,function(e){return r[e]}.bind(null,o));return n},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,"a",e),e},t.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},t.p="",t(t.s=4)}([function(r,e,t){"use strict";t.d(e,"b",function(){return n}),t.d(e,"a",function(){return o}),t.d(e,"c",function(){return i});var n=1e-6,o="undefined"!=typeof Float32Array?Float32Array:Array,i=Math.random;Math.PI},function(r,e,t){"use strict";t.r(e),t.d(e,"create",function(){return o}),t.d(e,"clone",function(){return i}),t.d(e,"length",function(){return a}),t.d(e,"fromValues",function(){return s}),t.d(e,"copy",function(){return u}),t.d(e,"set",function(){return c}),t.d(e,"add",function(){return l}),t.d(e,"subtract",function(){return f}),t.d(e,"multiply",function(){return d}),t.d(e,"divide",function(){return h}),t.d(e,"ceil",function(){return m}),t.d(e,"floor",function(){return p}),t.d(e,"min",function(){return v}),t.d(e,"max",function(){return g}),t.d(e,"round",function(){return w}),t.d(e,"scale",function(){return M}),t.d(e,"scaleAndAdd",function(){return b}),t.d(e,"distance",function(){return T}),t.d(e,"squaredDistance",function(){return x}),t.d(e,"squaredLength",function(){return E}),t.d(e,"negate",function(){return _}),t.d(e,"inverse",function(){return R}),t.d(e,"normalize",function(){return y}),t.d(e,"dot",function(){return A}),t.d(e,"cross",function(){return P}),t.d(e,"lerp",function(){return C}),t.d(e,"hermite",function(){return F}),t.d(e,"bezier",function(){return L}),t.d(e,"random",function(){return S}),t.d(e,"transformMat4",function(){return D}),t.d(e,"transformMat3",function(){return U}),t.d(e,"transformQuat",function(){return O}),t.d(e,"rotateX",function(){return B}),t.d(e,"rotateY",function(){return I}),t.d(e,"rotateZ",function(){return N}),t.d(e,"angle",function(){return z}),t.d(e,"zero",function(){return j}),t.d(e,"str",function(){return V}),t.d(e,"exactEquals",function(){return q}),t.d(e,"equals",function(){return X}),t.d(e,"sub",function(){return k}),t.d(e,"mul",function(){return H}),t.d(e,"div",function(){return W}),t.d(e,"dist",function(){return Y}),t.d(e,"sqrDist",function(){return Z}),t.d(e,"len",function(){return Q}),t.d(e,"sqrLen",function(){return $}),t.d(e,"forEach",function(){return J});var n=t(0);function o(){var r=new n.a(3);return n.a!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function i(r){var e=new n.a(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function a(r){var e=r[0],t=r[1],n=r[2];return Math.sqrt(e*e+t*t+n*n)}function s(r,e,t){var o=new n.a(3);return o[0]=r,o[1]=e,o[2]=t,o}function u(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function c(r,e,t,n){return r[0]=e,r[1]=t,r[2]=n,r}function l(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function f(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function d(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}function h(r,e,t){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r}function m(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r}function p(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r}function v(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function g(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function w(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r}function M(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function b(r,e,t,n){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r}function T(r,e){var t=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];return Math.sqrt(t*t+n*n+o*o)}function x(r,e){var t=e[0]-r[0],n=e[1]-r[1],o=e[2]-r[2];return t*t+n*n+o*o}function E(r){var e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n}function _(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function R(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r}function y(r,e){var t=e[0],n=e[1],o=e[2],i=t*t+n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function A(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function P(r,e,t){var n=e[0],o=e[1],i=e[2],a=t[0],s=t[1],u=t[2];return r[0]=o*u-i*s,r[1]=i*a-n*u,r[2]=n*s-o*a,r}function C(r,e,t,n){var o=e[0],i=e[1],a=e[2];return r[0]=o+n*(t[0]-o),r[1]=i+n*(t[1]-i),r[2]=a+n*(t[2]-a),r}function F(r,e,t,n,o,i){var a=i*i,s=a*(2*i-3)+1,u=a*(i-2)+i,c=a*(i-1),l=a*(3-2*i);return r[0]=e[0]*s+t[0]*u+n[0]*c+o[0]*l,r[1]=e[1]*s+t[1]*u+n[1]*c+o[1]*l,r[2]=e[2]*s+t[2]*u+n[2]*c+o[2]*l,r}function L(r,e,t,n,o,i){var a=1-i,s=a*a,u=i*i,c=s*a,l=3*i*s,f=3*u*a,d=u*i;return r[0]=e[0]*c+t[0]*l+n[0]*f+o[0]*d,r[1]=e[1]*c+t[1]*l+n[1]*f+o[1]*d,r[2]=e[2]*c+t[2]*l+n[2]*f+o[2]*d,r}function S(r,e){e=e||1;var t=2*n.c()*Math.PI,o=2*n.c()-1,i=Math.sqrt(1-o*o)*e;return r[0]=Math.cos(t)*i,r[1]=Math.sin(t)*i,r[2]=o*e,r}function D(r,e,t){var n=e[0],o=e[1],i=e[2],a=t[3]*n+t[7]*o+t[11]*i+t[15];return a=a||1,r[0]=(t[0]*n+t[4]*o+t[8]*i+t[12])/a,r[1]=(t[1]*n+t[5]*o+t[9]*i+t[13])/a,r[2]=(t[2]*n+t[6]*o+t[10]*i+t[14])/a,r}function U(r,e,t){var n=e[0],o=e[1],i=e[2];return r[0]=n*t[0]+o*t[3]+i*t[6],r[1]=n*t[1]+o*t[4]+i*t[7],r[2]=n*t[2]+o*t[5]+i*t[8],r}function O(r,e,t){var n=t[0],o=t[1],i=t[2],a=t[3],s=e[0],u=e[1],c=e[2],l=o*c-i*u,f=i*s-n*c,d=n*u-o*s,h=o*d-i*f,m=i*l-n*d,p=n*f-o*l,v=2*a;return l*=v,f*=v,d*=v,h*=2,m*=2,p*=2,r[0]=s+l+h,r[1]=u+f+m,r[2]=c+d+p,r}function B(r,e,t,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0],i[1]=o[1]*Math.cos(n)-o[2]*Math.sin(n),i[2]=o[1]*Math.sin(n)+o[2]*Math.cos(n),r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=i[2]+t[2],r}function I(r,e,t,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[2]*Math.sin(n)+o[0]*Math.cos(n),i[1]=o[1],i[2]=o[2]*Math.cos(n)-o[0]*Math.sin(n),r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=i[2]+t[2],r}function N(r,e,t,n){var o=[],i=[];return o[0]=e[0]-t[0],o[1]=e[1]-t[1],o[2]=e[2]-t[2],i[0]=o[0]*Math.cos(n)-o[1]*Math.sin(n),i[1]=o[0]*Math.sin(n)+o[1]*Math.cos(n),i[2]=o[2],r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=i[2]+t[2],r}function z(r,e){var t=s(r[0],r[1],r[2]),n=s(e[0],e[1],e[2]);y(t,t),y(n,n);var o=A(t,n);return o>1?0:o<-1?Math.PI:Math.acos(o)}function j(r){return r[0]=0,r[1]=0,r[2]=0,r}function V(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function q(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}function X(r,e){var t=r[0],o=r[1],i=r[2],a=e[0],s=e[1],u=e[2];return Math.abs(t-a)<=n.b*Math.max(1,Math.abs(t),Math.abs(a))&&Math.abs(o-s)<=n.b*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(i-u)<=n.b*Math.max(1,Math.abs(i),Math.abs(u))}var G,k=f,H=d,W=h,Y=T,Z=x,Q=a,$=E,J=(G=o(),function(r,e,t,n,o,i){var a,s;for(e||(e=3),t||(t=0),s=n?Math.min(n*e+t,r.length):r.length,a=t;a<s;a+=e)G[0]=r[a],G[1]=r[a+1],G[2]=r[a+2],o(G,G,i),r[a]=G[0],r[a+1]=G[1],r[a+2]=G[2];return r})},function(r,e,t){"use strict";t.r(e),t.d(e,"create",function(){return o}),t.d(e,"clone",function(){return i}),t.d(e,"copy",function(){return a}),t.d(e,"fromValues",function(){return s}),t.d(e,"set",function(){return u}),t.d(e,"identity",function(){return c}),t.d(e,"transpose",function(){return l}),t.d(e,"invert",function(){return f}),t.d(e,"adjoint",function(){return d}),t.d(e,"determinant",function(){return h}),t.d(e,"multiply",function(){return m}),t.d(e,"translate",function(){return p}),t.d(e,"scale",function(){return v}),t.d(e,"rotate",function(){return g}),t.d(e,"rotateX",function(){return w}),t.d(e,"rotateY",function(){return M}),t.d(e,"rotateZ",function(){return b}),t.d(e,"fromTranslation",function(){return T}),t.d(e,"fromScaling",function(){return x}),t.d(e,"fromRotation",function(){return E}),t.d(e,"fromXRotation",function(){return _}),t.d(e,"fromYRotation",function(){return R}),t.d(e,"fromZRotation",function(){return y}),t.d(e,"fromRotationTranslation",function(){return A}),t.d(e,"fromQuat2",function(){return P}),t.d(e,"getTranslation",function(){return C}),t.d(e,"getScaling",function(){return F}),t.d(e,"getRotation",function(){return L}),t.d(e,"fromRotationTranslationScale",function(){return S}),t.d(e,"fromRotationTranslationScaleOrigin",function(){return D}),t.d(e,"fromQuat",function(){return U}),t.d(e,"frustum",function(){return O}),t.d(e,"perspective",function(){return B}),t.d(e,"perspectiveFromFieldOfView",function(){return I}),t.d(e,"ortho",function(){return N}),t.d(e,"lookAt",function(){return z}),t.d(e,"targetTo",function(){return j}),t.d(e,"str",function(){return V}),t.d(e,"frob",function(){return q}),t.d(e,"add",function(){return X}),t.d(e,"subtract",function(){return G}),t.d(e,"multiplyScalar",function(){return k}),t.d(e,"multiplyScalarAndAdd",function(){return H}),t.d(e,"exactEquals",function(){return W}),t.d(e,"equals",function(){return Y}),t.d(e,"mul",function(){return Z}),t.d(e,"sub",function(){return Q});var n=t(0);function o(){var r=new n.a(16);return n.a!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function i(r){var e=new n.a(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function a(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function s(r,e,t,o,i,a,s,u,c,l,f,d,h,m,p,v){var g=new n.a(16);return g[0]=r,g[1]=e,g[2]=t,g[3]=o,g[4]=i,g[5]=a,g[6]=s,g[7]=u,g[8]=c,g[9]=l,g[10]=f,g[11]=d,g[12]=h,g[13]=m,g[14]=p,g[15]=v,g}function u(r,e,t,n,o,i,a,s,u,c,l,f,d,h,m,p,v){return r[0]=e,r[1]=t,r[2]=n,r[3]=o,r[4]=i,r[5]=a,r[6]=s,r[7]=u,r[8]=c,r[9]=l,r[10]=f,r[11]=d,r[12]=h,r[13]=m,r[14]=p,r[15]=v,r}function c(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function l(r,e){if(r===e){var t=e[1],n=e[2],o=e[3],i=e[6],a=e[7],s=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=t,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=i,r[11]=e[14],r[12]=o,r[13]=a,r[14]=s}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function f(r,e){var t=e[0],n=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],d=e[10],h=e[11],m=e[12],p=e[13],v=e[14],g=e[15],w=t*s-n*a,M=t*u-o*a,b=t*c-i*a,T=n*u-o*s,x=n*c-i*s,E=o*c-i*u,_=l*p-f*m,R=l*v-d*m,y=l*g-h*m,A=f*v-d*p,P=f*g-h*p,C=d*g-h*v,F=w*C-M*P+b*A+T*y-x*R+E*_;return F?(F=1/F,r[0]=(s*C-u*P+c*A)*F,r[1]=(o*P-n*C-i*A)*F,r[2]=(p*E-v*x+g*T)*F,r[3]=(d*x-f*E-h*T)*F,r[4]=(u*y-a*C-c*R)*F,r[5]=(t*C-o*y+i*R)*F,r[6]=(v*b-m*E-g*M)*F,r[7]=(l*E-d*b+h*M)*F,r[8]=(a*P-s*y+c*_)*F,r[9]=(n*y-t*P-i*_)*F,r[10]=(m*x-p*b+g*w)*F,r[11]=(f*b-l*x-h*w)*F,r[12]=(s*R-a*A-u*_)*F,r[13]=(t*A-n*R+o*_)*F,r[14]=(p*M-m*T-v*w)*F,r[15]=(l*T-f*M+d*w)*F,r):null}function d(r,e){var t=e[0],n=e[1],o=e[2],i=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],f=e[9],d=e[10],h=e[11],m=e[12],p=e[13],v=e[14],g=e[15];return r[0]=s*(d*g-h*v)-f*(u*g-c*v)+p*(u*h-c*d),r[1]=-(n*(d*g-h*v)-f*(o*g-i*v)+p*(o*h-i*d)),r[2]=n*(u*g-c*v)-s*(o*g-i*v)+p*(o*c-i*u),r[3]=-(n*(u*h-c*d)-s*(o*h-i*d)+f*(o*c-i*u)),r[4]=-(a*(d*g-h*v)-l*(u*g-c*v)+m*(u*h-c*d)),r[5]=t*(d*g-h*v)-l*(o*g-i*v)+m*(o*h-i*d),r[6]=-(t*(u*g-c*v)-a*(o*g-i*v)+m*(o*c-i*u)),r[7]=t*(u*h-c*d)-a*(o*h-i*d)+l*(o*c-i*u),r[8]=a*(f*g-h*p)-l*(s*g-c*p)+m*(s*h-c*f),r[9]=-(t*(f*g-h*p)-l*(n*g-i*p)+m*(n*h-i*f)),r[10]=t*(s*g-c*p)-a*(n*g-i*p)+m*(n*c-i*s),r[11]=-(t*(s*h-c*f)-a*(n*h-i*f)+l*(n*c-i*s)),r[12]=-(a*(f*v-d*p)-l*(s*v-u*p)+m*(s*d-u*f)),r[13]=t*(f*v-d*p)-l*(n*v-o*p)+m*(n*d-o*f),r[14]=-(t*(s*v-u*p)-a*(n*v-o*p)+m*(n*u-o*s)),r[15]=t*(s*d-u*f)-a*(n*d-o*f)+l*(n*u-o*s),r}function h(r){var e=r[0],t=r[1],n=r[2],o=r[3],i=r[4],a=r[5],s=r[6],u=r[7],c=r[8],l=r[9],f=r[10],d=r[11],h=r[12],m=r[13],p=r[14],v=r[15];return(e*a-t*i)*(f*v-d*p)-(e*s-n*i)*(l*v-d*m)+(e*u-o*i)*(l*p-f*m)+(t*s-n*a)*(c*v-d*h)-(t*u-o*a)*(c*p-f*h)+(n*u-o*s)*(c*m-l*h)}function m(r,e,t){var n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=e[9],h=e[10],m=e[11],p=e[12],v=e[13],g=e[14],w=e[15],M=t[0],b=t[1],T=t[2],x=t[3];return r[0]=M*n+b*s+T*f+x*p,r[1]=M*o+b*u+T*d+x*v,r[2]=M*i+b*c+T*h+x*g,r[3]=M*a+b*l+T*m+x*w,M=t[4],b=t[5],T=t[6],x=t[7],r[4]=M*n+b*s+T*f+x*p,r[5]=M*o+b*u+T*d+x*v,r[6]=M*i+b*c+T*h+x*g,r[7]=M*a+b*l+T*m+x*w,M=t[8],b=t[9],T=t[10],x=t[11],r[8]=M*n+b*s+T*f+x*p,r[9]=M*o+b*u+T*d+x*v,r[10]=M*i+b*c+T*h+x*g,r[11]=M*a+b*l+T*m+x*w,M=t[12],b=t[13],T=t[14],x=t[15],r[12]=M*n+b*s+T*f+x*p,r[13]=M*o+b*u+T*d+x*v,r[14]=M*i+b*c+T*h+x*g,r[15]=M*a+b*l+T*m+x*w,r}function p(r,e,t){var n,o,i,a,s,u,c,l,f,d,h,m,p=t[0],v=t[1],g=t[2];return e===r?(r[12]=e[0]*p+e[4]*v+e[8]*g+e[12],r[13]=e[1]*p+e[5]*v+e[9]*g+e[13],r[14]=e[2]*p+e[6]*v+e[10]*g+e[14],r[15]=e[3]*p+e[7]*v+e[11]*g+e[15]):(n=e[0],o=e[1],i=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],f=e[8],d=e[9],h=e[10],m=e[11],r[0]=n,r[1]=o,r[2]=i,r[3]=a,r[4]=s,r[5]=u,r[6]=c,r[7]=l,r[8]=f,r[9]=d,r[10]=h,r[11]=m,r[12]=n*p+s*v+f*g+e[12],r[13]=o*p+u*v+d*g+e[13],r[14]=i*p+c*v+h*g+e[14],r[15]=a*p+l*v+m*g+e[15]),r}function v(r,e,t){var n=t[0],o=t[1],i=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*o,r[5]=e[5]*o,r[6]=e[6]*o,r[7]=e[7]*o,r[8]=e[8]*i,r[9]=e[9]*i,r[10]=e[10]*i,r[11]=e[11]*i,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function g(r,e,t,o){var i,a,s,u,c,l,f,d,h,m,p,v,g,w,M,b,T,x,E,_,R,y,A,P,C=o[0],F=o[1],L=o[2],S=Math.sqrt(C*C+F*F+L*L);return S<n.b?null:(C*=S=1/S,F*=S,L*=S,i=Math.sin(t),s=1-(a=Math.cos(t)),u=e[0],c=e[1],l=e[2],f=e[3],d=e[4],h=e[5],m=e[6],p=e[7],v=e[8],g=e[9],w=e[10],M=e[11],b=C*C*s+a,T=F*C*s+L*i,x=L*C*s-F*i,E=C*F*s-L*i,_=F*F*s+a,R=L*F*s+C*i,y=C*L*s+F*i,A=F*L*s-C*i,P=L*L*s+a,r[0]=u*b+d*T+v*x,r[1]=c*b+h*T+g*x,r[2]=l*b+m*T+w*x,r[3]=f*b+p*T+M*x,r[4]=u*E+d*_+v*R,r[5]=c*E+h*_+g*R,r[6]=l*E+m*_+w*R,r[7]=f*E+p*_+M*R,r[8]=u*y+d*A+v*P,r[9]=c*y+h*A+g*P,r[10]=l*y+m*A+w*P,r[11]=f*y+p*A+M*P,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function w(r,e,t){var n=Math.sin(t),o=Math.cos(t),i=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],f=e[10],d=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=i*o+c*n,r[5]=a*o+l*n,r[6]=s*o+f*n,r[7]=u*o+d*n,r[8]=c*o-i*n,r[9]=l*o-a*n,r[10]=f*o-s*n,r[11]=d*o-u*n,r}function M(r,e,t){var n=Math.sin(t),o=Math.cos(t),i=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],f=e[10],d=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=i*o-c*n,r[1]=a*o-l*n,r[2]=s*o-f*n,r[3]=u*o-d*n,r[8]=i*n+c*o,r[9]=a*n+l*o,r[10]=s*n+f*o,r[11]=u*n+d*o,r}function b(r,e,t){var n=Math.sin(t),o=Math.cos(t),i=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],f=e[6],d=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=i*o+c*n,r[1]=a*o+l*n,r[2]=s*o+f*n,r[3]=u*o+d*n,r[4]=c*o-i*n,r[5]=l*o-a*n,r[6]=f*o-s*n,r[7]=d*o-u*n,r}function T(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function x(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function E(r,e,t){var o,i,a,s=t[0],u=t[1],c=t[2],l=Math.sqrt(s*s+u*u+c*c);return l<n.b?null:(s*=l=1/l,u*=l,c*=l,o=Math.sin(e),a=1-(i=Math.cos(e)),r[0]=s*s*a+i,r[1]=u*s*a+c*o,r[2]=c*s*a-u*o,r[3]=0,r[4]=s*u*a-c*o,r[5]=u*u*a+i,r[6]=c*u*a+s*o,r[7]=0,r[8]=s*c*a+u*o,r[9]=u*c*a-s*o,r[10]=c*c*a+i,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function _(r,e){var t=Math.sin(e),n=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=t,r[7]=0,r[8]=0,r[9]=-t,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function R(r,e){var t=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=0,r[2]=-t,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=t,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function y(r,e){var t=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=t,r[2]=0,r[3]=0,r[4]=-t,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function A(r,e,t){var n=e[0],o=e[1],i=e[2],a=e[3],s=n+n,u=o+o,c=i+i,l=n*s,f=n*u,d=n*c,h=o*u,m=o*c,p=i*c,v=a*s,g=a*u,w=a*c;return r[0]=1-(h+p),r[1]=f+w,r[2]=d-g,r[3]=0,r[4]=f-w,r[5]=1-(l+p),r[6]=m+v,r[7]=0,r[8]=d+g,r[9]=m-v,r[10]=1-(l+h),r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function P(r,e){var t=new n.a(3),o=-e[0],i=-e[1],a=-e[2],s=e[3],u=e[4],c=e[5],l=e[6],f=e[7],d=o*o+i*i+a*a+s*s;return d>0?(t[0]=2*(u*s+f*o+c*a-l*i)/d,t[1]=2*(c*s+f*i+l*o-u*a)/d,t[2]=2*(l*s+f*a+u*i-c*o)/d):(t[0]=2*(u*s+f*o+c*a-l*i),t[1]=2*(c*s+f*i+l*o-u*a),t[2]=2*(l*s+f*a+u*i-c*o)),A(r,e,t),r}function C(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function F(r,e){var t=e[0],n=e[1],o=e[2],i=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10];return r[0]=Math.sqrt(t*t+n*n+o*o),r[1]=Math.sqrt(i*i+a*a+s*s),r[2]=Math.sqrt(u*u+c*c+l*l),r}function L(r,e){var t=e[0]+e[5]+e[10],n=0;return t>0?(n=2*Math.sqrt(t+1),r[3]=.25*n,r[0]=(e[6]-e[9])/n,r[1]=(e[8]-e[2])/n,r[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),r[3]=(e[6]-e[9])/n,r[0]=.25*n,r[1]=(e[1]+e[4])/n,r[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),r[3]=(e[8]-e[2])/n,r[0]=(e[1]+e[4])/n,r[1]=.25*n,r[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),r[3]=(e[1]-e[4])/n,r[0]=(e[8]+e[2])/n,r[1]=(e[6]+e[9])/n,r[2]=.25*n),r}function S(r,e,t,n){var o=e[0],i=e[1],a=e[2],s=e[3],u=o+o,c=i+i,l=a+a,f=o*u,d=o*c,h=o*l,m=i*c,p=i*l,v=a*l,g=s*u,w=s*c,M=s*l,b=n[0],T=n[1],x=n[2];return r[0]=(1-(m+v))*b,r[1]=(d+M)*b,r[2]=(h-w)*b,r[3]=0,r[4]=(d-M)*T,r[5]=(1-(f+v))*T,r[6]=(p+g)*T,r[7]=0,r[8]=(h+w)*x,r[9]=(p-g)*x,r[10]=(1-(f+m))*x,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function D(r,e,t,n,o){var i=e[0],a=e[1],s=e[2],u=e[3],c=i+i,l=a+a,f=s+s,d=i*c,h=i*l,m=i*f,p=a*l,v=a*f,g=s*f,w=u*c,M=u*l,b=u*f,T=n[0],x=n[1],E=n[2],_=o[0],R=o[1],y=o[2],A=(1-(p+g))*T,P=(h+b)*T,C=(m-M)*T,F=(h-b)*x,L=(1-(d+g))*x,S=(v+w)*x,D=(m+M)*E,U=(v-w)*E,O=(1-(d+p))*E;return r[0]=A,r[1]=P,r[2]=C,r[3]=0,r[4]=F,r[5]=L,r[6]=S,r[7]=0,r[8]=D,r[9]=U,r[10]=O,r[11]=0,r[12]=t[0]+_-(A*_+F*R+D*y),r[13]=t[1]+R-(P*_+L*R+U*y),r[14]=t[2]+y-(C*_+S*R+O*y),r[15]=1,r}function U(r,e){var t=e[0],n=e[1],o=e[2],i=e[3],a=t+t,s=n+n,u=o+o,c=t*a,l=n*a,f=n*s,d=o*a,h=o*s,m=o*u,p=i*a,v=i*s,g=i*u;return r[0]=1-f-m,r[1]=l+g,r[2]=d-v,r[3]=0,r[4]=l-g,r[5]=1-c-m,r[6]=h+p,r[7]=0,r[8]=d+v,r[9]=h-p,r[10]=1-c-f,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function O(r,e,t,n,o,i,a){var s=1/(t-e),u=1/(o-n),c=1/(i-a);return r[0]=2*i*s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*i*u,r[6]=0,r[7]=0,r[8]=(t+e)*s,r[9]=(o+n)*u,r[10]=(a+i)*c,r[11]=-1,r[12]=0,r[13]=0,r[14]=a*i*2*c,r[15]=0,r}function B(r,e,t,n,o){var i,a=1/Math.tan(e/2);return r[0]=a/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=o&&o!==1/0?(i=1/(n-o),r[10]=(o+n)*i,r[14]=2*o*n*i):(r[10]=-1,r[14]=-2*n),r}function I(r,e,t,n){var o=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(o+i);return r[0]=u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=c,r[6]=0,r[7]=0,r[8]=-(a-s)*u*.5,r[9]=(o-i)*c*.5,r[10]=n/(t-n),r[11]=-1,r[12]=0,r[13]=0,r[14]=n*t/(t-n),r[15]=0,r}function N(r,e,t,n,o,i,a){var s=1/(e-t),u=1/(n-o),c=1/(i-a);return r[0]=-2*s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*c,r[11]=0,r[12]=(e+t)*s,r[13]=(o+n)*u,r[14]=(a+i)*c,r[15]=1,r}function z(r,e,t,o){var i,a,s,u,l,f,d,h,m,p,v=e[0],g=e[1],w=e[2],M=o[0],b=o[1],T=o[2],x=t[0],E=t[1],_=t[2];return Math.abs(v-x)<n.b&&Math.abs(g-E)<n.b&&Math.abs(w-_)<n.b?c(r):(d=v-x,h=g-E,m=w-_,i=b*(m*=p=1/Math.sqrt(d*d+h*h+m*m))-T*(h*=p),a=T*(d*=p)-M*m,s=M*h-b*d,(p=Math.sqrt(i*i+a*a+s*s))?(i*=p=1/p,a*=p,s*=p):(i=0,a=0,s=0),u=h*s-m*a,l=m*i-d*s,f=d*a-h*i,(p=Math.sqrt(u*u+l*l+f*f))?(u*=p=1/p,l*=p,f*=p):(u=0,l=0,f=0),r[0]=i,r[1]=u,r[2]=d,r[3]=0,r[4]=a,r[5]=l,r[6]=h,r[7]=0,r[8]=s,r[9]=f,r[10]=m,r[11]=0,r[12]=-(i*v+a*g+s*w),r[13]=-(u*v+l*g+f*w),r[14]=-(d*v+h*g+m*w),r[15]=1,r)}function j(r,e,t,n){var o=e[0],i=e[1],a=e[2],s=n[0],u=n[1],c=n[2],l=o-t[0],f=i-t[1],d=a-t[2],h=l*l+f*f+d*d;h>0&&(l*=h=1/Math.sqrt(h),f*=h,d*=h);var m=u*d-c*f,p=c*l-s*d,v=s*f-u*l;return(h=m*m+p*p+v*v)>0&&(m*=h=1/Math.sqrt(h),p*=h,v*=h),r[0]=m,r[1]=p,r[2]=v,r[3]=0,r[4]=f*v-d*p,r[5]=d*m-l*v,r[6]=l*p-f*m,r[7]=0,r[8]=l,r[9]=f,r[10]=d,r[11]=0,r[12]=o,r[13]=i,r[14]=a,r[15]=1,r}function V(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function q(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2)+Math.pow(r[3],2)+Math.pow(r[4],2)+Math.pow(r[5],2)+Math.pow(r[6],2)+Math.pow(r[7],2)+Math.pow(r[8],2)+Math.pow(r[9],2)+Math.pow(r[10],2)+Math.pow(r[11],2)+Math.pow(r[12],2)+Math.pow(r[13],2)+Math.pow(r[14],2)+Math.pow(r[15],2))}function X(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r}function G(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r}function k(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r[4]=e[4]*t,r[5]=e[5]*t,r[6]=e[6]*t,r[7]=e[7]*t,r[8]=e[8]*t,r[9]=e[9]*t,r[10]=e[10]*t,r[11]=e[11]*t,r[12]=e[12]*t,r[13]=e[13]*t,r[14]=e[14]*t,r[15]=e[15]*t,r}function H(r,e,t,n){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r[3]=e[3]+t[3]*n,r[4]=e[4]+t[4]*n,r[5]=e[5]+t[5]*n,r[6]=e[6]+t[6]*n,r[7]=e[7]+t[7]*n,r[8]=e[8]+t[8]*n,r[9]=e[9]+t[9]*n,r[10]=e[10]+t[10]*n,r[11]=e[11]+t[11]*n,r[12]=e[12]+t[12]*n,r[13]=e[13]+t[13]*n,r[14]=e[14]+t[14]*n,r[15]=e[15]+t[15]*n,r}function W(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function Y(r,e){var t=r[0],o=r[1],i=r[2],a=r[3],s=r[4],u=r[5],c=r[6],l=r[7],f=r[8],d=r[9],h=r[10],m=r[11],p=r[12],v=r[13],g=r[14],w=r[15],M=e[0],b=e[1],T=e[2],x=e[3],E=e[4],_=e[5],R=e[6],y=e[7],A=e[8],P=e[9],C=e[10],F=e[11],L=e[12],S=e[13],D=e[14],U=e[15];return Math.abs(t-M)<=n.b*Math.max(1,Math.abs(t),Math.abs(M))&&Math.abs(o-b)<=n.b*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(i-T)<=n.b*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(a-x)<=n.b*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(s-E)<=n.b*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-_)<=n.b*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(c-R)<=n.b*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(l-y)<=n.b*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(f-A)<=n.b*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(d-P)<=n.b*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(h-C)<=n.b*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(m-F)<=n.b*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(p-L)<=n.b*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(v-S)<=n.b*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(g-D)<=n.b*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(w-U)<=n.b*Math.max(1,Math.abs(w),Math.abs(U))}var Z=m,Q=G},function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=t(2),o=t(1);function i(r,e,t){const n=r.createShader(e);return n?(r.shaderSource(n,t),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(console.log(t),console.warn(r.getShaderInfoLog(n)),r.deleteShader(n),null)):null}function a(r,e,t){const n=r.createBuffer();return r.bindBuffer(e,n),r.bufferData(e,t,r.STATIC_DRAW),n}e.loadTexture=async function(r,e){const t=await new Promise((r,t)=>{const n=new Image;n.src=e,n.onload=(()=>r(n)),n.onerror=t}),n=r.createTexture(),o=r=>0==(r&r-1);return r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),o(t.width)&&o(t.height)?r.generateMipmap(r.TEXTURE_2D):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR)),n},e.createProgram=function(r,e,t){const n=i(r,r.VERTEX_SHADER,e),o=i(r,r.FRAGMENT_SHADER,t),a=r.createProgram();if(!a||!n||!o)throw new Error("Failed to create shader program");if(r.attachShader(a,n),r.attachShader(a,o),r.linkProgram(a),!r.getProgramParameter(a,r.LINK_STATUS))throw console.warn(r.getProgramInfoLog(a)),new Error("Can not creat program");const s={},u={},c=r.getProgramParameter(a,r.ACTIVE_ATTRIBUTES),l=r.getProgramParameter(a,r.ACTIVE_UNIFORMS);for(let e=0;e<c;e++){const t=r.getActiveAttrib(a,e).name;s[t]=r.getAttribLocation(a,t)}for(let e=0;e<l;e++){const t=r.getActiveUniform(a,e).name;u[t]=r.getUniformLocation(a,t)}return{program:a,uniforms:u,attributes:s,gl:r}},e.createMatrices=function(r){const e=n.create(),t=n.create(),i=n.create();n.perspective(e,Math.PI/4,r.aspect,.1,r.far||2e3);const a=o.clone(r.cameraPosition),s=o.clone(r.center);return r.flip&&(s[2]=-s[2],a[2]=-a[2]),n.lookAt(t,a,s,[0,0,1]),{model:i,projection:e,view:t}},e.createBuffer=a,e.bindBuffer=function(r,e,t,n){r.bindBuffer(r.ARRAY_BUFFER,e),r.vertexAttribPointer(t,n,r.FLOAT,!1,0,0),r.enableVertexAttribArray(t)},e.bindArraysToBuffers=function(r,e){const{arrays:t,textures:n={},framebuffers:o={}}=e;return{buffers:{position:a(r,r.ARRAY_BUFFER,new Float32Array(t.position)),colors:a(r,r.ARRAY_BUFFER,new Float32Array(t.colors)),indices:a(r,r.ELEMENT_ARRAY_BUFFER,new Uint16Array(t.indices)),normal:a(r,r.ARRAY_BUFFER,new Float32Array(t.normals)),texture:a(r,r.ARRAY_BUFFER,new Float32Array(t.texture))},textures:n,framebuffers:o,size:t.indices.length}},e.createFramebufferAndTexture=function(r,e,t){const n=r.createTexture(),o=r.createFramebuffer(),i=r.createRenderbuffer();return r.bindFramebuffer(r.FRAMEBUFFER,o),r.bindTexture(r.TEXTURE_2D,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.bindRenderbuffer(r.RENDERBUFFER,i),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,i),r.bindFramebuffer(r.FRAMEBUFFER,null),[n,o]},e.inRange=function(r,e,t){return r<e?e:r>t?t:r}},function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=t(1),o=t(5),i=t(8),a=t(10),s=t(13),u=t(16),c=t(3);window.addEventListener("load",async function(){const r=document.querySelector("canvas");r.width=f,r.height=d;const e=r.getContext("experimental-webgl");if(!e)return void console.warn("Can not create webgl context");let t=!0;const l=await o.createTerrain(e,{heatmap:"heightmaps/terrain4.png",height:500/m,chunkSize:20/m,baseLevel:50/m}),p=await a.createWater(e,{size:h}),v=s.createSun(e),g=u.initProperties();i.initControls(r).on("visability",r=>{t=r.visible}).on("toggleRenderWater",()=>{g.renderWater=!g.renderWater}).on("toggleRenderTerrain",()=>{g.renderTerrain=!g.renderTerrain}).on("toggleRefraction",()=>{g.useRefraction=!g.useRefraction}).on("toggleReflection",()=>{g.useReflection=!g.useReflection}).on("toggleRenderSun",()=>{g.renderSun=!g.renderSun}).on("toggleAutoSunMove",()=>{g.autoSunMove=!g.autoSunMove}).on("zoom",r=>{const{cameraPosition:e,center:t}=g,o=n.create(),i=n.distance(t,e),a=c.inRange(i+r.dy,50,1e3);n.sub(o,e,t),n.scale(o,o,a/i),n.add(e,t,o)}).on("moveCamera",r=>{const{cameraPosition:e,center:t}=g,{forward:o,left:i}=r,a=n.create(),s=n.create(),u=n.create();n.sub(a,t,e),n.rotateZ(s,a,[0,0,1],Math.PI/2),s[2]=0,1===o&&n.add(u,u,a),-1===o&&n.sub(u,u,a),1===i&&n.add(u,u,s),-1===i&&n.sub(u,u,s),n.normalize(u,u),n.scale(u,u,6),n.add(e,e,u),n.add(t,t,u)}).on("moveVertically",r=>{const{cameraPosition:e,center:t}=g,o=[0,0,3*r.dy];n.add(e,e,o),n.add(t,t,o)}).on("rotateCamera",r=>{const{dx:e,dy:t}=r,{cameraPosition:o,center:i}=g,a=n.create();n.sub(a,i,o);const s=n.length(a);n.rotateZ(a,a,[0,0,0],.002*e),a[2]-=t,n.normalize(a,a),n.scale(a,a,s),n.add(i,o,a)}).on("moveSun",r=>{g.sunTime+=r.ds;g.sunTime<0?g.sunTime+=864e5:g.sunTime>864e5&&(g.sunTime-=864e5)}),function r(){if(!t)return requestAnimationFrame(r);const n=Date.now()-g.start;g.autoSunMove&&(g.sunTime+=3e5);const{sunPosition:o,directionalLightColor:i,directionalLightVector:a}=s.getSunPosition(g.sunTime);Object.assign(g,{time:n,sunPosition:o,directionalLightVector:a,directionalLightColor:i});!function(r){const e=f/d,t=[h,h,100],{gl:n,terrain:o,water:i,sun:a,properties:s}=r,u=Object.assign({},s,{terrainScale:t,aspect:e});n.clearDepth(1),n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),s.renderWater&&(i.updateReflectionTexture(()=>{s.renderTerrain&&o.render(Object.assign({},u,{clipDirection:-1,flip:!0})),s.renderSun?a.render(Object.assign({},u,{flip:!0})):n.clearColor(.53,.8,.98,1)}),i.updateRefractionTexture(()=>{s.renderTerrain&&o.render(Object.assign({},u,{clipDirection:1}))}));n.viewport(0,0,f,d),s.renderTerrain&&o.render(u);s.renderWater&&i.render(u);s.renderSun&&a.render(u)}({gl:e,properties:g,terrain:l,water:p,sun:v});requestAnimationFrame(r)}()});const l=Math.min(window.innerWidth,window.innerHeight,1024),f=l,d=l,h=2*l,m=4},function(r,e,t){"use strict";var n=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0});const o=t(2),i=t(1),a=t(3),s=n(t(6)),u=n(t(7));function c(r){return function(e){const{gl:t,terrain:n,program:i}=r,{cameraPosition:s,center:u,aspect:c,clipDirection:l=0,clipLevel:f=0,flip:d=!1,terrainScale:h=[1,1,1],directionalLightVector:m,directionalLightColor:p}=e,{projection:v,model:g,view:w}=a.createMatrices({cameraPosition:s,center:u,aspect:c,flip:d});o.scale(g,g,h),t.useProgram(i.program),a.bindBuffer(t,n.buffers.position,i.attributes.position,3),a.bindBuffer(t,n.buffers.normal,i.attributes.normal,3),a.bindBuffer(t,n.buffers.colors,i.attributes.colors,4),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.buffers.indices),t.uniformMatrix4fv(i.uniforms.projection,!1,v),t.uniformMatrix4fv(i.uniforms.model,!1,g),t.uniformMatrix4fv(i.uniforms.view,!1,w),t.uniform3fv(i.uniforms.directionalLightVector,m),t.uniform3fv(i.uniforms.directionalLightColor,p),t.uniform1f(i.uniforms.clipDirection,l),t.uniform1f(i.uniforms.clipLevel,f),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawElements(t.TRIANGLES,n.size,t.UNSIGNED_SHORT,0),t.disable(t.BLEND)}}e.createTerrain=async function(r,e){const t=await async function(r,e,t,n=0){const o=document.createElement("canvas"),a=await function(r){return new Promise((e,t)=>{const n=new Image;n.src=r,n.onload=(()=>e(n)),n.onerror=t})}(r);o.width=a.width,o.height=a.height;const s=o.getContext("2d");if(!s)throw new Error("Can not create 2d context");s.drawImage(a,0,0);const{data:u}=s.getImageData(0,0,a.width,a.height),c=new Uint32Array(u),l=256/e,f=Math.floor(a.width/t),d=Math.floor(a.height/t),h=new Float32Array(f*d);let m=0;for(let r=0;r<d;r++)for(let e=0;e<f;e++){let n=0;for(let o=0;o<t;o++)for(let i=0;i<t;i++)n+=c[4*(r*t*a.width+e*t+o*t+i)];const o=n/t/t/l;h[r*f+e]=o,m<o&&(m=o)}const p=[],v=[],g=[],w=[],M=[];for(let r=0;r<d;r++)for(let e=0;e<f;e++){const t=r*f+e,o=h[t]/m;Number.isFinite(o)||console.log({i:r,j:e,c:o}),p.push(e/f-.5,r/d-.5,(h[t]-n)/m),g.push(o,o,o,1),r!==d-1&&e!==f-1&&v.push(t,t+f,t+1,t+1,t+f,t+f+1),M.push(e/f,r/d)}for(let r=0;r<p.length/3;r++){const e=f,t=d,n=r%e,o=~~(r/e),a=[n>0&&o>0&&[r-e,r-1,r],n+1<e&&o>0&&[r-e,r,r-e+1],n+1<e&&o>0&&[r-e+1,r,r+1],n>0&&o<t&&[r-1,r+e-1,r],n>0&&o<t&&[r,r+e-1,r+e],n+1<e&&o<t&&[r,r+e,r+1]],s=[],u=[];for(let r=0;r<a.length;r++){const e=a[r];for(let r=0;r<3;r++)e&&s.push(p[3*e[r]],p[3*e[r]+1],p[3*e[r]+2])}for(let r=0;r<s.length/9;r++){const e=i.fromValues(s[9*r+0],s[9*r+1],s[9*r+2]),t=i.fromValues(s[9*r+3],s[9*r+4],s[9*r+5]),n=i.fromValues(s[9*r+6],s[9*r+7],s[9*r+8]);i.subtract(t,t,e),i.subtract(n,n,e),i.cross(t,t,n),i.normalize(t,t),u.push(t)}const c=i.fromValues(0,0,0);for(let r=0;r<u.length;r++)i.add(c,c,u[r]);i.normalize(c,c),w.push(c[0],c[1],c[2])}return{position:p,indices:v,colors:g,normals:w,texture:M}}(e.heatmap,e.height,e.chunkSize,e.baseLevel),n=a.createProgram(r,s.default,u.default);return{render:c({terrain:a.bindArraysToBuffers(r,{arrays:t}),gl:r,program:n})}}},function(r,e){r.exports="attribute vec4 position;\r\nattribute vec3 normal;\r\nattribute vec4 colors;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform vec3 directionalLightVector;\r\nuniform vec3 directionalLightColor;\r\nuniform float clipDirection;\r\nuniform float clipLevel;\r\n\r\nvarying highp vec3 vLighting;\r\nvarying lowp vec2 vTextureCoord;\r\nvarying lowp vec4 fragmentColor;\r\nvarying float shouldClip;\r\n\r\nvoid main() {\r\n  highp vec3 ambientLight = vec3(0.1, 0.1, 0.1);\r\n  highp vec3 directionalVector = normalize(directionalLightVector);\r\n\r\n  highp float directional = max(dot(normal, directionalVector), 0.0);\r\n  vLighting = ambientLight + (directionalLightColor * directional);\r\n\r\n  gl_Position = projection * view * model * position;\r\n\r\n  fragmentColor = colors;\r\n  if (clipDirection == 1.0) {\r\n    shouldClip = position.z > clipLevel ? 1.0 : 0.0;\r\n  } else if (clipDirection == -1.0) {\r\n    shouldClip = position.z < clipLevel ? 1.0 : 0.0;\r\n  } else {\r\n    shouldClip = 0.0;\r\n  }\r\n}"},function(r,e){r.exports="varying highp vec3 vLighting;\r\nvarying highp float shouldClip;\r\nvarying lowp vec4 fragmentColor;\r\n\r\nconst lowp vec4 nothingColor = vec4(0.0, 0.0, 0.0, 0.0);\r\nconst lowp vec4 grassColor = vec4(0.12, 0.43, 0.02, 1.0);\r\nconst lowp vec4 snowColor = vec4(1.0);\r\nconst lowp vec4 groundColor = vec4(0.85, 0.84, 0.79, 1.0);\r\n\r\nvoid main() {\r\n  if (shouldClip == 1.0) {\r\n    discard;\r\n  }\r\n  lowp float x = fragmentColor.x;\r\n  lowp float groundGrassMixFactor = smoothstep(0.1, 0.2, x);\r\n  lowp float grassSnowMixFactor = smoothstep(0.7, 0.8, x);\r\n  lowp float nothingGroundMixFactor = smoothstep(0.00, 0.015, x);\r\n  lowp vec4 color = mix(groundColor, grassColor, groundGrassMixFactor);\r\n  color = mix(color, snowColor, grassSnowMixFactor);\r\n  color = mix(nothingColor, color, nothingGroundMixFactor);\r\n\r\n  gl_FragColor = vec4(color.rgb * vLighting, color.a);\r\n}\r\n"},function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=t(9);e.initControls=function(r){let e=!1,t={};const o=new n.EventEmitter,i=()=>{let r=0,e=0,n=0;t.w&&!t.s?e=1:t.s&&!t.w&&(e=-1),t.a&&!t.d?r=1:t.d&&!t.a&&(r=-1),t.j&&!t.k?n-=36e4:t.k&&!t.j&&(n+=36e4),(e||r)&&o.emit("moveCamera",{forward:e,left:r}),n&&o.emit("moveSun",{ds:n}),t.e&&o.emit("moveVertically",{dy:1}),t.q&&o.emit("moveVertically",{dy:-1}),requestAnimationFrame(i)};return i(),r.addEventListener("wheel",r=>{const{deltaY:e}=r;e&&(o.emit("zoom",{dy:e/Math.abs(e)*10}),r.preventDefault())}),window.addEventListener("keypress",r=>{switch(r.key){case"1":o.emit("toggleRenderTerrain");break;case"2":o.emit("toggleRenderWater");break;case"3":o.emit("toggleRefraction");break;case"4":o.emit("toggleReflection");break;case"5":o.emit("toggleRenderSun");break;case"6":o.emit("toggleAutoSunMove");break;default:t[r.key]=!0}}),window.addEventListener("keyup",r=>{t[r.key]=!1}),r.addEventListener("mousedown",()=>{e=!0}),window.addEventListener("mouseup",()=>{e=!1}),r.addEventListener("contextmenu",r=>{r.preventDefault()}),window.addEventListener("mousemove",r=>{const{movementX:t,movementY:n}=r;e&&o.emit("rotateCamera",{dx:-t,dy:n})}),window.addEventListener("blur",()=>{t={},o.emit("visability",{visible:!1})}),window.addEventListener("focus",()=>{o.emit("visability",{visible:!0})}),o}},function(r,e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(r){return"function"==typeof r}function o(r){return"object"==typeof r&&null!==r}function i(r){return void 0===r}r.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(r){if("number"!=typeof r||r<0||isNaN(r))throw TypeError("n must be a positive number");return this._maxListeners=r,this},t.prototype.emit=function(r){var e,t,a,s,u,c;if(this._events||(this._events={}),"error"===r&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(i(t=this._events[r]))return!1;if(n(t))switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),t.apply(this,s)}else if(o(t))for(s=Array.prototype.slice.call(arguments,1),a=(c=t.slice()).length,u=0;u<a;u++)c[u].apply(this,s);return!0},t.prototype.addListener=function(r,e){var a;if(!n(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",r,n(e.listener)?e.listener:e),this._events[r]?o(this._events[r])?this._events[r].push(e):this._events[r]=[this._events[r],e]:this._events[r]=e,o(this._events[r])&&!this._events[r].warned&&(a=i(this._maxListeners)?t.defaultMaxListeners:this._maxListeners)&&a>0&&this._events[r].length>a&&(this._events[r].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[r].length),"function"==typeof console.trace&&console.trace()),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(r,e){if(!n(e))throw TypeError("listener must be a function");var t=!1;function o(){this.removeListener(r,o),t||(t=!0,e.apply(this,arguments))}return o.listener=e,this.on(r,o),this},t.prototype.removeListener=function(r,e){var t,i,a,s;if(!n(e))throw TypeError("listener must be a function");if(!this._events||!this._events[r])return this;if(a=(t=this._events[r]).length,i=-1,t===e||n(t.listener)&&t.listener===e)delete this._events[r],this._events.removeListener&&this.emit("removeListener",r,e);else if(o(t)){for(s=a;s-- >0;)if(t[s]===e||t[s].listener&&t[s].listener===e){i=s;break}if(i<0)return this;1===t.length?(t.length=0,delete this._events[r]):t.splice(i,1),this._events.removeListener&&this.emit("removeListener",r,e)}return this},t.prototype.removeAllListeners=function(r){var e,t;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[r]&&delete this._events[r],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n(t=this._events[r]))this.removeListener(r,t);else if(t)for(;t.length;)this.removeListener(r,t[t.length-1]);return delete this._events[r],this},t.prototype.listeners=function(r){return this._events&&this._events[r]?n(this._events[r])?[this._events[r]]:this._events[r].slice():[]},t.prototype.listenerCount=function(r){if(this._events){var e=this._events[r];if(n(e))return 1;if(e)return e.length}return 0},t.listenerCount=function(r,e){return r.listenerCount(e)}},function(r,e,t){"use strict";var n=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0});const o=t(2),i=t(3),a=n(t(11)),s=n(t(12));function u(r){return function(e){const{gl:t,water:n,size:o}=r;t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffers.reflection),t.viewport(0,0,o,o),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)}}function c(r){return function(e){const{gl:t,water:n,size:o}=r;t.bindFramebuffer(t.FRAMEBUFFER,n.framebuffers.refraction),t.viewport(0,0,o,o),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)}}function l(r){const{size:e,program:t,gl:n,water:a}=r;return n.useProgram(t.program),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.textures.dudv),n.uniform1i(t.uniforms.dudvTexture,0),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,a.textures.normalMap),n.uniform1i(t.uniforms.normalMapTexture,1),n.activeTexture(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,a.textures.refraction),n.uniform1i(t.uniforms.refractionTexture,2),n.activeTexture(n.TEXTURE3),n.bindTexture(n.TEXTURE_2D,a.textures.reflection),n.uniform1i(t.uniforms.reflectionTexture,3),function(r){const{cameraPosition:s,center:u,aspect:c,time:l,useReflection:f,useRefraction:d,directionalLightVector:h,directionalLightColor:m}=r,{projection:p,model:v,view:g}=i.createMatrices({cameraPosition:s,center:u,aspect:c});o.scale(v,v,[e,e,1]),n.useProgram(t.program),i.bindBuffer(n,a.buffers.position,t.attributes.position,3),i.bindBuffer(n,a.buffers.texture,t.attributes.textureCoord,2),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a.buffers.indices),n.uniform1f(t.uniforms.dudvOffset,l/1e3*.03%1),n.uniform1i(t.uniforms.useRefraction,Number(d)),n.uniform1i(t.uniforms.useReflection,Number(f)),n.uniform3fv(t.uniforms.cameraPosition,s),n.uniform3fv(t.uniforms.directionalLightVector,h),n.uniform3fv(t.uniforms.directionalLightColor,m),n.uniformMatrix4fv(t.uniforms.projection,!1,p),n.uniformMatrix4fv(t.uniforms.model,!1,v),n.uniformMatrix4fv(t.uniforms.view,!1,g),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.drawElements(n.TRIANGLES,a.size,n.UNSIGNED_SHORT,0),n.disable(n.BLEND)}}e.createWater=async function(r,e){const{size:t}=e,n=await i.loadTexture(r,"textures/dudvmap.png"),o=await i.loadTexture(r,"textures/normalmap.png"),[f,d]=i.createFramebufferAndTexture(r,t,t),[h,m]=i.createFramebufferAndTexture(r,t,t),p={position:[-.5,-.5,0,.5,-.5,0,-.5,.5,0,.5,.5,0],indices:[0,2,1,1,2,3],texture:[0,0,1,0,0,1,1,1]},v={gl:r,program:i.createProgram(r,a.default,s.default),size:t,water:i.bindArraysToBuffers(r,{arrays:p,framebuffers:{refraction:d,reflection:m},textures:{dudv:n,normalMap:o,refraction:f,reflection:h}})};return{render:l(v),updateReflectionTexture:u(v),updateRefractionTexture:c(v)}}},function(r,e){r.exports="attribute vec4 position;\r\nattribute vec2 textureCoord;\r\n\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform mat4 projection;\r\nuniform lowp vec3 cameraPosition;\r\n\r\nvarying highp vec2 vTextureCoord;\r\nvarying highp vec4 clipSpace;\r\nvarying highp vec3 fromFragmentToCamera;\r\nvarying lowp float reflectionYOffset;\r\n\r\nconst lowp float tiling = 10.0;\r\n\r\nvoid main() {\r\n    vec4 worldPosition = model * position;\r\n    gl_Position = clipSpace = projection * view * worldPosition;\r\n\r\n    fromFragmentToCamera = cameraPosition - worldPosition.xyz;\r\n    vTextureCoord = textureCoord * tiling;\r\n}"},function(r,e){r.exports="varying lowp vec2 vTextureCoord;\r\nvarying lowp vec4 clipSpace;\r\nvarying lowp vec3 fromFragmentToCamera;\r\n\r\nuniform sampler2D dudvTexture;\r\nuniform sampler2D normalMapTexture;\r\nuniform sampler2D refractionTexture;\r\nuniform sampler2D reflectionTexture;\r\nuniform lowp float dudvOffset;\r\nuniform int useRefraction;\r\nuniform int useReflection;\r\nuniform lowp vec3 directionalLightVector;\r\nuniform lowp vec3 directionalLightColor;\r\n\r\nconst lowp float waterDistortionStrenth = 0.02;\r\nconst lowp float fresnelStrength = 1.5;\r\nconst lowp float waterReflectivity = 0.5;\r\nconst lowp vec4 shallowWaterColor =  vec4(0.0, 0.1, 0.3, 1.0);\r\n// const lowp vec4 deepWaterColor = vec4(0.0, 0.1, 0.2, 1.0);\r\nconst lowp float shineDamper = 20.0;\r\n\r\nvoid main() {\r\n    // distortion\r\n    lowp vec2 distortedTexCoords = texture2D(dudvTexture, vec2(vTextureCoord.x, vTextureCoord.y + dudvOffset)).xy * 0.1;\r\n    distortedTexCoords = vTextureCoord + vec2(distortedTexCoords.x + dudvOffset, distortedTexCoords.y);\r\n\r\n    lowp vec2 totalDistortion = (texture2D(dudvTexture, distortedTexCoords).xy * 2.0 - 1.0) * waterDistortionStrenth;\r\n\r\n    // base refract/reflect texture coordinates\r\n    lowp vec2 ndc = (clipSpace.xy / clipSpace.w) / 2.0 + 0.5;\r\n    lowp vec2 refractTexCoords = vec2(ndc.x, +ndc.y);\r\n    lowp vec2 reflectTexCoords = vec2(ndc.x, 1.0-ndc.y);\r\n\r\n\r\n    // refractive factor\r\n    lowp vec3 toCamera = normalize(fromFragmentToCamera);\r\n    lowp vec4 normalMapColor = texture2D(normalMapTexture, distortedTexCoords);\r\n    lowp vec3 normal = normalMapColor.xyz * 2.0 - 1.0;\r\n    normal = normalize(normal);\r\n    lowp float refractiveFactor = dot(toCamera, normal);\r\n    refractiveFactor = pow(refractiveFactor, fresnelStrength);\r\n\r\n    // puting all together\r\n    refractTexCoords += totalDistortion;\r\n    reflectTexCoords += totalDistortion;\r\n    // refractTexCoords = clamp(refractTexCoords, 0.001, 0.999);\r\n    // reflectTexCoords.x = clamp(reflectTexCoords.x, 0.001, 0.999);\r\n    // reflectTexCoords.y = clamp(reflectTexCoords.y, 0.001, 0.999);\r\n\r\n    // lighs\r\n    lowp vec3 reflectedLight = reflect(normalize(directionalLightVector), normal);\r\n    lowp float specular = max(dot(reflectedLight, toCamera), 0.0);\r\n    specular = pow(specular, shineDamper);\r\n    lowp vec3 specularHighlights = directionalLightColor * specular * waterReflectivity;\r\n\r\n    // color\r\n    lowp vec4 refractColor = texture2D(refractionTexture, refractTexCoords);\r\n    lowp vec4 reflectColor = texture2D(reflectionTexture, reflectTexCoords);\r\n\r\n    if (useReflection == 1 && useRefraction == 1) {\r\n      gl_FragColor = mix(reflectColor, refractColor, refractiveFactor);\r\n    } else if (useReflection == 1) {\r\n      gl_FragColor = reflectColor;\r\n    } else if (useRefraction == 1) {\r\n      gl_FragColor = refractColor;\r\n    }\r\n    gl_FragColor = mix(gl_FragColor, shallowWaterColor, 0.2);\r\n\r\n    gl_FragColor = gl_FragColor + vec4(specularHighlights, 1.0);\r\n}\r\n"},function(r,e,t){"use strict";var n=this&&this.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(e,"__esModule",{value:!0});const o=t(1),i=t(2),a=t(3),s=n(t(14)),u=n(t(15)),{cos:c,sin:l,tan:f,PI:d}=Math;function h(r){return function(e){const{gl:t,program:n,sun:o}=r,{cameraPosition:s,center:u,aspect:c,sunPosition:l,flip:f=!1}=e,{projection:d,model:h,view:m}=a.createMatrices({cameraPosition:s,center:u,aspect:c,flip:f,far:2e3});i.translate(h,h,s),i.translate(h,h,[0,0,-170]),i.scale(h,h,[1e3,1e3,1e3]),t.useProgram(n.program),a.bindBuffer(t,o.buffers.position,n.attributes.position,3),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.buffers.indices),t.uniform1f(n.uniforms.domeRadius,1e3),t.uniform3fv(n.uniforms.sunPosition,l),t.uniform3fv(n.uniforms.cameraPosition,s),t.uniformMatrix4fv(n.uniforms.projection,!1,d),t.uniformMatrix4fv(n.uniforms.view,!1,m),t.uniformMatrix4fv(n.uniforms.model,!1,h),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawElements(t.TRIANGLES,o.size,t.UNSIGNED_SHORT,0),t.disable(t.BLEND)}}function m(){const r=50,e=[],t=[];for(let n=0;n<=r;n++){const o=d/r*n-d/2;for(let i=0;i<r;i++){const a=2*d/r*i,s=c(a)*c(o),u=l(a)*c(o),f=l(o),h=n*r+i;e.push(s,u,f),n!==r&&(49===i?t.push(n*r,h+r,h,h+r,h+1,n*r):t.push(h,h+1,h+r,h+1,h+r,h+r+1))}}return{position:e,indices:t}}function p(r){return("00"+r).slice(-2)}e.createSun=function(r){const e=a.createProgram(r,s.default,u.default);return{render:h({gl:r,sun:a.bindArraysToBuffers(r,{arrays:m()}),program:e})}},e.sunTimeToString=function(r){const e=Math.ceil(r/60/1e3),t=e%60;return`${p(Math.floor(e/60))}:${p(t)}`},e.getSunPosition=function(r){const e=r%864e5,t=function(r){return f(-4.83049e-16*r*r+4.21414e-8*r-.420437)}(e),n=function(r){return 7.344052639206152e-8*r-.1829595519336553}(e),i=c(t)*c(n),s=c(t)*l(n),u=l(t),d=o.fromValues(i,-s,u),h=o.fromValues(1,1,1),m=o.create(),p=a.inRange(2*u,0,1);return o.negate(m,d),o.scale(h,h,p),{sunPosition:o.fromValues(i,-s,u),directionalLightColor:h,directionalLightVector:m}}},function(r,e){r.exports="attribute vec4 position;\r\n\r\nuniform lowp mat4 view;\r\nuniform lowp mat4 model;\r\nuniform lowp mat4 projection;\r\n\r\nvarying lowp vec4 worldPosition;\r\n\r\nvoid main() {\r\n    worldPosition = position;\r\n    gl_Position = projection * view * model * worldPosition;\r\n}"},function(r,e){r.exports="uniform lowp float domeRadius;\r\nuniform lowp vec3 sunPosition;\r\nuniform lowp vec3 cameraPosition;\r\n\r\nconst lowp float PI = 3.1415926535897932384626433832795;\r\nconst lowp float PI_2 = 1.57079632679489661923;\r\nconst lowp float si = 22.0; // sun intencity\r\n\r\nconst lowp float earthRadius = 6371e3;\r\nconst lowp float atmosphereRadius = 6471e3;\r\nconst lowp float rsh = 8.0e3; // Rayleigh scale height\r\nconst lowp float msh = 1.2e3; // Mie scale height\r\n\r\nconst lowp vec3 rsc = vec3(5.5e-6, 13.0e-6, 22.4e-6); // Rayleigh scattering coefficient\r\nconst lowp float msc = 21e-6; // Mie scattering coefficient\r\n\r\nconst lowp float gr = 0.0; // Rayleigh simetry constant\r\nconst lowp float gm = 0.758; // Mie simetry constant\r\n\r\nvarying lowp vec4 worldPosition;\r\nvarying lowp vec4 sunView;\r\n\r\nconst int samples = 5;\r\n\r\n// https://developer.nvidia.com/gpugems/GPUGems2/gpugems2_chapter16.html\r\nlowp float phase(\r\n    lowp float g,\r\n    lowp float a\r\n) {\r\n    lowp float g2 = g * g;\r\n    return 3.0 * (1.0 - g2)  * (1.0 + a * a) / 8.0 / PI / (2.0 + g2) / pow(1.0 + g2 - 2.0 * g * a, 1.5);\r\n}\r\n\r\nlowp vec3 translate(lowp vec3 dir) {\r\n    lowp float r1 = earthRadius;\r\n    lowp float r2 = atmosphereRadius;\r\n\r\n    lowp float al0 = asin(dir.z);\r\n    lowp float az0 = atan(dir.y / dir.x);\r\n    if (dir.x < 0.0) {\r\n        az0 += PI;\r\n    }\r\n    lowp float al1 = asin(r1 / r2);\r\n    lowp float al2 = al1 + (1.0 - al1 / PI_2) * al0;\r\n    return vec3(\r\n        cos(al2) * cos(az0),\r\n        cos(al2) * sin(az0),\r\n        sin(al2)\r\n    );\r\n}\r\n\r\n// http://viclw17.github.io/2018/07/16/raytracing-ray-sphere-intersection/\r\nlowp float dtse(\r\n    lowp vec3 origin,\r\n    lowp vec3 direction,\r\n    lowp float radius\r\n) {\r\n    lowp vec3 center = vec3(0.0); // could be used as parameter\r\n    lowp vec3 oc = origin - center;\r\n    lowp float a = dot(direction, direction);\r\n    lowp float b = 2.0 * dot(direction, oc);\r\n    lowp float c = dot(oc, oc) - radius * radius;\r\n    lowp float d = b * b - 4.0 * a * c;\r\n    if (d < 0.0) {\r\n        return -1.0;\r\n    }\r\n    lowp float qd = sqrt(d);\r\n    lowp float t = (-qd - b) / 2.0 / a;\r\n    if (t >= 0.0) {\r\n        return t;\r\n    }\r\n    t = (qd - b) / 2.0 / a;\r\n    if (t > 0.0) {\r\n        return t;\r\n    }\r\n    return -1.0;\r\n}\r\n\r\nlowp vec3 getSunColor(\r\n    lowp vec3 sun,\r\n    lowp vec3 position\r\n) {\r\n    lowp float angle = acos(dot(\r\n        sun,\r\n        position\r\n    ));\r\n    return vec3(1.0) * (1.0 - smoothstep(0.0, 1.0, angle * 20.0));\r\n}\r\n\r\nvoid main() {\r\n    lowp vec3 camera = vec3(0.0, 0.0, earthRadius);\r\n    lowp vec3 world = normalize(worldPosition.xyz);\r\n    lowp vec3 position = translate(world) * atmosphereRadius;\r\n    lowp vec3 ray = normalize(position - camera);\r\n    lowp vec3 sun = normalize(sunPosition);\r\n\r\n    lowp float far = dtse(camera, ray, atmosphereRadius);\r\n\r\n    lowp float lightAngle = dot(ray, sun);\r\n    lowp float rshFactor = phase(gr, lightAngle);\r\n    lowp float mieFactor = phase(gm, lightAngle);\r\n\r\n    lowp float sampleSize = far / float(samples);\r\n    lowp vec3 samplePoint = camera + ray * sampleSize * 0.5;\r\n    lowp float rshOpticalDepth = 0.0;\r\n    lowp float mieOpticalDepth = 0.0;\r\n    lowp vec3 rshAccumulated = vec3(0.0);\r\n    lowp vec3 mieAccumulated = vec3(0.0);\r\n\r\n    for (int i = 0; i < samples; i ++) {\r\n        lowp float far2 = dtse(\r\n            samplePoint,\r\n            sun,\r\n            atmosphereRadius\r\n        );\r\n        lowp float sampleSize2 = far2 / float(samples);\r\n        lowp vec3 samplePoint2 = samplePoint + sampleSize2 / 2.0 * sun;\r\n        lowp float rshOpticalDepth2 = 0.0;\r\n        lowp float mieOpticalDepth2 = 0.0;\r\n\r\n        for (int j = 0; j < samples; j ++) {\r\n            lowp float height = length(samplePoint2) - earthRadius;\r\n            lowp float rshOpticalDepthStep = exp(-height / rsh) * sampleSize2;\r\n            lowp float mieOpticalDepthStep = exp(-height / msh) * sampleSize2;\r\n\r\n            rshOpticalDepth2 += rshOpticalDepthStep;\r\n            mieOpticalDepth2 += mieOpticalDepthStep;\r\n\r\n            samplePoint2 += sun * sampleSize2;\r\n        }\r\n\r\n        lowp float height = length(samplePoint) - earthRadius;\r\n        lowp float rshOpticalDepthStep = exp(-height / rsh) * sampleSize;\r\n        lowp float mieOpticalDepthStep = exp(-height / msh) * sampleSize;\r\n\r\n        rshOpticalDepth += rshOpticalDepthStep;\r\n        mieOpticalDepth += mieOpticalDepthStep;\r\n\r\n        lowp vec3 outScattering = exp(\r\n            -rsc * (rshOpticalDepth + rshOpticalDepth2)\r\n            -msc * (mieOpticalDepth + mieOpticalDepth2)\r\n        );\r\n\r\n        rshAccumulated += rshOpticalDepthStep * outScattering;\r\n        mieAccumulated += mieOpticalDepthStep * outScattering;\r\n\r\n        samplePoint += ray * sampleSize;\r\n    }\r\n\r\n    lowp vec3 color = vec3(0.0);\r\n\r\n    // mieAccumulated *= 0.0;\r\n    // rshAccumulated *= 0.5;\r\n    lowp vec3 sunColor = getSunColor(sun, world);\r\n    lowp vec3 totalLight = si * (\r\n        rshFactor * rsc * rshAccumulated +\r\n        mieFactor * msc * mieAccumulated\r\n    );\r\n    // color += totalLight;\r\n    color += 1.0 - exp(-1.0 * totalLight);\r\n    color += sunColor;\r\n\r\n    gl_FragColor = vec4(color, 1.0);\r\n}\r\n"},function(r,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=t(1),o="dev-properties",i={center:n.fromValues(106,-461,93),cameraPosition:n.fromValues(-341,106,169),directionalLightVector:n.fromValues(0,0,0),directionalLightColor:n.fromValues(0,0,0),sunPosition:n.fromValues(0,0,-1),start:Date.now(),sunTime:36e5,time:0,renderWater:!0,renderTerrain:!0,useReflection:!0,useRefraction:!0,renderSun:!0,autoSunMove:!0};e.initProperties=function(){const r=localStorage.getItem(o);return r?Object.assign({},i,JSON.parse(r)):i}}]);
//# sourceMappingURL=index.js.map